<!doctype html>
<html><head><title>
aArray
</title>
<link rel="icon" href="https://gratis.gitlab.io/favicon-96.ico" sizes="96x96">
<link rel="icon" href="https://gratis.gitlab.io/favicon-16.ico" sizes="16x16">
<link rel="icon" href="https://gratis.gitlab.io/favicon-32.ico" sizes="32x32">
<meta http-equiv="Content-Type" charset="utf-8"/>
<meta name="viewport" content="width=675"/>
<style>
html body h1 { display:none; /* doxygen version changes makes life difficult */ }
h1, h2, h3, h4, h5, h6 {
        margin-bottom:-1.5ex;
	-webkit-transition: text-shadow 0.5s linear;
	-moz-transition: text-shadow 0.5s linear;
	-ms-transition: text-shadow 0.5s linear;
	-o-transition: text-shadow 0.5s linear;
	transition: text-shadow 0.5s linear; margin-right: 15px; }
dt { font-weight: bold; }
a { color: #3d578c; font-weight: normal; text-decoration: none; }
a:hover { text-decoration: underline; }
a.el { font-weight: bold; }
a.code, a.code:visited, a.line, a.line:visited { color: #4665a2; }
pre.fragment {
  border: 1px solid #c4cfe5;
  background-color: #fbfcfd;
  padding: 4px 6px;
  margin: 14px 2px 2px 2px;
  line-height: 125%;
  font-family: monospace, fixed;
	overflow:auto;
	white-space: -moz-pre-wrap;
	white-space: -pre-wrap;
	white-space: -o-pre-wrap;
	white-space: pre-wrap;
	word-wrap: break-word; }
div.fragment {
	word-break:break-word;
  padding: 4px 6px;
  margin: 14px 2px 2px 2px;
	background-color: #fbfcfd;
	border: 1px solid #c4cfe5; }
div.line { font-family: monospace, fixed; font-size: 13px;
	min-height: 13px;
	line-height: 1.0;
	text-wrap: unrestricted;
	white-space: -moz-pre-wrap;
	white-space: -pre-wrap;
	white-space: -o-pre-wrap;
	white-space: pre-wrap;
	word-wrap: break-word;
	text-indent: -4ex;
	padding-left: 4ex;
	padding-bottom: 0px;
	margin: 0px;
	-webkit-transition-property: background-color, box-shadow;
	-webkit-transition-duration: 0.5s;
	-moz-transition-property: background-color, box-shadow;
	-moz-transition-duration: 0.5s;
	-ms-transition-property: background-color, box-shadow;
	-ms-transition-duration: 0.5s;
	-o-transition-property: background-color, box-shadow;
	-o-transition-duration: 0.5s;
	transition-property: background-color, box-shadow; transition-duration: 0.5s; }
span.lineno {
	padding-right: 4px;
	text-align: right;
	border-right: 2px solid #0F0;
	background-color: #e8e8e8; white-space: pre; }
div.groupHeader {
	margin-left: 16px;
	margin-top: 12px; font-weight: bold; }
span.keyword { color: #008000; }
span.keywordtype { color: #604020; }
span.keywordflow { color: #e08000; }
span.comment { color: #800000; }
span.preprocessor { color: #806020; }
span.stringliteral { color: #002080; }
span.charliteral { color: #008080; }
table.memberdecls {
	border-spacing: 0px; padding: 0px; }
.memberdecls td, .fieldtable tr {
	-webkit-transition-property: background-color, box-shadow;
	-webkit-transition-duration: 0.5s;
	-moz-transition-property: background-color, box-shadow;
	-moz-transition-duration: 0.5s;
	-ms-transition-property: background-color, box-shadow;
	-ms-transition-duration: 0.5s;
	-o-transition-property: background-color, box-shadow;
	-o-transition-duration: 0.5s;
	transition-property: background-color, box-shadow; transition-duration: 0.5s; }
.memItemLeft, .memItemRight,
.memTemplItemLeft, .memTemplItemRight {
	background-color: #f9fafc;
	border: none;
	margin: 4px; padding: 1px 0 0 8px; }
.memSeparator {	border-bottom: 1px solid #ebeff6; line-height: 0px; margin: 0px; padding: 0px; }
html .memSeparatorFirst { padding:5px; }
.memItemLeft, .memTemplItemLeft {
	white-space: nowrap;
border-left: 1px solid #ebeff6; }
.memItemRight { width: 100%; }
.memitem {
	padding: 0;
	margin-bottom: 10px;
	margin-right: 5px;
        -webkit-transition: box-shadow 0.5s linear;
        -moz-transition: box-shadow 0.5s linear;
        -ms-transition: box-shadow 0.5s linear;
        -o-transition: box-shadow 0.5s linear;
        transition: box-shadow 0.5s linear;
        display: table !important; width: 100%; }
.memname {
        font-weight: bold; margin-left: 6px; }
.memname td { vertical-align: bottom; }
.memproto {
        border-top: 1px solid #a8b8d9;
        border-left: 1px solid #a8b8d9;
        border-right: 1px solid #a8b8d9;
        padding: 6px 0px 6px 0px;
        color: #253555;
        font-weight: bold;
        text-shadow: 0px 1px 1px rgba(255, 255, 255, 0.9);
        background-repeat:repeat-x;
        background-color: #e2e8f2;
        box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.15);
        border-top-right-radius: 4px;
        border-top-left-radius: 4px;
        -moz-box-shadow: rgba(0, 0, 0, 0.15) 5px 5px 5px;
        -moz-border-radius-topright: 4px;
        -moz-border-radius-topleft: 4px;
        -webkit-box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.15);
        -webkit-border-top-right-radius: 4px;
        -webkit-border-top-left-radius: 4px; }
.memdoc {
        border-bottom: 1px solid #a8b8d9;
        border-left: 1px solid #a8b8d9;
        border-right: 1px solid #a8b8d9;
        padding: 6px 10px 2px 10px;
        background-color: #fbfcfd;
        border-top-width: 0;
        background-repeat:repeat-x;
        background-color: #ffffff;
        border-bottom-left-radius: 4px;
        border-bottom-right-radius: 4px;
        box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.15);
        -moz-border-radius-bottomleft: 4px;
        -moz-border-radius-bottomright: 4px;
        -moz-box-shadow: rgba(0, 0, 0, 0.15) 5px 5px 5px;
        -webkit-border-bottom-left-radius: 4px;
        -webkit-border-bottom-right-radius: 4px;
        -webkit-box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.15); }
.paramkey { text-align: right; }
.paramtype { white-space: nowrap; }
.paramname { color: #602020; white-space: nowrap; }
.paramname em { font-style: normal; }
.paramname code { line-height: 14px; }
.params, .retval, .exception, .tparams {
        margin-left: 0px; padding-left: 0px; }       
.params .paramname, .retval .paramname {
        font-weight: bold; vertical-align: top; }
.params .paramtype {
        font-style: italic; vertical-align: top; }       
.params .paramdir {
        font-family: "courier new",courier,monospace; vertical-align: top; }
dl { padding: 0 0 0 10px; }
dl.section { margin-left:2px;
	padding-left:0px; margin-bottom:4px; }
dl.note { padding-left:3px; border-left:4px solid; border-color:#d0c000; }
dl.warning, dl.attention { padding-left:3px;
        border-left:4px solid; border-color:#ff0000; }
dl.pre, dl.post, dl.invariant { margin-left:-7px; padding-left:3px; border-left:4px solid; border-color:#00d000; }
dl.deprecated { margin-left:-7px; padding-left:3px;
        border-left:4px solid; border-color:#505050; }
dl.todo { margin-left:-7px; padding-left:3px;
        border-left:4px solid; border-color:#00c0e0; }
dl.test { margin-left:-7px; padding-left:3px;
        border-left:4px solid; border-color:#3030e0; }
dl.bug { margin-left:-7px; padding-left:3px;
        border-left:4px solid; border-color: #c08050; }
dd { margin:0px 0px 0px 3ex; }






body { font:400 14px/22px Roboto,sans-serif; min-width:517px;
	word-break:break-word;
	background-color: white;
	color: black; }

html, body { margin:0px; padding:0px; }

.memdoc { padding-bottom:10px }
span.lineno {
        background-color: #fbfcfd;
        border-right:2px solid #ebeff6 }
#tabs2 div.sourceFragment {
        margin-bottom:21px; padding:0; background-color:#fffffc;
        border:0; border-right:2px solid #fdfddd; font-size:80% }
.ttc { display:none }

#tabs2 { max-width:1060px; text-align:left; margin:21px 14px 7px 14px; }
#tabs1 div.tab { position:relative; left:0px; }
#tabs2 div.tab { }
.tabs div.tab_hidden { display:none }
.tabLinks a { text-decoration:none; font-size:130%; font-style:italic; margin:0px 8px; }
.tabLinks a.tab_hidden { text-decoration:underline; }

#info { background-color:#e2e8f2; 
        border-bottom:1px solid #a8b8d9; }
#info2 { max-width:1060px; margin:0 auto; padding:20px 20px 10px 20px; }
.info_link { text-decoration:underline }

#api_details { table-layout:fixed;width:100%;border-spacing:0;border-collapse:collapse; }
#api_details td { padding:0px; }

h3 { margin:4ex 0 -1.5ex 0; padding:0; color:#97c }
h4 { margin:0 0 -1.5ex 0; display:inline }
s, u { text-decoration:none; letter-spacing:0.5em }
u { letter-spacing:0.25em }
#info .tab { font-size:110% }
.quote { color:#888; font-size:110%; margin-left:48px }
code { background-color:#fbfcfd; padding:1px 2px }
#tabLinks1 { display:inline }
#tabLinks2 { text-align:right }
img { display:inline }
.image { display:inline }

</style></head>
<body><div id="info"><div id="info2">
<div class="tabLinks" id="tabLinks1"><span style="font-size:280%;font-style:italic;font-weight:bold">aArray</span> <a>overview</a> / <a>how</a> / <a>details</a> / <a>THANKS</a></div>
<div class="tabs" id="tabs1">
	<div class="tab"><h1><a class="anchor" id="autotoc_md0"></a>
Never use doxygen again</h1>

<p> <noscript style="color:#b44">(javascript required for navigation)</noscript></p>
<p>Arrays and strings are simple things.<s> </s>Made simpler in c</p><ul>
<li>By being <b>safe:</b><s> </s>buffer overflow and other errors give clear messages</li>
<li><b>generic:</b><s> </s>arrays can have any datatype</li>
<li><b>fast:</b><s> </s>optionally uses <a class="info_link" href="#details" onclick="a_details.onclick(); document.body.scrollIntoView(); return false">less memory</a> too</li>
<li>and <b>simple:</b><s> </s>as first priority</li>
</ul>
<div>Quick example:</div> <div class="fragment"><div class="line"><span class="keywordtype">char</span>* arr = NULL;</div>
<div class="line"> </div>
<div class="line">aAppend(&amp;arr, <span class="charliteral">'I'</span>, <span class="charliteral">' '</span>, <span class="charliteral">'w'</span>, <span class="charliteral">'a'</span>, <span class="charliteral">'n'</span>, <span class="charliteral">'t'</span>);</div>
<div class="line">aMap(arr, capitalize_char); <span class="comment">// capitalizes each char</span></div>
<div class="line"> </div>
<div class="line">arr[3] = <span class="charliteral">'O'</span>;        <span class="comment">// standard assignment</span></div>
<div class="line">aAt2(arr, 5, <span class="charliteral">' '</span>);   <span class="comment">// same as arr[5] = ' ', but overflow safe</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Append a null terminated array and 5 items from a second array</span></div>
<div class="line">aAppendArray(&amp;arr, SIZE_MAX, <span class="stringliteral">"chunky "</span>, 5, <span class="stringliteral">"bacon, francis"</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// At position 0 replace 1 item with a null terminated array</span></div>
<div class="line">aReplaceArray(&amp;arr, 0, 1, SIZE_MAX, <span class="stringliteral">"Everyone"</span>);</div>
<div class="line"> </div>
<div class="line">aWrite(arr); <span class="comment">// prints "Everyone WON chunky bacon"</span></div>
<div class="line">aFree(&amp;arr);</div>
</div><p>That <code>char*</code> could equally be <code>int*</code> or an array of pointers;<s> </s>and still transparently be passed as a c array</p>
<p>Some disadvantages are:</p><ul>
<li>It is impossible to implement aArray without macros.<s> </s>They are side-effect safe, and pre-reduced;<s> </s>so you see the minimum.<s> </s>But compiler messages due to missing commas, or type mismatches are still less than helpful.<s> </s>Thankfully these are easy to fix, and more problematic errors, such as buffer overflow, are clear and can be extended with backtraces:</li>
</ul>
<div class="fragment"><div class="line">example_error.c:300: out of bounds (length=8 but pos=10)</div>
</div><ul>
<li>Because aArray is generic, some return values get type cast to reflect the array type.<s> </s>Sadly <code>-pedantic</code> now enables <code>-Wno-unused-value</code>, and some functions may need <code>(void)</code> placed infront of them to silence this warning:<s> </s><code>(void)aLength2(array, newlen)</code><s> </s></li>
<li>This library has only been used in a few programs.<s> </s>But passes unittests, valgrind, has been fuzzed, passes static analysis, and even bootstraps itself.<s> </s>The unitests loc is just over 2x the source code</li>
</ul>
<p>It runs as c99 under clang, gcc, and tcc;<s> </s>on DragonFly, Linux, macOS, and Windows in 32 and 64bit.<s> </s>It compiles with <span style="white-space:nowrap"><code>-pedantic -Wall -Wextra -Weverything</code></span></p>
<p>This page is self-contained documention for <a class="info_link" href="https://tse.gratis/aArray/aArray.h">aArray.h</a> release (14 Sep 2020)</p>
<p>Public domain.<s> </s>No restriction, no need to accredit.<s> </s>“As freely as you have received, freely give”<s> </s>–<s> </s>Jesus</p>
</div><div class="tab tab_hidden">
<p>Even when writing aArray, I wasn't aware it would be possible;<s> </s>so the library has slowly transformed over several of years</p>
<p>Here are some comments on how it all works.<s> </s>Implementation details come from <a class="info_link" href="http://graphics.stanford.edu/~seander/bithacks.html">bithacks</a>, <a class="info_link" href="http://www.hackersdelight.org/hdcodetxt/nlz.c.txt">hackersdelight</a>, <a class="info_link" href="https://github.com/BonzaiThePenguin/WikiSort">BonzaiThePenguin</a>, and the initial idea from <a class="info_link" href="http://sglib.sourceforge.net">sglib</a></p>
<h3><a class="anchor" id="autotoc_md3"></a>
How can c functions take an unknown number of arguments?</h3>
<p>Normally functions with a variable number of arguments need a marker to show how many arguments they're given, such as with <code>stdargs.h</code> or <code>varargs.h</code></p>
<p>aArray functions don't need a marker, yet their number of arguments is known.<s> </s>Allowing them to be allocated and memcpy'd in one go, rather than iterated.<s> </s>This means less effort for the programmer, and a faster runtime</p>
<p>It is side-effect safe and done through <code>__VA_ARGS__</code>.<s> </s>This exapnds to a list of a macro's arguments, which <code>(type[]){__VA_ARGS__}</code> turns into an array, and <code>sizeof((type[]){__VA_ARGS__}) / sizeof(type)</code> uses to calculate the array length</p>
<h3><a class="anchor" id="autotoc_md4"></a>
How can c functions be polymorphic?</h3>
<p>Different types take up different amounts of space, and so specialized functions are required for each type.<s> </s>But aAppend can take any type</p>
<p>How much space each item of an array takes can be calculated with <code>sizeofType = sizeof(*array)</code>.<s> </s>So we can have a function for each type;<s> </s>then select the correct one with <code>typed_functions[sizeofType]</code> Polymorphism and variable number of arguments combine together something like this:</p>
<div class="fragment"><div class="line"><span class="comment">// get number of var-arg arguments, and make them generic</span></div>
<div class="line"><span class="comment">// results in:  arrayLength, (type[]){array}</span></div>
<div class="line"><span class="preprocessor">#define AARRAY_Args(sizeofType, ...) \</span></div>
<div class="line"><span class="preprocessor">  (sizeofType==1? sizeof((int8_t []){__VA_ARGS__}) / sizeof(int8_t ) : \</span></div>
<div class="line"><span class="preprocessor">   sizeofType==2? sizeof((int16_t[]){__VA_ARGS__}) / sizeof(int16_t) : \</span></div>
<div class="line"><span class="preprocessor">   sizeofType==4? sizeof((int32_t[]){__VA_ARGS__}) / sizeof(int32_t) : \</span></div>
<div class="line"><span class="preprocessor">                  sizeof((int64_t[]){__VA_ARGS__}) / sizeof(int64_t)), \</span></div>
<div class="line"><span class="preprocessor">  (sizeofType==1? (void*)(int8_t []){__VA_ARGS__} : \</span></div>
<div class="line"><span class="preprocessor">   sizeofType==2? (void*)(int16_t[]){__VA_ARGS__} : \</span></div>
<div class="line"><span class="preprocessor">   sizeofType==4? (void*)(int32_t[]){__VA_ARGS__} : \</span></div>
<div class="line"><span class="preprocessor">                  (void*)(int64_t[]){__VA_ARGS__})</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// select the correctly typed function from an array</span></div>
<div class="line"><span class="preprocessor">#define aExample(arr, ...) \</span></div>
<div class="line"><span class="preprocessor">  AARRAY_aExample_typed_functions[sizeof(*arr)](arr, \</span></div>
<div class="line"><span class="preprocessor">  AARRAY_Args(sizeof(*arr), __VA_ARGS__))</span></div>
</div><p>This code selects which function to call, then passes it both arrayLength, and the typecast array.<s> </s>It should get compile time reduced to a single function call</p>
<h3><a class="anchor" id="autotoc_md5"></a>
How can aArrays be zero-indexed c arrays and aArrays at the same time?</h3>
<p>In memory, a c array looks like <code>{item0, item1, item2, ...}</code></p>
<p>And an aArray looks like <code>{length, item0, item1, item2, ...}</code></p>
<p>Which can't be zero-indexed.<s> </s>But rather than returning a pointer to aArray's beginning, the api returns a pointer to <code>item0</code>;<s> </s>making it appear the same as an array, so long as realloc/free isn't used</p>
<p>Then when aArray needs to get an array's length;<s> </s>it simply moves the pointer back to the true beginning</p>
<h3><a class="anchor" id="autotoc_md6"></a>
How can arrays only store their length — what about their capacity?</h3>
<p>Capacity tells us the length each array can grow to.<s> </s>But this makes arrays larger;<s> </s>since an extra variable is needed</p>
<p>Happily capacity can be safely guessed from an array's length</p>
<p>The NOCAPACITY variant of aArrays does this by growing in a fixed progression.<s> </s>Their capacity is always one of 8, 16, 32, 64, 128, etc.<s> </s>This means we can assume a NOCAPACITY aArray is its length rounded up to the next number in the progression, i.e. a length of 7 means the aArray's capacity must be at least 8, while a length of 9 fits into a capacity of 16</p>
<p>If the NOCAPACITY aArray length drops a lot, then goes up a little;<s> </s>it may well cause a realloc;<s> </s>since the length now fits into a smaller capacity</p>
<p>You could call this an unnecessary realloc, or you could call <em>not</em> doing it an unnecessary waste of space</p>
<p>The default aArray does <em>not</em> do this:<s> </s>it stores and doubles capacity.<s> </s>Only reducing to smaller memory sizes with aMem</p>
<p> <a class="anchor" id="pingpong" name="pingpong"></a> </p>
<h3><a class="anchor" id="autotoc_md7"></a>
How does aSearch work?</h3>
<p>aSearch is standard binary search</p>
<p><code>aSearchP</code> though is arguably a new.<s> </s>I like to call it pingpong, because it works like table-tennis.<s> </s>The ball is secant — a poor man’s version of newton-raphson’s method — this bounces around, using the last two bounces (array lookups), to predict where it should bounce next</p>
<p>This normally finds the answer in less steps than binary search.<s> </s>But has the less than helpful property that it may also bounce for ever, or even bounce off the table.<s> </s>Pingpong solves this by adding two bats.<s> </s>These provide a reducing range, squeezing the ball in at every bounce; so it will always find an answer, and with less array lookups than secant alone</p>
<p>So pingpong uses many less array lookups than binary search...<s> </s>But also spends a lot longer deciding where to look...<s> </s>Which is faster in a real sense is a very hard question to answer</p>
<p>You would think that arrays of integers would be a worst case for pingpong — but even here 32bit integers can barely express a random enough distribution to throw off pingpong.<s> </s>Binary search is only a safe bet with very short arrays</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Tell me something fun</h3>
<p>aArray bootstraps itself with a cppp 'pre-pre-processor'.<s> </s>In no way related to ppap</p>
<p> <center><a href="https://vimeo.com/186404784"><img alt="silly film" src="//gratis.gitlab.io/aArray/cppp.jpg"/></a></center></p>
<p>Internally aArray functions are written out many times for each type.<s> </s>For instance aFold is written out 48 times:<s> </s>once for each array type * each return type * 3.<s> </s>The 3 because it can be passed a c function, block, or c++ lambda.<s> </s>This duplication is most easily done with macros</p>
<p>But when a syntax error occurs, the compiler would print out all of those macros — more than a little messy! — so <a class="info_link" href="//gitlab.com/gratis/cppp">cppp</a> pre-pre-processes them away before the compiler sees them</p>
<p>And since cppp is written using aArray.h, and aArray.h is written using <a class="info_link" href="//gitlab.com/gratis/cppp">cppp</a>, we have a bootstrap loop, which forms part of the unittests each time aArray is regenerated</p>
<p>Thought for compiler writers:<s> </s>a <code>#pragma silentmacro</code> would help improve error messages</p>
</div><div class="tab tab_hidden">
<center><img alt="std::sort is slower" class="inline" src="//gratis.gitlab.io/aArray/graph_sort.png"/></center><p>This shows the relative speed of different functions on macOS.<s> </s>They are tested against 10 different types of dataset, and the average score is taken.<s> </s>This is why qsort is slightly slower that mergesort.<s> </s>For datasets above 30000 items:<s> </s>mergesort becomes faster than aSort when the data is pre-ordered, and qsort becomes faster when the data has many duplicates.<s> </s>In general though aSort performs extremely well at all array lengths, and is the fastest across a range of datasets</p>
<p>It was written by <a class="info_link" href="https://github.com/BonzaiThePenguin/WikiSort">BonzaiThePenguin</a>.<s> </s>He's done seriously good work.<s> </s>It is a stable sort and operates in a fixed amount of memory</p>
<p><code>##define AARRAY_sortCache</code> fixes the memory to <code>512</code>, but you can redefine this to larger values;<s> </s>possibly improving aSort's performance for larger datasets <br/>
<br/>
</p>
<p>Now lets compare search using <code>bsearch</code> from Linux and BSD, and aSearch from aArray.<s> </s>The arrays graphed are of maximally random sorted integers.<s> </s>64bit and 32bit ints respectively</p>
<center> <s> </s><img alt="aSearch is fastest" class="inline" src="//gratis.gitlab.io/aArray/graph_64.png"/> <s> </s><img alt="aSearchP is fastest" class="inline" src="//gratis.gitlab.io/aArray/graph_32.png"/></center><p>I've profiled a range of situations and hardware, but the writers of the other algorithms will of done so aswell, so aSearch may look fast, but the difference with BSD is small</p>
<p><code>aSearchP</code> though does the worst in the first graph, and best in the second.<s> </s>Actually both graphs attempt to put it in the worst light possible...<s> </s>It is an algorithm I like to call <a class="info_link" href="#how" onclick="a_HOW.onclick(); document.getElementById('pingpong').scrollIntoView(); return false">pingpong</a> which should be worth using as arrays become longer, comparisons become slower, or as the dataset becomes more uniform</p>
<p>These graphs are of shorter arrays, and faster comparisons — the first graph using random <code>int64_t</code> integers, and the second random <code>int32_t</code>.<s> </s>Pingpong is still the fastest on the second, and easily fastest for <code>int16_t</code>.<s> </s> It is much better at searching less random distributions, such as pointers, rather than <code>rand()</code></p>
<p>Please be careful using a custom <code>cmp()</code> with either binary or pingpong.<s> </s>This is not safe:<s> </s><code>aSearchPF(array, &amp;index, key, ^(int a, int b){ return a-b; })</code>.<s> </s>See aSearchF for more details <br/>
<br/>
</p>
<p>If that was fun, I'd like to suggest an alternative search algorithm that I haven't implemented, but may be faster still:</p>
<p>Binary search jumps through large arrays in a set order.<s> </s>Each iteration loading disparate parts of the array into memory (which is slow).<s> </s>What you could do is reorder the array;<s> </s>not from lowest to highest;<s> </s>but into the order taken by binary search.<s> </s>It is still binary search, but the first index tested is no-longer the middle, but the first.<s> </s>The second index tested would be either the second or third.<s> </s>Then from the second it would test either the 4th or 5th, and from the third it would test either the 6th or 7th</p>
<p>As this sequence becomes longer than a cacheline, you would split off the child search locations into a new block (with that block still placed into the same array, but so the cachelines get minmally loaded, and maximally used)</p>
<p>I would be surprized if that was not faster than existing binary search — and 5 years later I find out that it is;<s> </s>3-5x faster, and called <a href="https://algorithmica.org/en/eytzinger">Eytzinger search</a> invented in the 16th century.<s> </s>Note the remaining difference.<s> </s>Binary is depth first order, Eytzinger is breadth fist, and we are breadth first, but in cacheline chunks.<s> </s>This would be a more complex algorithm, but giving 2-5 branches for every cacheline, whereas Eytzinger gets that for the first, and only single branches per cacheline thereafter... <br/>
<br/>
</p>
<p>In comparisons of aAppend v.s. <code>std::vector</code>, or <a class="info_link" href="https://attractivechaos.wordpress.com/2008/09/19/c-array-vs-c-vector/">kvec.h</a>, etc;<s> </s>gcc puts aArray equal with <code>std::vector</code> for <code>int64_t*</code> arrays, and ahead for <code>int16_t*</code> arrays.<s> </s>Sadly however clang gives aAppend a 13% slow down compared to gcc</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Latest features</h3>
<ul>
<li>2020 09 — removed need for maths.h</li>
<li>2020 07 — aCapacity added</li>
<li>2020 07 — fix aArray_NOCAPACITY lengths</li>
<li>2020 04 — aSort now defaults to unsigned ordering</li>
<li>2020 04 — Stride variant for pingpong search</li>
<li>2019 10 — fix printing "%i64" for <code>INT64_MIN</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
Missing features</h3>
<ul>
<li>aArray for 128bit integers? (Not doing)</li>
<li>Reduce macro usage? (Blows up size of aArray.h)</li>
</ul>
<p>No known bugs...</p>
<h3><a class="anchor" id="autotoc_md12"></a>
LICENSE</h3>
<p>The goal is not to limit, but to bless and benefit you as best I can</p>
<p>To that end, I place no restriction</p>
<p>Public domain.<s> </s>No restriction.<s> </s>No need to accredit</p>
<p>May the peace that passes understanding dwell in you.<s> </s>And you, rooted and grounded in love, may you know even the breadth length height and depth of his love for you, that surpasses knowledge – filling you to all the measure of the fullness of God</p>
<p>And to him who is able to do far more abundantly than all that we can ask or imagine, whatever you have faced and in every situation, may he protect you heart and your mind, unto eternity</p>
<h3><a class="anchor" id="autotoc_md13"></a>
NOCAPACITY</h3>
<p>NOCAPACITY functions stop arrays from tracking their capacity.<s> </s>This saves about 8 bytes per array and occasionally causes the array to resize, reducing its length</p>
<p>NOCAPACITY (and STATIC) functions are simply variants of aAppend, aReplace, aAppendArray, aReplaceArray, aDelete, aConcat, aMulti, aMem, aArray, and aFree (<code>aAppend_NOCAPACITY</code>, <code>aReplace_NOCAPACITY</code>, ...)</p>
<p>You cannot mix NOCAPACITY, STATIC and normal api functions on the same array.<s> </s>An array created with a NOCAPACITY function must continue to use them, until it is freed with <code>aFree_NOCAPACITY</code></p>
<h3><a class="anchor" id="autotoc_md14"></a>
STATIC</h3>
<p>Sometimes you may want to handle memory yourself.<s> </s>You can get this by using the <code>aAppend_STATIC</code> <code>aConcat_STATIC</code>, etc variants of the normal api functions</p>
<p>They throw <code>"out of capacity"</code> if the array would extend beyond the capacity set when they were created or last updated by <code>aArray_STATIC</code></p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>*arrSTATIC = aArray_STATIC(data, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2 + 4, <span class="keyword">true</span>);</div>
<div class="line">aAppend_STATIC(&amp;arrSTATIC, 1); <span class="comment">// throws "out of capacity"</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span>*arrSTATIC = aArray_STATIC(data, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2 + 4, <span class="keyword">true</span>);</div>
<div class="line">aLength2(arrSTATIC, 0);</div>
<div class="line">aAppend_STATIC(&amp;arrSTATIC, 1); <span class="comment">// this is fine</span></div>
</div><p>It is not safe to mix STATIC NOCAPACITY and normal functions on the same array</p>
<div class="fragment"><div class="line">aAppend_STATIC(&amp;arrSTATIC, 1, 2, 3, 4);</div>
<div class="line">aReplaceArray(&amp;arrSTATIC, 0, 1, 5, replacement); <span class="comment">// undetected memory corruption!!!</span></div>
</div><p>But you can convert between the array types, for instance with <code>aConcat</code> <code>aConcat_STATIC</code> and <code>aConcat_NOCAPACITY</code></p>
<h3><a class="anchor" id="autotoc_md15"></a>
AARRAY_NOTYPEOF</h3>
<p>aArray functions can return a mixture of types.<s> </s>Which would require manual type casting;<s> </s>but aArray assumes your compiler supports <code>__typeof</code> (or <code>__decltype</code> for c++).<s> </s>This allows the function's return type to be automatically fixed</p>
<p>If your compiler doesn't support <code>__typeof</code> or <code>__decltype</code>, then you can disable this automatic fixing with <code>##define AARRAY_NOTYPEOF</code></p>
<p>clang and gcc support <code>__typeof</code>, but will also sometimes emit warnings about unused returns.<s> </s>You can silence these warnings by placing (void) infront of the function, for instance</p>
<div class="fragment"><div class="line">(void)aAt2(somewhere, 1, over_the_rainbow);</div>
</div><h3><a class="anchor" id="autotoc_md16"></a>
AARRAY_WARN</h3>
<p>aArray functions can also recieve a mixture of types.<s> </s>Which would require manual type casting;<s> </s>aArray silences the specific clang and msvc warnings for just those parameters.<s> </s>But this is not possible for gcc.<s> </s>If you prefer to type cast manually for all compilers, then you can set <code>##define AARRAY_WARN</code></p>
<p>If you then have a lot of manual type casts, you may prefer <code>AARRAY_nowarn_start</code></p>
<h3><a class="anchor" id="autotoc_md17"></a>
AARRAY_nowarn_start</h3>
<p>Anything between <code>AARRAY_nowarn_start</code>/<code>AARRAY_nowarn_end</code> has their <code>C4047</code> differing level of indirection warning suppressed (for msvc), or <code>-Wconversion</code>, <code>-Wint-conversion</code>, <code>-Wpointer-to-int-cast</code>, and <code>-Wbad-function-cast</code> (for clang and gcc).<s> </s>They don't both need these, but it's simpler if they both get the same</p>
<p>This may save some casts when using gcc or <code>AARRAY_WARN</code></p>
<p>For example <code>bad-function-cast</code> is disabled even under <code>-Wall</code> and <code>-Wextra</code>.<s> </s>Enabling it has no effect on gcc but clang would then require <code>aAt(mystructs, N)-&gt;this</code> to be rewritten as <code>((mystruct)aAt((uintptr_t*)mystructs, N))-&gt;this</code></p>
<p>If compiling for clang with c++ then you may also want <code>AARRAY_nowarn_pedantic_cpp_start</code>/<code>AARRAY_nowarn_pedantic_cpp_end</code>.<s> </s>But in general don't use aArray with c++</p>
<p>aArray aims to use the same function calls for different array types, but c++ restricts function type casts.<s> </s>For instance <code>f(int)</code> to <code>f(unsigned int)</code>, and <code>f(char*)</code> to <code>f(void*)</code> is undefined behavior in c++.<s> </s>So while aArray does unittest for c++ conformity, it is not something I advise.<s> </s>Using c does not have this issue (or any other known UB, etc problems)</p>
<h3><a class="anchor" id="autotoc_md18"></a>
AARRAY_UNSAFE</h3>
<p>Defining this before including <code>aArray.h</code> removes the bounds and other safety checks, for a possible speed increase</p>
<h3><a class="anchor" id="autotoc_md19"></a>
AARRAY_c and AARRAY_h</h3>
<p><code>aArray.h</code> can be included as a single header.<s> </s>But if you prefer, it can also be a dual header/implementation pair</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include "aArray.h"</span></div>
</div><p>Becomes</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define AARRAY_h</span></div>
<div class="line"><span class="preprocessor">#include "aArray.h"</span></div>
</div><p>And a separately compiled <code>.c</code> file contains</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define AARRAY_c</span></div>
<div class="line"><span class="preprocessor">#include "aArray.h"</span></div>
</div><h3><a class="anchor" id="autotoc_md20"></a>
AARRAY_NOCONVENIENCE</h3>
<p>Under the assumption that you use aArray so much it becomes tiresome to see it everywhere, some mnemonics are defined for your convenience.<s> </s>These can be turned off with <code>##define AARRAY_NOCONVENIENCE</code></p>
<p>The most useful is probably <code>aStr("string")</code> which converts <code>"string"</code> into an aArray string.<s> </s>Note that the terminating <code>NULL</code> is dropped.<s> </s>This simplifies concatenation, but means you probably want to print them with aWrite, or aFmt with <code>"%v%c"</code>, or append <code>'\0'</code> by hand with <code>aA(&amp;str, '\0')</code></p>
<p>Also aMap aFilter aFold aLoop aSortF aSearchF  <code>aSearchPF</code> and aSearchPS can take either c-functions, <a class="info_link" href="https://stackoverflow.com/questions/5907071/clang-block-in-linux">blocks</a>, or c++ lambdas.<s> </s>They do this with their underlying <code>aMap_FUNC</code>, <code>aMap_BLOCK</code>, and <code>aMap_LAMBDA</code>.<s> </s>You can call them explicitly, or use aMap —<s> </s>which simply links to whichever of those is enabled by your compiler settings.<s> </s>So if blocks are enabled, but you are passing a c-function, you will need to be explicit and call <code>aMap_FUNC</code>, since aMap will link to <code>aMap_BLOCK</code></p>
<p>Then for those of us who like acronyms, there are:<br/>
<code>aA</code> → aAppend <br/>
<code>aR</code> → aReplace <br/>
<code>aAA</code> → aAppendArray <br/>
<code>aRA</code> → aReplaceArray <br/>
<code>aD</code> → aDelete <br/>
<code>aC</code> → aConcat <br/>
</p>
<p><code>aL</code> → aLength <br/>
<code>aL2</code> → aLength2 <br/>
<code>aZL2</code> → aZLength2 <br/>
</p>
<p><code>aF</code> → aFmt <br/>
<code>aFE</code> → aFmtE <br/>
<code>aFF</code> → aFmtF <br/>
<code>aFA</code> → aFmtA <br/>
<code>aW</code> → aWrite <br/>
<code>aWE</code> → aWriteE <br/>
<code>aWF</code> → aWriteF <br/>
</p>
<p>In the compiler I'm writing, 65.5% of function calls are from aArray.<s> </s>So this library is surprizingly useful;<s> </s>and the above acronyms help keep my code succinct</p>
</div><div class="tab tab_hidden">
<p>This would not of been possible without my family.<s> </s>I wouldn't even of begun programming without them.<s> </s>And thankyou to my lovely wife who is so generous to me</p>
<p>Many tools were used in creating aArray.<s> </s>Particularly helpful ones include <a class="info_link" href="https://www.crummy.com/software/BeautifulSoup/zine/">BeautifulSoup</a>, <a class="info_link" href="https://ninja-build.org/">ninja</a>, <a class="info_link" href="http://lcamtuf.coredump.cx/afl/">afl</a> (especially the rabbit photos), <a class="info_link" href="https://fossil-scm.org/index.html/doc/trunk/www/index.wiki">fossil</a> (safety+usability), <a class="info_link" href="https://www.dragonflybsd.org/">DragonFlyBSD</a>, and <a class="info_link" href="http://kakoune.org/">Kakoune</a></p>
<h3><a class="anchor" id="autotoc_md22"></a>
My life</h3>
<p>Our pastor imprisoned, for ‘attempting to overthrow the government’<s> </s><a class="info_link" href="/Joy_in_prison/">Joy in prison</a><br/>
 We could see them running around, screaming...<s> </s>There was nothing I could do<s> </s><a class="info_link" href="/Liras_rain/">Lira’s rain</a><br/>
 My first animated short, of some simple miracles<s> </s><a class="info_link" href="/Animation/">Animation</a><br/>
 Genesis is different.<s> </s>Vegetarianism explains why<s> </s><a class="info_link" href="/Creative_Snails/">Creative Snails</a><br/>
</p>
</div></div>
<div class="tabLinks" id="tabLinks2" style="margin-top:14px"><a>api</a> / <a>code</a></div>

</div></div>
<script>
'use strict';
var a_api, a_details, a_HOW;
var tabLinks = [], hashchange = false;
function openApi(e, id) {
  e && (e.preventDefault? e.preventDefault() : e.returnValue = false);
  a_api.onclick();
  document.getElementById(id).scrollIntoView(); }
function tabsInit(tabLinksElement, tabsElement) {
	var tabs = {'ts':[], 'tls':[]};
	var ts = tabsElement.childNodes; // all tabs
	var tls = tabLinksElement.childNodes; // all tab links
	// get all tab contents
	var n = -1; while(++n < ts.length)
		if(ts[n].nodeName && ts[n].className) tabs.ts[tabs.ts.length] = ts[n];
	// get and setup tab links
	function searchName(tabName) {
		return location.hash.search('(^[#]?|[|])'+tabName+'($|[|])')+1; }
	n = -1; while(++n < tls.length)
		if(tls[n].nodeName && tls[n].nodeName.toLowerCase()=='a') {
      if(tls[n].innerHTML=='api')          a_api  = tls[n];
      else if(tls[n].innerHTML=='details') a_details = tls[n];
      else if(tls[n].innerHTML=='how')     a_HOW = tls[n];
			tabs.tls[tabs.tls.length] = tls[n];
			if(tabs.tls.length!=1) tls[n].className = 'tab_hidden';
			tls[n].href = '#'+tls[n].innerHTML;
			tls[n].onclick = function(tName, tNum) { return function(e) {
				e && (e.preventDefault? e.preventDefault() : e.returnValue = false);
				var currIndex;
				n = -1; while(++n < tabs.ts.length) {
					currIndex = currIndex || searchName(tabs.tls[n].innerHTML);
					tabs.ts[n].className = n==tNum? 'tab' : 'tab tab_hidden';
					tabs.tls[n].className = n==tNum? '' : 'tab_hidden'; }
				if(!hashchange) {
					var hash = location.hash;
					var currEnd = hash.indexOf('|',currIndex);
					location.hash = !currIndex? hash+(hash==''||hash=='#'?'':'|')+tName :
					hash.substr(0,currIndex)+tName+
						hash.substr(currEnd!=-1?currEnd:hash.length); } }
				}(tls[n].innerHTML, tabs.tls.length-1); }
	// reflect location.hash on load and back/forward
	tabLinks[tabLinks.length] = tls;
	window.onload = window.onhashchange = function() {
		hashchange = true; // don't re-update hash, if we're responding to it's change!
		var o = -1; while(++o < tabLinks.length) {
			tls = tabLinks[o];
			var defaultTab = false;
			var n = -1; while(++n < tls.length)
				if(tls[n].nodeName && tls[n].nodeName.toLowerCase()=='a') {
					if(!defaultTab) { defaultTab = true; tls[n].onclick(); }
					if(searchName(tls[n].innerHTML)) { tls[n].onclick(); break; } } }
		hashchange = false; } }
tabsInit(document.getElementById("tabLinks1"),
				 document.getElementById("tabs1"));</script><center><div class="tabs" id="tabs2"><div class="tab"><table id="api_details"><tr><td style="vertical-align:top;padding-right:1px;width:18em"><table class="memberdecls">
<tr class="heading"><td class="memSeparator memSeparatorFirst" colspan="2"></td></tr>
<tr class="memitem:a1721d92a16bb460e751c4e8b9a0268fa"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, any items,...)</td></tr>
<tr class="separator:a1721d92a16bb460e751c4e8b9a0268fa"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:abb379a2ba01d1bb9df5085863ad1446b"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aReplace" onclick='openApi(event, "abb379a2ba01d1bb9df5085863ad1446b")'>aReplace</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos, size_t removeAmount, any items,...)</td></tr>
<tr class="separator:abb379a2ba01d1bb9df5085863ad1446b"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:afecf7b88904ae9544c07614dcda9c77e"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t arrayLen, any *array,...)</td></tr>
<tr class="separator:afecf7b88904ae9544c07614dcda9c77e"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a59f4d5837947f8698deb2cf930338120"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aReplaceArray" onclick='openApi(event, "a59f4d5837947f8698deb2cf930338120")'>aReplaceArray</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos, size_t removeAmount, size_t arrayLen, any *array,...)</td></tr>
<tr class="separator:a59f4d5837947f8698deb2cf930338120"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a6ae3873467b7a1136e2e2f798484dc4f"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aDelete" onclick='openApi(event, "a6ae3873467b7a1136e2e2f798484dc4f")'>aDelete</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos,<s> </s>size_t amount)</td></tr>
<tr class="separator:a6ae3873467b7a1136e2e2f798484dc4f"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a207bbe4f06b51dc2c61c3eb6d228f86d"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aConcat" onclick='openApi(event, "a207bbe4f06b51dc2c61c3eb6d228f86d")'>aConcat</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, any *next_aArray,...)</td></tr>
<tr class="separator:a207bbe4f06b51dc2c61c3eb6d228f86d"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a47ed221842f50569270592b851a27397"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aMulti" onclick='openApi(event, "a47ed221842f50569270592b851a27397")'>aMulti</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos, size_t removeAmount, size_t arrayTimes, size_t arrayLen, any *array,...)</td></tr>
<tr class="separator:a47ed221842f50569270592b851a27397"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aef683b4cc3f272a55c49bb86b95a5269"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aMem" onclick='openApi(event, "aef683b4cc3f272a55c49bb86b95a5269")'>aMem</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>)</td></tr>
<tr class="separator:aef683b4cc3f272a55c49bb86b95a5269"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a9cec018d74013281069e3ed554aa1bf8"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a> (any *memptr, size_t size, bool maximize)</td></tr>
<tr class="separator:a9cec018d74013281069e3ed554aa1bf8"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ae2b030b8b0118cad8d421d822a8606cb"><td align="right" class="memItemLeft" valign="top">void </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a> (any **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>)</td></tr>
<tr class="separator:ae2b030b8b0118cad8d421d822a8606cb"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a81ab7b775ff9e75887ce0130c22056b2"><td align="right" class="memItemLeft" valign="top">size_t </td><td class="memItemRight" valign="bottom"><a class="el" href="#aLength" onclick='openApi(event, "a81ab7b775ff9e75887ce0130c22056b2")'>aLength</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>)</td></tr>
<tr class="separator:a81ab7b775ff9e75887ce0130c22056b2"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a80a75832589e09b27fe42a18c6eb910a"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aLength2" onclick='openApi(event, "a80a75832589e09b27fe42a18c6eb910a")'>aLength2</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t len)</td></tr>
<tr class="separator:a80a75832589e09b27fe42a18c6eb910a"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aad02c49fad68e38453e626b53c43ac06"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aZLength2" onclick='openApi(event, "aad02c49fad68e38453e626b53c43ac06")'>aZLength2</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t len)</td></tr>
<tr class="separator:aad02c49fad68e38453e626b53c43ac06"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ade6b1ceac9e8864df5722221b4acedb9"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aCapacity" onclick='openApi(event, "ade6b1ceac9e8864df5722221b4acedb9")'>aCapacity</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>)</td></tr>
<tr class="separator:ade6b1ceac9e8864df5722221b4acedb9"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a0bcdd59cad846d545e81a427a6d4dda2"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos)</td></tr>
<tr class="separator:a0bcdd59cad846d545e81a427a6d4dda2"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:afcabf6e1c4f85fc6d44230f7312047ea"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aZAt" onclick='openApi(event, "afcabf6e1c4f85fc6d44230f7312047ea")'>aZAt</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos)</td></tr>
<tr class="separator:afcabf6e1c4f85fc6d44230f7312047ea"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aa7880698c43b2aa2025669a85ea36610"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aAt2" onclick='openApi(event, "aa7880698c43b2aa2025669a85ea36610")'>aAt2</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos, any newItem)</td></tr>
<tr class="separator:aa7880698c43b2aa2025669a85ea36610"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a940ffb61b0d5f4bccbb93b38311a9504"><td align="right" class="memItemLeft" valign="top">any </td><td class="memItemRight" valign="bottom"><a class="el" href="#aZAt2" onclick='openApi(event, "a940ffb61b0d5f4bccbb93b38311a9504")'>aZAt2</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos, any newItem)</td></tr>
<tr class="separator:a940ffb61b0d5f4bccbb93b38311a9504"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ab616bfdaadc66e7ac7b31ba8e4b927f5"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aAtPtr" onclick='openApi(event, "ab616bfdaadc66e7ac7b31ba8e4b927f5")'>aAtPtr</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos)</td></tr>
<tr class="separator:ab616bfdaadc66e7ac7b31ba8e4b927f5"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:abc34c6bbdb972d148d1bf592bcc44435"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aZAtPtr" onclick='openApi(event, "abc34c6bbdb972d148d1bf592bcc44435")'>aZAtPtr</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t pos)</td></tr>
<tr class="separator:abc34c6bbdb972d148d1bf592bcc44435"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a545fe4ed8ed104e08bf71be7fb582559"><td align="right" class="memItemLeft" valign="top">size_t </td><td class="memItemRight" valign="bottom"><a class="el" href="#aIndexOf" onclick='openApi(event, "a545fe4ed8ed104e08bf71be7fb582559")'>aIndexOf</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, any item)</td></tr>
<tr class="separator:a545fe4ed8ed104e08bf71be7fb582559"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ac85a536e905c1772bb32cd42eb8a2724"><td align="right" class="memItemLeft" valign="top">size_t </td><td class="memItemRight" valign="bottom"><a class="el" href="#aZIndexOf" onclick='openApi(event, "ac85a536e905c1772bb32cd42eb8a2724")'>aZIndexOf</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, any item)</td></tr>
<tr class="separator:ac85a536e905c1772bb32cd42eb8a2724"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:aa9ea2491a1286bd14253e20d0c59ecc9"><td align="right" class="memItemLeft" valign="top">void </td><td class="memItemRight" valign="bottom"><a class="el" href="#aMap" onclick='openApi(event, "aa9ea2491a1286bd14253e20d0c59ecc9")'>aMap</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, void(*f)(any *item)))</td></tr>
<tr class="separator:aa9ea2491a1286bd14253e20d0c59ecc9"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a62317fe5d6265e1a95d5220109e127b2"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFilter" onclick='openApi(event, "a62317fe5d6265e1a95d5220109e127b2")'>aFilter</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, int(*f)(any item))</td></tr>
<tr class="separator:a62317fe5d6265e1a95d5220109e127b2"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a6ff7d29306c4ae5aeb77dad007cb868c"><td align="right" class="memItemLeft" valign="top">anyB </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFold" onclick='openApi(event, "a6ff7d29306c4ae5aeb77dad007cb868c")'>aFold</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, anyB base, anyB(*f)(anyB base, any item))</td></tr>
<tr class="separator:a6ff7d29306c4ae5aeb77dad007cb868c"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:abd87e0288d84621334d45e6079cb6b4c"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aLoop" onclick='openApi(event, "abd87e0288d84621334d45e6079cb6b4c")'>aLoop</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t startPos, int(*f)(size_t pos))</td></tr>
<tr class="separator:abd87e0288d84621334d45e6079cb6b4c"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a5fbde75aabe1b19c50809dbfdb1eacb9"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aCmp" onclick='openApi(event, "a5fbde75aabe1b19c50809dbfdb1eacb9")'>aCmp</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, any *next_aArray,...)</td></tr>
<tr class="separator:a5fbde75aabe1b19c50809dbfdb1eacb9"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a4c532c1c1524d36e3d1ee0389655b81d"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aSort" onclick='openApi(event, "a4c532c1c1524d36e3d1ee0389655b81d")'>aSort</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>)</td></tr>
<tr class="separator:a4c532c1c1524d36e3d1ee0389655b81d"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ade3ffb620edccac219cb4f7355f5134f"><td align="right" class="memItemLeft" valign="top">any * </td><td class="memItemRight" valign="bottom"><a class="el" href="#aSortF" onclick='openApi(event, "ade3ffb620edccac219cb4f7355f5134f")'>aSortF</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, int(*f)(any *key, any *item))</td></tr>
<tr class="separator:ade3ffb620edccac219cb4f7355f5134f"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a9471781aebdbf0493d5e3cdeb4ce0354"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aSearch" onclick='openApi(event, "a9471781aebdbf0493d5e3cdeb4ce0354")'>aSearch</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t *index, any key)</td></tr>
<tr class="separator:a9471781aebdbf0493d5e3cdeb4ce0354"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a029408cace17bec6618c40696ccb2f57"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aSearchF" onclick='openApi(event, "a029408cace17bec6618c40696ccb2f57")'>aSearchF</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t *index, any key, int64_t(*f)(any key, any item))</td></tr>
<tr class="separator:a029408cace17bec6618c40696ccb2f57"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ad33bed1d0f5a4ef31d2c8100fd169f27"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aSearchPS" onclick='openApi(event, "ad33bed1d0f5a4ef31d2c8100fd169f27")'>aSearchPS</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, size_t *index, any *key, int64_t(*f)(any *key, any *item), size_t stride)</td></tr>
<tr class="separator:ad33bed1d0f5a4ef31d2c8100fd169f27"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:acf0052090f6334c8bf64964441deff8b"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a> (char *format,...)</td></tr>
<tr class="separator:acf0052090f6334c8bf64964441deff8b"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a50b69292634d3f2fcef642891232c2b4"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFmtE" onclick='openApi(event, "a50b69292634d3f2fcef642891232c2b4")'>aFmtE</a> (char *format,...)</td></tr>
<tr class="separator:a50b69292634d3f2fcef642891232c2b4"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:ada00598f6215ef46d2c5d4119b7e2a98"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFmtF" onclick='openApi(event, "ada00598f6215ef46d2c5d4119b7e2a98")'>aFmtF</a> (FILE *file, char *format,...)</td></tr>
<tr class="separator:ada00598f6215ef46d2c5d4119b7e2a98"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:aac211184b54c17d11b71a43714d4cfee"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aFmtA" onclick='openApi(event, "aac211184b54c17d11b71a43714d4cfee")'>aFmtA</a> (char **<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, char *format,...)</td></tr>
<tr class="separator:aac211184b54c17d11b71a43714d4cfee"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a5a5bdc6b4372bd7a39ffdb1aeea436a2"><td align="right" class="memItemLeft" valign="top">int </td><td class="memItemRight" valign="bottom"><a class="el" href="#aWrite" onclick='openApi(event, "a5a5bdc6b4372bd7a39ffdb1aeea436a2")'>aWrite</a> (any *<a class="el" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>,...)</td></tr>
<tr class="separator:a5a5bdc6b4372bd7a39ffdb1aeea436a2"><td class="memSeparator" colspan="2"> </td></tr>
<tr><td class="memSeparator" colspan="2"><div class="groupHeader"></div></td></tr>
<tr class="memitem:a9c7f6df8d34adbdd0a4887a38e3cfb23"><td align="right" class="memItemLeft" valign="top">void </td><td class="memItemRight" valign="bottom"><a class="el" href="#aError" onclick='openApi(event, "a9c7f6df8d34adbdd0a4887a38e3cfb23")'>aError</a> (char *errorLocation, char *errorMsg)</td></tr>
<tr class="separator:a9c7f6df8d34adbdd0a4887a38e3cfb23"><td class="memSeparator" colspan="2"> </td></tr>
</table></td><td><a id="a1721d92a16bb460e751c4e8b9a0268fa"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aAppend </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>items</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Appends one or more <code>items</code> to <code>aArray</code></p>
<p><code>any</code> represents any type other than <code>void</code> upto 8 bytes in width; be it <code>char</code>, <code>double</code>, <code>clock_t</code>, <code>FILE*</code>, <code>long long</code>, etc</p>
<p>If <code>aArray</code> is <code>NULL</code>, it will be initialized.<s> </s>A zero-length aArray is equivalent to a <code>NULL</code> aArray — as in api calls on either have the same effect.<s> </s>This should result in less <code>NULL</code> pointer checking, as it is a safe value</p>
<p><a class="el" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a> can take an arbitrary number of items.<s> </s>It is not necessary to give the number of arguments, or mark their end</p>
<dl class="section return"><dt>Returns</dt><dd>The aArray, with new <code>items</code> added.<s> </s>If the aArray had to be moved in memory (to accommodate the new items) then <code>*aArray</code> is also updated to point to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>
</td></tr>
</table>
</dd>
</dl>
<p>Exceptions are not c++ exceptions.<s> </s><code>"array type too wide"</code> is a compile-time error.<s> </s><code>"out of memory"</code> is passed to the <a class="el" href="#aError" onclick='openApi(event, "a9c7f6df8d34adbdd0a4887a38e3cfb23")'>aError</a> handler</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> *arr = NULL;</div><div class="line"><a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;arr, 1, 2);</div><div class="line"><a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;arr, 99, 100);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"{%v, %i}"</span>, arr); <span class="comment">// prints "{+1, +2, +99, +100}"</span></div></div><!-- fragment -->
</div>
</div><a id="abb379a2ba01d1bb9df5085863ad1446b"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aReplace </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>removeAmount</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>items</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Replaces <code>removeAmount</code> items at position <code>pos</code> in <code>aArray</code> with one or more <code>items</code></p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>, <code>"out of bounds"</code>, <code>"removal is out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *joy = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>**)NULL, 10, 5, 0, -5, -20);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"[%v, %u]"</span>, <a class="code" href="#aReplace" onclick='openApi(event, "abb379a2ba01d1bb9df5085863ad1446b")'>aReplace</a>(&amp;joy, 2, 3, 10, 20)); <span class="comment">// prints "[10, 5, 10, 20]"</span></div></div><!-- fragment -->
</div>
</div><a id="afecf7b88904ae9544c07614dcda9c77e"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aAppendArray </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>arrayLen</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>array</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Appends one or more <code>array</code>s to the end of <code>aArray</code></p>
<p><code>arrayLen</code> is the number of <code>array</code> items to be appended.<s> </s>If <code>arrayLen</code> is <code>SIZE_MAX</code> then <code>array</code> is appended upto but not including the first <code>NULL</code>.<s> </s>This makes it easy to append <code>char*</code> strings for instance</p>
<p>Multiple <code>array</code>s can be passed to <a class="el" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>;<s> </s>each <code>array</code> must be preceded by it's own <code>arrayLen</code></p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>, <code>"wrong arg count"</code>, <code>"array is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p>Three of those exceptions simply check parameter validity</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ages[3] = {0, 5, 10};</div><div class="line"><a class="code" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>((<span class="keywordtype">int</span>**)NULL,</div><div class="line">  3, ages,</div><div class="line">  3, ages,</div><div class="line">  2, (<span class="keywordtype">int</span>[]){12, 14}); <span class="comment">// (int*){0, 5, 10, 0, 5, 10, 12, 14}</span></div></div><!-- fragment --><p>There are convenience macros that abbreviate <code>aAppendArray</code> to <code>aAA</code> and for instance <code>aReplace</code> to <code>aR</code></p>
<p>You can switch them off by defining <code>AARRAY_NOCONVENIENCE</code>.<s> </s>But there is also an abbreviation of <code>aAppendArray</code> to <code>aStr</code>, which simplifies strings</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* hi = aStr(<span class="stringliteral">"hello world"</span>);</div><div class="line">aR(&amp;hi, 0, 1, <span class="charliteral">'j'</span>); <span class="comment">// "jello world"</span></div></div><!-- fragment -->
</div>
</div><a id="a59f4d5837947f8698deb2cf930338120"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aReplaceArray </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>removeAmount</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>arrayLen</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>array</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Replaces <code>removeAmount</code> items at position <code>pos</code> in <code>aArray</code> with one or more <code>array</code>s</p>
<p><code>arrayLen</code> is the number of <code>array</code> items to be inserted</p>
<p>Multiple <code>array</code>s can be passed;<s> </s>each must be preceded by it's own <code>arrayLen</code></p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>, <code>"out of bounds"</code>, <code>"removal is out of bounds"</code>, <code>"wrong arg count"</code>, <code>"array is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p>Passing repeats of <code>aArray</code>, or pointers into <code>aArray</code> are safe for all aArray manipulating functions, though the data is overwritten from left to right</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* nums = NULL;</div><div class="line"><a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;nums, 1, 2, 3, 4, 100);</div><div class="line"><a class="code" href="#aReplaceArray" onclick='openApi(event, "a59f4d5837947f8698deb2cf930338120")'>aReplaceArray</a>(&amp;nums, 2, 2,</div><div class="line">  1, nums,</div><div class="line">  2, <a class="code" href="#aAtPtr" onclick='openApi(event, "ab616bfdaadc66e7ac7b31ba8e4b927f5")'>aAtPtr</a>(nums, 1)); <span class="comment">// {1, 2, 1, 2, 1, 100}</span></div></div><!-- fragment -->
</div>
</div><a id="a6ae3873467b7a1136e2e2f798484dc4f"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aDelete </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"><s> </s>size_t </td>
<td class="paramname"><em>amount</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Deletes <code>amount</code> items from <code>aArray</code> at position <code>pos</code></p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>, <code>"removal is out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">long</span>* medalsWonBy_aArray = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">long</span>**)NULL, 15, 26, (<span class="keywordtype">long</span>)-1);</div><div class="line"><a class="code" href="#aDelete" onclick='openApi(event, "a6ae3873467b7a1136e2e2f798484dc4f")'>aDelete</a>(&amp;medalsWonBy_aArray, 0, 3);</div><div class="line"><span class="comment">// length of array is now sadly zero</span></div></div><!-- fragment -->
</div>
</div><a id="a207bbe4f06b51dc2c61c3eb6d228f86d"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aConcat </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>next_aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Appends one or more <code>next_aArray</code>s to the end of <code>aArray</code></p>
<p>Really this is a simple convenience – it does the same as <a class="el" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>, but without needing to specify each <code>next_aArray</code> length</p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* example = aStr(<span class="stringliteral">"A "</span>);</div><div class="line"><span class="keywordtype">char</span>* silly = aStr(<span class="stringliteral">"silly "</span>);</div><div class="line"></div><div class="line"><a class="code" href="#aConcat" onclick='openApi(event, "a207bbe4f06b51dc2c61c3eb6d228f86d")'>aConcat</a>(&amp;example, silly, silly, example, example);</div><div class="line"><span class="comment">// "A silly silly A A "</span></div></div><!-- fragment -->
</div>
</div><a id="a47ed221842f50569270592b851a27397"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aMulti </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>removeAmount</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>arrayTimes</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>arrayLen</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>array</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Other than making your code look complex, <a class="el" href="#aMulti" onclick='openApi(event, "a47ed221842f50569270592b851a27397")'>aMulti</a> lets you</p>
<ol type="1">
<li>Create un-initialized aArrays</li>
<li>Create aArrays with repeating items</li>
<li>Combine multiple aArray updates into a single step</li>
</ol>
<p><code>arrayTimes</code> is the amount of times to insert <code>arrayLen</code> from <code>array</code> into <code>aArray</code></p>
<p><s> </s>If <code>arrayTimes</code> is <code>0</code> then <code>arrayLen</code> un-initialized items will be inserted</p>
<dl class="section return"><dt>Returns</dt><dd>The updated aArray, and <code>*aArray</code> now pointing to it </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of memory"</code>, <code>"out of bounds"</code>, <code>"removal is out of bounds"</code>, <code>"wrong arg count"</code>, <code>"array is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="comment">// length=200, every item is 0</span></div><div class="line"><a class="code" href="#aMulti" onclick='openApi(event, "a47ed221842f50569270592b851a27397")'>aMulti</a>(&amp;data, 0, 0, 200, 1, (int8_t[]){0});</div><div class="line">  </div><div class="line"><span class="comment">// length=200, every item is uninitialized</span></div><div class="line"><a class="code" href="#aMulti" onclick='openApi(event, "a47ed221842f50569270592b851a27397")'>aMulti</a>(&amp;data, 0, 0, 0, 200, NULL);</div></div><!-- fragment --><p>Also</p>
<div class="fragment"><div class="line"><span class="comment">// Combine aArray updates reduced to a single call</span></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* va = NULL;</div><div class="line"><a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;va, 1, 2, 3);</div><div class="line"><a class="code" href="#aReplace" onclick='openApi(event, "abb379a2ba01d1bb9df5085863ad1446b")'>aReplace</a>(&amp;va, 0, 0, -2, -1, 0);</div><div class="line"><a class="code" href="#aReplaceArray" onclick='openApi(event, "a59f4d5837947f8698deb2cf930338120")'>aReplaceArray</a>(&amp;va, 1, 3, 1, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[]){5});</div><div class="line"><a class="code" href="#aDelete" onclick='openApi(event, "a6ae3873467b7a1136e2e2f798484dc4f")'>aDelete</a>(&amp;va, <a class="code" href="#aLength" onclick='openApi(event, "a81ab7b775ff9e75887ce0130c22056b2")'>aLength</a>(va)-1, 1);</div><div class="line"><span class="comment">// va now {-2, 5, 2}</span></div><div class="line"></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* vb = NULL;</div><div class="line"><a class="code" href="#aMulti" onclick='openApi(event, "a47ed221842f50569270592b851a27397")'>aMulti</a>(&amp;vb,</div><div class="line">  0, 0, 1, 3, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[]){1, 2, 3},</div><div class="line">  0, 0, 1, 3, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[]){-2, -1, 0},</div><div class="line">  1, 3, 1, 1, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[]){5},</div><div class="line">  3, 1, 0, 0, NULL);</div><div class="line"><span class="comment">// vb now {-2, 5, 2}, but done in one malloc</span></div></div><!-- fragment -->
</div>
</div><a id="aef683b4cc3f272a55c49bb86b95a5269"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aMem </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Converts <code>aArray</code> to a typed memory pointer</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to aArray's memory </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="comment">// shrink memory to arr length</span></div><div class="line"><span class="keywordtype">size_t</span> limit = <span class="keyword">sizeof</span>(size_t)*2 + aL(arr);</div><div class="line">arr = <a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>(realloc(<a class="code" href="#aMem" onclick='openApi(event, "aef683b4cc3f272a55c49bb86b95a5269")'>aMem</a>(arr), limit), limit, <span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">// manipulate memory</span></div><div class="line"><span class="keywordtype">size_t</span> length;</div><div class="line"><span class="keywordtype">char</span>*data = serialize(<a class="code" href="#aMem" onclick='openApi(event, "aef683b4cc3f272a55c49bb86b95a5269")'>aMem</a>(arr), &amp;length);</div><div class="line">arr = deserialize(<a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>(data, length, <span class="keyword">false</span>));</div></div><!-- fragment -->
</div>
</div><a id="a9cec018d74013281069e3ed554aa1bf8"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aArray </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>memptr</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>size</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">bool </td>
<td class="paramname"><em>maximize</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Converts type-cast <code>memptr</code> of length <code>size</code> into an aArray</p>
<p>If <code>maximize</code> or aArray would overflow, then it's length is set to the maximum within <code>size</code></p>
<p>This allows the STATIC variant of aArrays to resize, or for aArrays to be backed by mmap, aalloc, etc</p>
<dl class="section return"><dt>Returns</dt><dd>an any* aArray </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"array is NULL"</code>, <code>"out of capacity"</code>
</td></tr>
</table>
</dd>
</dl>
<p>Default and STATIC aArrays require an extra <code>sizeof(size_t)*2</code> bytes.<s> </s>NOCAPACITY aArrays require an extra <code>sizeof(size_t)</code> bytes.<s> </s>The "out of capacity exception" is for when these minimums are not met</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>*x = <a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>((<span class="keywordtype">char</span>*)malloc(200), 200, <span class="keyword">true</span>);</div><div class="line">aF(<span class="stringliteral">"%uz"</span>, aL(x)); <span class="comment">// prints 184</span></div><div class="line">aF(<span class="stringliteral">"%c"</span>, <a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(x, 0)); <span class="comment">// prints uninitialized byte</span></div><div class="line">free(<a class="code" href="#aMem" onclick='openApi(event, "aef683b4cc3f272a55c49bb86b95a5269")'>aMem</a>(x));</div><div class="line"></div><div class="line"><span class="comment">// STATIC aArrays do not realloc,</span></div><div class="line"><span class="comment">// instead they throw "out of capacity"</span></div><div class="line">x = aArray_STATIC((<span class="keywordtype">char</span>*)malloc(1000), <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2 + 3, <span class="keyword">false</span>);</div><div class="line">aL2(x, 0); <span class="comment">// length now 0</span></div><div class="line">aAppend_STATIC(&amp;x, 1, 2, 3); <span class="comment">// at max length</span></div><div class="line"></div><div class="line"><span class="comment">// set capacity to 4</span></div><div class="line">x = aArray_STATIC(<a class="code" href="#aMem" onclick='openApi(event, "aef683b4cc3f272a55c49bb86b95a5269")'>aMem</a>(x), <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2 + 4, <span class="keyword">false</span>);</div><div class="line"><span class="keywordflow">if</span>(aL(x)==3) aAppend_STATIC(&amp;x, 4); <span class="comment">// [1, 2, 3, 4]</span></div></div><!-- fragment -->
</div>
</div><a id="ae2b030b8b0118cad8d421d822a8606cb"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">void aFree </td>
<td>(</td>
<td class="paramtype">any ** </td>
<td class="paramname"><em>aArray</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Frees <code>aArray</code>, setting <code>*aArray</code> to <code>NULL</code></p>
<dl class="section note"><dt>Note</dt><dd>I used to forget <code>&amp;</code> de-referencing the pointer to <code>aArray</code>, so now it forces a compiler error</dd></dl>
<div class="fragment"><div class="line">any* myArr = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((any**)NULL, <span class="charliteral">'x'</span>);</div><div class="line"><a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;myArr); <span class="comment">// myArr is now NULL</span></div></div><!-- fragment -->
</div>
</div><a id="a81ab7b775ff9e75887ce0130c22056b2"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">size_t aLength </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>The length of <code>aArray</code></dd></dl>
<p><code>aLength(nullvar)</code> returns <code>0</code> — since <code>NULL</code> is considered equivalent to a zero-length aArray </p>
</div>
</div><a id="a80a75832589e09b27fe42a18c6eb910a"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aLength2 </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>len</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Sets <code>aArray</code> length to an equal or shorter <code>len</code></p>
<dl class="section return"><dt>Returns</dt><dd>The last item still in <code>aArray</code>.<s> </s>I.e. <code>aArray[len-1]</code>, or <code>0</code> if <code>len</code> is <code>0</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* fib = NULL; <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;fib, 1, 1, 2, 3, 5);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"Prev fib = %uz"</span>, <a class="code" href="#aLength2" onclick='openApi(event, "a80a75832589e09b27fe42a18c6eb910a")'>aLength2</a>(fib, <a class="code" href="#aLength" onclick='openApi(event, "a81ab7b775ff9e75887ce0130c22056b2")'>aLength</a>(fib)-1));</div><div class="line"><span class="comment">// fib length reduced by one, and 3 printed</span></div><div class="line">  </div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nlen = %uz"</span>, <a class="code" href="#aLength" onclick='openApi(event, "a81ab7b775ff9e75887ce0130c22056b2")'>aLength</a>(fib)); <span class="comment">// 4</span></div><div class="line"><a class="code" href="#aLength2" onclick='openApi(event, "a80a75832589e09b27fe42a18c6eb910a")'>aLength2</a>(fib, 2);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nlen = %uz"</span>, <a class="code" href="#aLength" onclick='openApi(event, "a81ab7b775ff9e75887ce0130c22056b2")'>aLength</a>(fib)); <span class="comment">// 2</span></div></div><!-- fragment -->
</div>
</div><a id="aad02c49fad68e38453e626b53c43ac06"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aZLength2 </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>len</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Reduces <code>aArray</code> length by <code>len</code></p>
<dl class="section return"><dt>Returns</dt><dd>The last item still in <code>aArray</code>.<s> </s>I.e. <code>aArray[new_length-1]</code>, or <code>0</code> if new length would be <code>0</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<p><code>aZL2(array, 1)</code> abbreviates <a class="el" href="#aZLength2" onclick='openApi(event, "aad02c49fad68e38453e626b53c43ac06")'>aZLength2</a> and is a variation on "`pop()`".</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* fib = NULL; <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;fib, 1, 1, 2, 3, 12);</div><div class="line"><a class="code" href="#aZLength2" onclick='openApi(event, "aad02c49fad68e38453e626b53c43ac06")'>aZLength2</a>(fib, 1); <span class="comment">// removes 12</span></div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"last item = %u"</span>, <a class="code" href="#aZLength2" onclick='openApi(event, "aad02c49fad68e38453e626b53c43ac06")'>aZLength2</a>(fib, 1)); <span class="comment">// removes 3, prints 'last item = 2'</span></div></div><!-- fragment -->
</div>
</div><a id="ade6b1ceac9e8864df5722221b4acedb9"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aCapacity </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>The capacity of <code>aArray</code></dd></dl>
<div class="fragment"><div class="line"><span class="comment">// 2*sizeof(size_t) is where aArray stores capacity+length</span></div><div class="line"><span class="keywordtype">size_t</span> size = 15 + 2*<span class="keyword">sizeof</span>(size_t);</div><div class="line"><span class="keywordtype">char</span>* blah = <a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>((<span class="keywordtype">char</span>*)malloc(size), size, <span class="keyword">true</span>);</div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, <a class="code" href="#aCapacity" onclick='openApi(event, "ade6b1ceac9e8864df5722221b4acedb9")'>aCapacity</a>(blah)); <span class="comment">// 15</span></div><div class="line">aL2(blah, 3); <span class="comment">// aka aLength2</span></div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, <a class="code" href="#aCapacity" onclick='openApi(event, "ade6b1ceac9e8864df5722221b4acedb9")'>aCapacity</a>(blah)); <span class="comment">// 15</span></div><div class="line"><a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;blah);</div><div class="line"></div><div class="line">blah = aArray_STATIC((<span class="keywordtype">char</span>*)malloc(size), size, <span class="keyword">true</span>);</div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, aCapacity_STATIC(blah)); <span class="comment">// 15</span></div><div class="line">aL2(blah, 3);</div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, aCapacity_STATIC(blah)); <span class="comment">// 15</span></div><div class="line">aFree_STATIC(&amp;blah);</div><div class="line"></div><div class="line">size = 15 + <span class="keyword">sizeof</span>(size_t);</div><div class="line">blah = aArray_NOCAPACITY((<span class="keywordtype">char</span>*)malloc(size), size, <span class="keyword">true</span>);</div><div class="line"><span class="comment">// capacity is lowest power-of-two that fits</span></div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, aCapacity_NOCAPACITY(blah)); <span class="comment">// 8</span></div><div class="line">aL2(blah, 3);</div><div class="line">aFA(&amp;out, <span class="stringliteral">"%uz "</span>, aCapacity_NOCAPACITY(blah)); <span class="comment">// 4</span></div><div class="line">aFree_NOCAPACITY(&amp;blah);</div></div><!-- fragment -->
</div>
</div><a id="a0bcdd59cad846d545e81a427a6d4dda2"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aAt </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>The item at position <code>pos</code> in <code>aArray</code>, indexing from zero </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<p>A <code>pos</code> past the end of <code>aArray</code> throws an exception.<s> </s>Otherwise <code>aArray[pos]</code> is identical</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* equal = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>);</div><div class="line"><span class="comment">// NOTE: cast not needed if your compiler has __typeof or __decltype</span></div><div class="line"><span class="keywordflow">if</span>(equal[0] == (<span class="keywordtype">char</span>)<a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(equal, 0)) printf(<span class="stringliteral">"equal"</span>); <span class="comment">// "equal"</span></div></div><!-- fragment -->
</div>
</div><a id="afcabf6e1c4f85fc6d44230f7312047ea"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aZAt </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>The item at position <code>pos</code> from the end of <code>aArray</code>, indexing from zero </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<p>A <code>pos</code> past the beginning of <code>aArray</code> throws an exception</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* letters = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'r'</span>, <span class="charliteral">'t'</span>);</div><div class="line"><a class="code" href="#aReplace" onclick='openApi(event, "abb379a2ba01d1bb9df5085863ad1446b")'>aReplace</a>(&amp;letters, 0, 0, <a class="code" href="#aZAt" onclick='openApi(event, "afcabf6e1c4f85fc6d44230f7312047ea")'>aZAt</a>(letters, 0));</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"%v %c"</span>, letters); <span class="comment">// "t a r t"</span></div></div><!-- fragment -->
</div>
</div><a id="aa7880698c43b2aa2025669a85ea36610"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aAt2 </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>newItem</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Sets the item at position <code>pos</code> in <code>aArray</code> to <code>newItem</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>newItem</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* letters = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>);</div><div class="line"><a class="code" href="#aAt2" onclick='openApi(event, "aa7880698c43b2aa2025669a85ea36610")'>aAt2</a>(letters, 1, <span class="charliteral">'d'</span>); <span class="comment">// ['a', 'd']</span></div></div><!-- fragment -->
</div>
</div><a id="a940ffb61b0d5f4bccbb93b38311a9504"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any aZAt2 </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>newItem</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Sets the item at position <code>pos</code> from the end of <code>aArray</code> to <code>newItem</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>newItem</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* letters = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>);</div><div class="line"><a class="code" href="#aZAt2" onclick='openApi(event, "a940ffb61b0d5f4bccbb93b38311a9504")'>aZAt2</a>(letters, 0, <span class="charliteral">'d'</span>); <span class="comment">// 'a', 'd'</span></div></div><!-- fragment -->
</div>
</div><a id="ab616bfdaadc66e7ac7b31ba8e4b927f5"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aAtPtr </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>A pointer to the item at position <code>pos</code> in <code>aArray</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* equal = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>);</div><div class="line"><span class="comment">// NOTE: casts not needed if your compiler has __typeof or __decltype</span></div><div class="line">*(<span class="keywordtype">char</span>*)<a class="code" href="#aAtPtr" onclick='openApi(event, "ab616bfdaadc66e7ac7b31ba8e4b927f5")'>aAtPtr</a>(equal, 0) = <span class="charliteral">'b'</span>;</div><div class="line"><span class="keywordflow">if</span>(equal[0] == (<span class="keywordtype">char</span>)<a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(equal, 1)) <a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"equal"</span>); <span class="comment">// "equal"</span></div></div><!-- fragment -->
</div>
</div><a id="abc34c6bbdb972d148d1bf592bcc44435"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aZAtPtr </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>pos</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>A pointer to the item at position <code>pos</code> from the end of <code>aArray</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"out of bounds"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* letters = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'n'</span>, <span class="charliteral">'o'</span>, <span class="charliteral">'\0'</span>);</div><div class="line">*(<span class="keywordtype">char</span>*)<a class="code" href="#aZAtPtr" onclick='openApi(event, "abc34c6bbdb972d148d1bf592bcc44435")'>aZAtPtr</a>(letters, 2) = <span class="charliteral">'l'</span>;</div><div class="line">printf(letters); <span class="comment">// "lo"</span></div></div><!-- fragment -->
</div>
</div><a id="a545fe4ed8ed104e08bf71be7fb582559"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">size_t aIndexOf </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>item</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Finds the first index of <code>item</code> in <code>aArray</code></p>
<dl class="section return"><dt>Returns</dt><dd>first index of <code>item</code> in <code>aArray</code>, or <code>-1</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* PPS_array = <a class="code" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>((<span class="keywordtype">int</span>**)NULL, numPidgeons, pidgeonPeckSpeed_data);</div><div class="line"><a class="code" href="#aIndexOf" onclick='openApi(event, "a545fe4ed8ed104e08bf71be7fb582559")'>aIndexOf</a>(PPS_array, 200); <span class="comment">// first occuring pidgeon with a peck speed of 200</span></div></div><!-- fragment -->
</div>
</div><a id="ac85a536e905c1772bb32cd42eb8a2724"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">size_t aZIndexOf </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>item</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Finds the last index of <code>item</code> in <code>aArray</code></p>
<dl class="section return"><dt>Returns</dt><dd>last index of <code>item</code> in <code>aArray</code>, or <code>-1</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* PPS_array = <a class="code" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>((<span class="keywordtype">int</span>**)NULL, numPidgeons, pidgeonPeckSpeed_data);</div><div class="line"><a class="code" href="#aZIndexOf" onclick='openApi(event, "ac85a536e905c1772bb32cd42eb8a2724")'>aZIndexOf</a>(PPS_array, 190); <span class="comment">// last occuring pidgeon with a peck speed of 190</span></div></div><!-- fragment -->
</div>
</div><a id="aa9ea2491a1286bd14253e20d0c59ecc9"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">void aMap </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">void(*)(any *item) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Apply <code>f</code> to every item in <code>aArray</code></p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<p>Optionally use:<s> </s><code>void aMap(any*, void(*f)(any*,void*data), void*data)</code></p>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p>There are actually 3 api functions here.<s> </s><code>aMap_BLOCK</code>, <code>aMap_LAMBDA</code>, <code>aMap_FUNC</code>.<s> </s><code>aMap</code> simply maps to the first of those available.<s> </s>If the environment has blocks, then <code>aMap_BLOCK</code>, otherwise if lambdas, then <code>aMap_LAMBDA</code>, and otherwise <code>aMap_FUNC</code>.<s> </s>You can always call the specific function directly if you prefer</p>
<p><code>aFilter</code>, <code>aFold</code>, and <code>aLoop</code> handle blocks, lambdas, and function-pointers in the same way</p>
<div class="fragment"><div class="line"><span class="comment">// ride every pony!</span></div><div class="line">pony**my_little_ponies = ...;</div><div class="line">void (*ride_a_pony)(pony**) = oh_what_fun_function;</div><div class="line">aMap_FUNC(my_little_ponies, ride_a_pony);</div><div class="line"></div><div class="line"><span class="keywordtype">char</span>*rider_says = <span class="stringliteral">"Yesss!"</span>;</div><div class="line">aMap_BLOCK(my_little_ponies,</div><div class="line">  ^(pony**p, <span class="keywordtype">void</span>*data){</div><div class="line">    printf(<span class="stringliteral">"ride %s? %s"</span>, (*p)-&gt;name, (<span class="keywordtype">char</span>*)data); },</div><div class="line">  rider_says);</div></div><!-- fragment -->
</div>
</div><a id="a62317fe5d6265e1a95d5220109e127b2"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aFilter </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">int(*)(any item) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Apply <code>f</code> to every item in <code>aArray</code>.<s> </s>Keep the <code>item</code> in <code>aArray</code> if <code>f</code> returns <code>true</code></p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<p>Optionally use:<s> </s><code>any* aFilter(any*, int(*f)(any,void*data), void*data)</code></p>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* n1 = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">int</span>**)NULL, 4,5,6,7,8);</div><div class="line">aFilter_FUNC(n1, isEven);  <span class="comment">// n1 = [4,6,8]</span></div><div class="line">aFilter_BLOCK(n1, ^(<span class="keywordtype">int</span> item){ <span class="keywordflow">return</span> item &gt; 5; });  <span class="comment">// n1 = [6,8]</span></div><div class="line">aFilter_LAMBDA(n1, [](<span class="keywordtype">int</span> item){ <span class="keywordflow">return</span> item != 8; });  <span class="comment">// n1 = [6]</span></div></div><!-- fragment -->
</div>
</div><a id="a6ff7d29306c4ae5aeb77dad007cb868c"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">anyB aFold </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">anyB </td>
<td class="paramname"><em>base</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">anyB(*)(anyB base, any item) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Do <code>base = f(base, item)</code> for every item in <code>aArray</code></p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<p>Optionally use:<s> </s><code>anyB aFold(any*, anyB, anyB(*f)(anyB,any,void*data), void*data)</code></p>
<dl class="section return"><dt>Returns</dt><dd>the final <code>base</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p>This is a nice simple way to combine every item of an aArray into a single result</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* numbers = <a class="code" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>((<span class="keywordtype">int</span>**)NULL, 10, numbersArray);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nSum     = %u64"</span>, aFold_FUNC(numbers, 0, add_function, NULL));</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nProduct = %u64"</span>, aFold_BLOCK(numbers, (<span class="keywordtype">size_t</span>)1, ^(<span class="keywordtype">size_t</span> base, <span class="keywordtype">int</span> item){ <span class="keywordflow">return</span> base*item; }));</div><div class="line"></div><div class="line"><span class="keyword">auto</span> f = [](<span class="keywordtype">bool</span> base, <span class="keywordtype">int</span> item) { <span class="keywordflow">return</span> base&amp;&amp;item; };</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nAllTrue = %u8"</span>, (uintptr_t)aFold_LAMBDA(numbers, <span class="keyword">true</span>, f));</div><div class="line"></div><div class="line"><span class="keywordtype">char</span>* baseB = NULL;</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"\nString  = %v%c"</span>, *aFold_BLOCK(numbers, &amp;baseB,</div><div class="line">  ^(<span class="keywordtype">char</span>** baseBPtr, <span class="keywordtype">int</span> item){ (void)<a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(baseBPtr, (<span class="keywordtype">char</span>)(item+64)); <span class="keywordflow">return</span> baseBPtr; }));</div></div><!-- fragment -->
</div>
</div><a id="abd87e0288d84621334d45e6079cb6b4c"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aLoop </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>startPos</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">int(*)(size_t pos) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>This is a while loop that hopefully keeps your code safer and cleaner</p>
<p>Starting from <code>startPos</code>, and until out of bounds, or <code>f</code> returns <code>0</code>, do <code>pos += f(pos)</code></p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<p>Optionally use:<s> </s><code>int aLoop(any*, size_t, int(*f)(size_t,void*data), void*data)</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>f</code>'s last returned value </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p><code>aLoop</code> handles the rarer issues of integer sign conversion and overflow at <code>pos += f(pos)</code>; aswell as buffer overflow.<s> </s>With blocks it becomes: </p><div class="fragment"><div class="line"><a class="code" href="#aLoop" onclick='openApi(event, "abd87e0288d84621334d45e6079cb6b4c")'>aLoop</a>(<a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>, startPos, ^(<span class="keywordtype">size_t</span> pos){</div><div class="line">  <span class="comment">// do my stuff</span></div><div class="line">  return deltaPos; } );</div></div><!-- fragment --> <div style="margin-top:14px">For instance:</div> <div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* a = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>**)NULL, 1, 2, 3, 4);</div><div class="line"></div><div class="line"><span class="comment">// print index 0 and 2</span></div><div class="line"><a class="code" href="#aLoop" onclick='openApi(event, "abd87e0288d84621334d45e6079cb6b4c")'>aLoop</a>(a, 0, ^(<span class="keywordtype">size_t</span> n) {</div><div class="line">  <span class="comment">// (uintptr_t) cast here even for clang, because it can miss _Pragmas</span></div><div class="line">  aFmt((uintptr_t)<span class="stringliteral">"a[%ull] == %ui\n"</span>, n, <a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(a, n)); <span class="keywordflow">return</span> 2; });</div><div class="line"></div><div class="line"><span class="comment">// print index 3 and 1, then set them to new values</span></div><div class="line"><a class="code" href="#aLoop" onclick='openApi(event, "abd87e0288d84621334d45e6079cb6b4c")'>aLoop</a>(a, 3, ^(<span class="keywordtype">size_t</span> n){</div><div class="line">  aFmt((uintptr_t)<span class="stringliteral">"Doing a[%ull] = %ui\n"</span>, n, <a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(a, n-1));</div><div class="line">  (<span class="keywordtype">void</span>)<a class="code" href="#aAt2" onclick='openApi(event, "aa7880698c43b2aa2025669a85ea36610")'>aAt2</a>(a, n, <a class="code" href="#aAt" onclick='openApi(event, "a0bcdd59cad846d545e81a427a6d4dda2")'>aAt</a>(a, n-1));</div><div class="line">  return -2; }); <span class="comment">// a becomes {1, 1, 3, 3}</span></div></div><!-- fragment -->
</div>
</div><a id="a5fbde75aabe1b19c50809dbfdb1eacb9"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aCmp </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>next_aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Compares <code>aArray</code> against one or more <code>next_Array</code>s</p>
<p>The <code>any</code> type width is assumed to be the same – i.e. both <code>char*</code>, or <code>short*</code>, etc</p>
<dl class="section return"><dt>Returns</dt><dd><code>1</code> if equal, <code>0</code> otherwise </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span></div><div class="line">  *black = NULL,</div><div class="line">  *white = NULL;</div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="#aCmp" onclick='openApi(event, "a5fbde75aabe1b19c50809dbfdb1eacb9")'>aCmp</a>(black, white)) <a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"We are all family"</span>);</div></div><!-- fragment -->
</div>
</div><a id="a4c532c1c1524d36e3d1ee0389655b81d"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aSort </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Orders array items as ascending unsigned integers</p>
<dl class="section return"><dt>Returns</dt><dd>The re-ordered array </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<p>Requires <code>&lt;math.h&gt;</code> linking for the sqrt function</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>* filmBoredomLevel = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">int</span>**)NULL, 300, 600, 200, 100);</div><div class="line"><a class="code" href="#aSort" onclick='openApi(event, "a4c532c1c1524d36e3d1ee0389655b81d")'>aSort</a>(filmBoredomLevel);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"[%v, %ui]"</span>, filmBoredomLevel); <span class="comment">// prints "[100, 200, 300, 600]"</span></div></div><!-- fragment -->
</div>
</div><a id="ade3ffb620edccac219cb4f7355f5134f"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">any* aSortF </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">int(*)(any *key, any *item) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Orders array items according to the function <code>f</code></p>
<p><code>f</code> must return true/false, i.e. using <code>&lt;</code> or <code>&gt;</code></p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<dl class="section return"><dt>Returns</dt><dd>The re-ordered array </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> sort_strcmp(<span class="keywordtype">char</span>*a, <span class="keywordtype">char</span>*b) { <span class="keywordflow">return</span> strcmp(a,b) &lt; 0; }</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keywordtype">char</span>** verses = NULL;</div><div class="line"><a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>(&amp;verses, <span class="stringliteral">"There is no greater love"</span>, <span class="stringliteral">"You are my beloved"</span>, <span class="stringliteral">"Because of His great love"</span>);</div><div class="line">aSortF_FUNC(verses, sort_strcmp);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"%v\n%s"</span>, verses);</div></div><!-- fragment -->
</div>
</div><a id="a9471781aebdbf0493d5e3cdeb4ce0354"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aSearch </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t * </td>
<td class="paramname"><em>index</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>key</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Searches a sorted <code>aArray</code> for <code>key</code></p>
<p>If <code>key</code> is present, then <code>index</code> is set to its position, otherwise <code>index</code> is set to the last searched position.<s> </s>Where <code>key==2</code>, and <code>aArray</code> is <code>[2, 2]</code> or <code>[1, 3]</code>:<s> </s><code>index</code> will be set to either <code>0</code> or <code>1</code>, since both answers are correct</p>
<p>The <code>aArray</code> items must be ordered as ascending unsigned integers</p>
<dl class="section return"><dt>Returns</dt><dd><code>1</code> if <code>key</code> found, <code>0</code> otherwise.<s> </s>And updates <code>*index</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<p><code>aSearchP</code> is an alternative to @aSearch that uses <a class="info_link" href="#how" onclick="a_HOW.onclick(); document.getElementById('pingpong').scrollIntoView(); return false">pingpong</a>, rather than binary search.<s> </s>It's here for your enjoyment</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> index;</div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="#aSearch" onclick='openApi(event, "a9471781aebdbf0493d5e3cdeb4ce0354")'>aSearch</a>(filmBoredomLevel, &amp;index, 600))</div><div class="line">  printf(<span class="stringliteral">"Most boring film 'Peppa Pig Goes on Holiday' is at index %zu"</span>, index);</div></div><!-- fragment -->
</div>
</div><a id="a029408cace17bec6618c40696ccb2f57"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aSearchF </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t * </td>
<td class="paramname"><em>index</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any </td>
<td class="paramname"><em>key</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">int64_t(*)(any key, any item) </td>
<td class="paramname"><em>f</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Searches a sorted <code>aArray</code> for <code>key</code></p>
<p>If <code>key</code> is present, then <code>index</code> is set to its position, otherwise <code>index</code> is set to the last searched position</p>
<p><code>f</code> can be a block, c++11 lambda, or function-pointer</p>
<p><code>f</code> must return less than, equal, or greater than 0, as <code>item</code> is less than, equal, or greater than <code>key</code>.<s> </s>It is common to see examples such as <code>aSearchF(arr, &amp;i, 5, ^(int a, int b){ return a-b; })</code>.<s> </s>But this is incorrect, as the difference <code>a-b</code> is an <code>unsigned int</code>, and so overflows the sign bit.<s> </s>Either use an if statment, or cast to a larger <code>int</code>, i.e. <code>^(int a, int b){ return ((int64_t)a - (int64_t)b); }</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>1</code> if <code>key</code> found, <code>0</code> otherwise.<s> </s>And updates <code>*index</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<p><code>aSearchPF</code> is an alternative to <code>aSearchF</code> that uses <a class="info_link" href="#how" onclick="a_HOW.onclick(); document.getElementById('pingpong').scrollIntoView(); return false">pingpong</a>, rather than binary search</p>
<p>For <code>aSearchPF</code>, <code>f</code> should return the degree of difference, i.e. <code>item - key</code>.<s> </s>Note that <code>strcmp</code> does this, but it is not a great example as it only returns a byte of difference.<s> </s>The same sign bit overflow issue applies</p>
<div class="fragment"><div class="line">int64_t search_strcmp(<span class="keywordtype">char</span>*a, <span class="keywordtype">char</span>*b) { <span class="keywordflow">return</span> strcmp(a,b); }</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="keywordtype">size_t</span> index;</div><div class="line"><span class="keywordtype">char</span>* key = <span class="stringliteral">"He gives power to the weak and strength to the powerless"</span>;</div><div class="line"><span class="keywordflow">if</span>(aSearchPF_FUNC(verses, &amp;index, key, search_strcmp))</div><div class="line">  printf(<span class="stringliteral">"found verse at %zu"</span>, index);</div><div class="line"></div><div class="line">aSearchPF_BLOCK(doors, &amp;index, key, ^(uint64_t a, uint64_t b){</div><div class="line">  <span class="comment">// avoid overflow into the sign bit</span></div><div class="line">  if((a^b)&gt;(UINT64_MAX&gt;&gt;1)) return a&lt;b? INT64_MIN : INT64_MAX;</div><div class="line">  <span class="comment">// alternative method</span></div><div class="line">  <span class="comment">// if(a-b&gt;(UINT64_MAX&gt;&gt;1)||b-a&gt;(UINT64_MAX&gt;&gt;1)) return a&lt;b? INT64_MIN : INT64_MAX;</span></div><div class="line">  return (int64_t)(a-b); });</div><div class="line">if(index &lt; aL(doors) &amp;&amp; doors[index] &lt; key) index++;</div><div class="line"><a class="code" href="#aReplace" onclick='openApi(event, "abb379a2ba01d1bb9df5085863ad1446b")'>aReplace</a>(&amp;doors, index, 0, key);</div><div class="line">aF("inserted key into door %uz", index);</div></div><!-- fragment -->
</div>
</div><a id="ad33bed1d0f5a4ef31d2c8100fd169f27"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aSearchPS </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t * </td>
<td class="paramname"><em>index</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">any * </td>
<td class="paramname"><em>key</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">int64_t(*)(any *key, any *item) </td>
<td class="paramname"><em>f</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">size_t </td>
<td class="paramname"><em>stride</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Searches a sorted <code>aArray</code> for <code>key</code></p>
<p>The underlying algorithm is pingpong, so <code>f</code> preferably returns the degree of difference</p>
<p>The array is assumed to hold <code>aLength(aArray)/stride</code> items.<s> </s><code>f</code> is passed pointers at <code>stride</code> offsets</p>
<p>So if <code>aArray</code> is <code>(uint8_t*)</code>, then <code>stride</code> is measured in bytes</p>
<dl class="section return"><dt>Returns</dt><dd><code>1</code> if <code>key</code> found, <code>0</code> otherwise.<s> </s>And updates <code>*index</code> </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"array type too wide"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keyword">struct </span>person { <span class="keywordtype">char</span>*name; };</div><div class="line"></div><div class="line"><span class="keyword">struct </span>person key = { <span class="stringliteral">"myself"</span> };</div><div class="line">uint8_t*people = <a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>((uint8_t*)malloc(200),200,<span class="keyword">true</span>); aL2(people, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> person));</div><div class="line">memcpy(people, &amp;key, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> person));</div><div class="line"></div><div class="line"><span class="keywordtype">size_t</span> index;</div><div class="line"><span class="keywordflow">if</span>(aSearchPS_FUNC(people, &amp;index, &amp;key, f, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> person)))</div><div class="line">  aF(<span class="stringliteral">"egomania is at %uz"</span>, index);</div><div class="line"><span class="comment">// printed "egomania is at 0"</span></div></div><!-- fragment -->
</div>
</div><a id="acf0052090f6334c8bf64964441deff8b"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aFmt </td>
<td>(</td>
<td class="paramtype">char * </td>
<td class="paramname"><em>format</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Prints aArrays;<s> </s>aswell as chars, strings, integers, and floats, according to <code>format</code></p>
<p><code>format</code> can contain plain text, or:</p><ul>
<li><code>%%</code> for %</li>
<li><code>%c</code> for characters</li>
<li><code>%s</code> for strings</li>
</ul>
<div class="fragment"><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"%s%c%s"</span>, <span class="stringliteral">"plat"</span>, <span class="charliteral">'y'</span>, <span class="stringliteral">"pus"</span>); <span class="comment">// prints 'platypus'</span></div></div><!-- fragment --><ul>
<li><code>%AAiBB</code> for integers</li>
<li><code>%AAuBB</code> for unsigned integers</li>
</ul>
<p><code>AA</code> is any number from <code>2</code> - <code>64</code>,<s> </s>and defaults to <code>10</code>.<s> </s>It is the base to print in, such as binary or hex</p>
<p><code>BB</code> is the integer's type, and defaults to (int).<s> </s>It can be:<s> </s><code>8</code>, <code>16</code>, <code>32</code>, <code>64</code>, or <code>c</code> (char), <code>s</code> (short), <code>i</code> (int), <code>l</code> (long), <code>ll</code> (long long), <code>z</code> (size_t), <code>m</code> (intmax_t), <code>p</code> (intptr_t).<s> </s>So (unsigned long long) in base 16 would be <code>%16ull</code>;<s> </s>(uint32_t) in binary would be <code>%2u32</code>;<s> </s>and (signed short) in base 10 would be <code>%is</code>, though <code>%i</code> will always print the sign, whether <code>+</code> or <code>-</code></p>
<div class="fragment"><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"h%cpp%c %u8"</span>, <span class="charliteral">'i'</span>, <span class="charliteral">'o'</span>, (uint8_t)2); <span class="comment">// prints 'hippo 2'</span></div></div><!-- fragment --><ul>
<li><code>%f</code> for floats</li>
<li><code>%d</code> for doubles</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> fa=0.01, fb=2.22;</div><div class="line"><span class="keywordtype">double</span> da=2.22*1000000;</div><div class="line"><span class="comment">// prints '0.01 2.22 -- 2.22e+06'</span></div><div class="line">aF(<span class="stringliteral">"%f %f -- %d"</span>,</div><div class="line">    *(int32_t*)&amp;fa,*(int32_t*)&amp;fb,</div><div class="line">    *(int64_t*)&amp;da); <span class="comment">// stop float-&gt;int conversion warnings</span></div></div><!-- fragment --><ul>
<li><code>%vAA%BB</code> for aArrays</li>
</ul>
<p><code>AA</code> is the text to print between each item.<s> </s><code>BB</code> can be any of the <code>%</code> formatters, except <code>%v</code>.<s> </s>So '<code>%v, %i</code>' would print a comma separated list of ints</p>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success, <code>-1</code> on I/O error </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"format requires more arguments"</code>, <code>"format is malformed"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>* abc = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">char</span>**)NULL, <span class="charliteral">'a'</span>, <span class="charliteral">'b'</span>, <span class="charliteral">'c'</span>);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"&lt;%v, %c&gt;"</span>, abc); <span class="comment">//prints '&lt;a, b, c&gt;'</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span>* nums = <a class="code" href="#aAppend" onclick='openApi(event, "a1721d92a16bb460e751c4e8b9a0268fa")'>aAppend</a>((<span class="keywordtype">int</span>**)NULL, 0, 1, 2);</div><div class="line"><a class="code" href="#aFmt" onclick='openApi(event, "acf0052090f6334c8bf64964441deff8b")'>aFmt</a>(<span class="stringliteral">"[%v | %2i]"</span>, nums); <span class="comment">//prints '[+0 | +1 | +10]'</span></div><div class="line"><a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;abc); <a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;nums);</div></div><!-- fragment -->
</div>
</div><a id="a50b69292634d3f2fcef642891232c2b4"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aFmtE </td>
<td>(</td>
<td class="paramtype">char * </td>
<td class="paramname"><em>format</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Prints aArrays, etc in <code>format</code> to <code>stderr</code>.<s> </s>First <code>stdout</code>, then <code>stderr</code> is flushed</p>
<p>This can be useful for quick debugging.<s> </s>Assuming no <code>define AARRAY_NOCONVENIENCE</code> we even save a whole two letters, abbreviating it to <code>aFE</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success, <code>-1</code> on I/O error </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"format requires more arguments"</code>, <code>"format is malformed"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="comment">// prints base 2, base 3, then base 4</span></div><div class="line"><a class="code" href="#aFmtE" onclick='openApi(event, "a50b69292634d3f2fcef642891232c2b4")'>aFmtE</a>(<span class="stringliteral">"as easy as %2ic %3is %4ii"</span>, (<span class="keywordtype">char</span>)1, (<span class="keywordtype">short</span>)2, (<span class="keywordtype">int</span>)3);</div></div><!-- fragment -->
</div>
</div><a id="ada00598f6215ef46d2c5d4119b7e2a98"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aFmtF </td>
<td>(</td>
<td class="paramtype">FILE * </td>
<td class="paramname"><em>file</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">char * </td>
<td class="paramname"><em>format</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Prints aArrays, etc in <code>format</code> to <code>file</code></p>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success, <code>-1</code> on I/O error </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"format requires more arguments"</code>, <code>"format is malformed"</code>, <code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="comment">// aStr("") is simply a convenience to convert a string to an aArray</span></div><div class="line"><span class="keywordtype">char</span>* word = aStr(<span class="stringliteral">"imperturbablorbably"</span>);</div><div class="line">FILE* file = fopen(<span class="stringliteral">"hope.txt"</span>, <span class="stringliteral">"w"</span>);</div><div class="line"><a class="code" href="#aFmtF" onclick='openApi(event, "ada00598f6215ef46d2c5d4119b7e2a98")'>aFmtF</a>(file, <span class="stringliteral">"Let me spell it out for you: %v, %c"</span>, word);</div><div class="line">fclose(file); <span class="comment">// contains "Let me spell it out for you: i, m, p, e, r, t, u, r, b...."</span></div></div><!-- fragment -->
</div>
</div><a id="aac211184b54c17d11b71a43714d4cfee"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aFmtA </td>
<td>(</td>
<td class="paramtype">char ** </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">char * </td>
<td class="paramname"><em>format</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Prints aArrays, etc in <code>format</code> to a <code>(char*)</code> aArray — no '\0' appended</p>
<p>‘'X’‘ is placed where the ’\0' would be.<s> </s>This helps catch errors.<s> </s>Defining <code>AARRAY_UNSAFE</code> turns this feature off</p>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success, <code>-1</code> on I/O error </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"format requires more arguments"</code>, <code>"format is malformed"</code>, <code>"parameter is NULL"</code>, <code>"out of memory"</code>
</td></tr>
</table>
</dd>
</dl>
<div class="fragment"><div class="line"><span class="keywordtype">char</span>*out = NULL;</div><div class="line"><a class="code" href="#aFmtA" onclick='openApi(event, "aac211184b54c17d11b71a43714d4cfee")'>aFmtA</a>(&amp;out, <span class="stringliteral">"%ui %ui miss a few %ii %ii"</span>, 1, 2, 99, 100);</div><div class="line">aA(&amp;out, <span class="charliteral">'\0'</span>); <span class="comment">// append \0</span></div></div><!-- fragment -->
</div>
</div><a id="a5a5bdc6b4372bd7a39ffdb1aeea436a2"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">int aWrite </td>
<td>(</td>
<td class="paramtype">any * </td>
<td class="paramname"><em>aArray</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype"> </td>
<td class="paramname"><em>...</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Prints the full contents of <code>aArray</code> and any subsequent aArrays as <code>char*</code> text to <code>file</code></p>
<p>Subsequent aArrays should have the same <code>any</code> type width as the first</p>
<p>It is faster than <code>printf</code> and does not require aArrays to be <code>NULL</code> terminated</p>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success, <code>-1</code> on I/O error </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
<table class="exception">
<tr><td>
<code>"parameter is NULL"</code>
</td></tr>
</table>
</dd>
</dl>
<p>There is also <code>WriteE</code>, <code>aWriteF</code>, corresponding to <code>aFmtE</code> and <code>aFmtF</code></p>
<div class="fragment"><div class="line"><a class="code" href="#aAppendArray" onclick='openApi(event, "afecf7b88904ae9544c07614dcda9c77e")'>aAppendArray</a>(&amp;<span class="keywordtype">string</span>,</div><div class="line">  SIZE_MAX, <span class="stringliteral">"A wonderful story of how"</span>,</div><div class="line">  SIZE_MAX, <span class="stringliteral">", my saviour died for me"</span>);</div><div class="line">FILE* file = fopen(<span class="stringliteral">"hope.txt"</span>, <span class="stringliteral">"w"</span>);</div><div class="line"><a class="code" href="#aWrite" onclick='openApi(event, "a5a5bdc6b4372bd7a39ffdb1aeea436a2")'>aWrite</a>(<span class="keywordtype">string</span>); <span class="comment">// writes string to stdout</span></div><div class="line">aWriteE(<span class="keywordtype">string</span>); <span class="comment">// writes string to stderr</span></div><div class="line">aWriteF(file, <span class="keywordtype">string</span>); <span class="comment">// writes string to file</span></div></div><!-- fragment -->
</div>
</div><a id="a9c7f6df8d34adbdd0a4887a38e3cfb23"></a><div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">void aError </td>
<td>(</td>
<td class="paramtype">char * </td>
<td class="paramname"><em>errorLocation</em>, </td>
</tr>
<tr>
<td class="paramkey"></td>
<td></td>
<td class="paramtype">char * </td>
<td class="paramname"><em>errorMsg</em> </td>
</tr>
<tr>
<td></td>
<td>)</td>
<td></td><td></td>
</tr>
</table>
</div><div class="memdoc">
<p>The error handler.<s> </s>Prints error details and aborts, but can be replaced with a custom error handler</p>
<p>This error handler must be set per translation unit</p>
<p><code>errorLocation</code> is where the error occurred in your code, i.e.:<s> </s><code>"file:lineNumber"</code></p>
<p><code>errorMsg</code> is one of:<br/>
      <s> </s><s> </s><code>"out of memory (allocating=...)"</code>,<br/>
      <s> </s><s> </s><code>"out of capacity (size=. but ...)"</code>,<br/>
      <s> </s><s> </s><code>"out of bounds (length=. but ...)"</code>,<br/>
      <s> </s><s> </s><code>"removal is out of bounds (length=. but ...)"</code>,<br/>
      <s> </s><s> </s><code>"array is NULL (array no=...)"</code>,<br/>
      <s> </s><s> </s><code>"parameter is NULL"</code>,<br/>
      <s> </s><s> </s><code>"array type too wide (max 8 bytes)"</code>,<br/>
      <s> </s><s> </s><code>"wrong arg count (args=. but ...)"</code>, and<br/>
      <s> </s><s> </s><code>"infinite loop (jump=0)"</code>,<br/>
      <s> </s><s> </s><code>"format requires more arguments"</code>,<br/>
      <s> </s><s> </s><code>"format is malformed"</code></p>
<p>If <code>errorMsg</code> formatting fails then <code>(...)</code> will be <code>(no info)</code>.<s> </s> Except for a small easter egg, for when you truly manage to run out of memory</p>
<p>Here's a little game.<s> </s>It shows errors being thrown and caught using longjmp</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include "aArray.h"</span></div><div class="line"><span class="preprocessor">#include &lt;setjmp.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"></div><div class="line">jmp_buf array_err;</div><div class="line"><span class="keywordtype">void</span> aError_jmp(<span class="keywordtype">char</span>* line, <span class="keywordtype">char</span>* msg) {</div><div class="line">  <span class="comment">// our custom error handler</span></div><div class="line">  printf(<span class="stringliteral">"Error at %s: %s\n"</span>, line, msg);</div><div class="line">  <span class="comment">// choices are exit or longjmp...</span></div><div class="line">  longjmp(array_err, 1); }</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  printf(<span class="stringliteral">"Lets play guess the array length\n"</span>);</div><div class="line">  <span class="comment">// guess too high, and an "out of bounds" exception will lose you the game</span></div><div class="line">  srand(time(NULL));</div><div class="line">  char* array = <a class="code" href="#aArray" onclick='openApi(event, "a9cec018d74013281069e3ed554aa1bf8")'>aArray</a>((<span class="keywordtype">char</span>*)malloc(100), rand() % 100, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">// aError exceptions are caught here</span></div><div class="line">  aError = &amp;aError_jmp;</div><div class="line">  if(setjmp(array_err))</div><div class="line">    printf(<span class="stringliteral">"Oops, too far! Goodbye\n"</span>), <a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;array), exit(0);</div><div class="line">  </div><div class="line">  for(;;) {</div><div class="line">    printf(<span class="stringliteral">"Guess a length: "</span>);</div><div class="line">    size_t guess;</div><div class="line">    int input_err = scanf(<span class="stringliteral">"%zu"</span>, &amp;guess);</div><div class="line">    if (input_err == 0 || input_err == EOF)</div><div class="line">      printf(<span class="stringliteral">"Oh dear, I didn't understand! Goodbye\n"</span>), <a class="code" href="#aFree" onclick='openApi(event, "ae2b030b8b0118cad8d421d822a8606cb")'>aFree</a>(&amp;array), exit(0);</div><div class="line">    </div><div class="line">    <span class="comment">// if guess is out of bounds, aAt will call aError_jmp</span></div><div class="line">    <span class="comment">// and aError_jmp behaves like an exception</span></div><div class="line">    <span class="comment">// i.e. it longjmps to setjmp(array_err) where the error is handled</span></div><div class="line">    aAt(array, guess);</div><div class="line">    </div><div class="line">    <span class="comment">// good luck with winning</span></div><div class="line">    printf(<span class="stringliteral">"The array might be longer...\n"</span>); } }</div></div><!-- fragment --><div style="margin-top:14px">It produces something like:</div> <pre class="fragment">cc game.c &amp;&amp; ./a.out
Lets play guess the array length
Guess a length: 20
The array might be longer...
Guess a length: 30
The array might be longer...
Guess a length: 40
Error at game.c:35: out of bounds (length=36 but pos=40)
Oops, too far! Goodbye
</pre>
</div>
</div></td></tr></table></div><div class="tab tab_hidden"><div class="fragment sourceFragment"><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">    /**\</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> /*/</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/*  Public domain.  No restriction, no need to accredit</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">**    &quot;As freely as you have received, freely give&quot; -- Jesus</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">**</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">\*  An array and string library.  Generated: $exec date -u +&quot;%d %b %Y&quot; | perl -pe &quot;s/\\n//&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> \*\</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">    \**/</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#if !defined(AARRAY_define)</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span>   <span class="comment">/* for memcmp */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#if defined(_MSC_VER)</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;malloc.h&gt;</span>   <span class="comment">/* for msvc realloc */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span> <span class="comment">/* for lambda */</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">/* $$defines are for pre-pre-processed macros</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * this simplifies end-user compiler messages</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * if this is aArray.h, they will have already reduced to the final exposed api</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/* handle warnings</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * many parameters take an arbitrary mix of pointers/integers</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * so optionally suppress warnings only for those parameters</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;$define pragmaWarnings(NAME)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">/* these are slightly redundant, but handle both clang and gcc */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_start \</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic push&quot;) \</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wconversion\&quot;&quot;) \</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wconversion-null\&quot;&quot;) \</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Woverflow\&quot;&quot;) </span><span class="comment">/* older versions of gcc */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wnarrowing\&quot;&quot;)</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">  #else</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_start \</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic push&quot;) \</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wconversion\&quot;&quot;) \</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wint-conversion\&quot;&quot;) \</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wpointer-to-int-cast\&quot;&quot;) \</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">      _Pragma(&quot;NAME diagnostic ignored \&quot;-Wbad-function-cast\&quot;&quot;)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_end    _Pragma(&quot;NAME diagnostic pop&quot;)</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/* c++ is available but not advertised and not advised</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * start-end block suppresses some c++ warnings</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * i.e. (cast) not being static_cast&lt;cast&gt;(), c++98-compat, etc</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#define AARRAY_nowarn_pedantic_cpp_start</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#define AARRAY_nowarn_pedantic_cpp_end</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#if defined(__clang__)</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  pragmaWarnings(clang)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">    #undef  AARRAY_nowarn_pedantic_cpp_start</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_pedantic_cpp_start_helper \</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">      _Pragma(&quot;clang diagnostic push&quot;) \</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">      _Pragma(&quot;clang diagnostic ignored \&quot;-Wc99-extensions\&quot;&quot;) \</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">      _Pragma(&quot;clang diagnostic ignored \&quot;-Wc++98-compat-pedantic\&quot;&quot;) \</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">      _Pragma(&quot;clang diagnostic ignored \&quot;-Wold-style-cast\&quot;&quot;) \</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">      _Pragma(&quot;clang diagnostic ignored \&quot;-Wcast-qual\&quot;&quot;)</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">    #if __clang_major__ &lt; 5</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">      #define AARRAY_nowarn_pedantic_cpp_start \</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">        AARRAY_nowarn_pedantic_cpp_start_helper</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">    #else</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">      #define AARRAY_nowarn_pedantic_cpp_start \</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">        AARRAY_nowarn_pedantic_cpp_start_helper \</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">        _Pragma(&quot;clang diagnostic ignored \&quot;-Wzero-as-null-pointer-constant\&quot;&quot;)</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">    #undef  AARRAY_nowarn_pedantic_cpp_end</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_pedantic_cpp_end _Pragma(&quot;clang diagnostic pop&quot;)</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#elif defined(__GNUC__)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  pragmaWarnings(GCC)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">    #undef  AARRAY_nowarn_pedantic_cpp_start</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">    #undef  AARRAY_nowarn_pedantic_cpp_end</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_pedantic_cpp_start \</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">      _Pragma(&quot;GCC diagnostic push&quot;) \</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">      _Pragma(&quot;GCC diagnostic ignored \&quot;-Wpedantic\&quot;&quot;)</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">    #define AARRAY_nowarn_pedantic_cpp_end  _Pragma(&quot;GCC diagnostic pop&quot;)</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#elif defined(_MSC_VER)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_start \</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">    __pragma(warning(push)) \</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">    __pragma(warning(disable:4047))</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_end __pragma(warning(pop))</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">/* don&#39;t hide int-pointer conversion warnings for this compiler */</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_start</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_end</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  AARRAY_nowarn_pedantic_cpp_start</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">  #define AARRAY_move std::move</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">  #define AARRAY_move</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">/* compile as .c .h, or as a single header with &#39;static inline&#39; functions */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="preprocessor">#if defined(AARRAY_c)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#define AARRAY_define(name, ...) name __VA_ARGS__</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">#elif defined(AARRAY_h)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#define AARRAY_define(name, ...) extern name;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#define AARRAY_define(name, ...) static inline name __VA_ARGS__</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">/* general compiler compatibility */</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#if !defined(__has_feature)</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#define __has_feature(x) 0</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">#if !defined(__has_extension)</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">/* pre-3.0 clang */</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#define __has_extension __has_feature</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#if defined(__builtin_prefetch)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#define AARRAY_prefetch(A, B, C) __builtin_prefetch(A, B, C)</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#define AARRAY_prefetch(A, B, C)</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">/* switch on/off safety checks */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">#if defined(AARRAY_UNSAFE)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#define AARRAY_safety(UNSAFE, ...) UNSAFE</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">#define AARRAY_safety(UNSAFE, ...) __VA_ARGS__</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/* switch on/off type warnings for generics */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#if defined(AARRAY_WARN) || (defined(__GNUC__) &amp;&amp; !defined(__clang__))</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">/* gcc can&#39;t handle pragmas within expressions, and so misses out */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_internal_start</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_internal_end</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_internal_start AARRAY_nowarn_start</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">  #define AARRAY_nowarn_internal_end   AARRAY_nowarn_end</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/* set the size of aSort&#39;s cache */</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#if !defined(AARRAY_sortCache)</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">  #define AARRAY_sortCache 512</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">/* error handling */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;AARRAY_define(__attribute((noreturn))</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">void</span> AARRAY_aError(<span class="keywordtype">char</span> errLocation[], <span class="keywordtype">char</span> errMsg[]), {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  fflush(stdout); fprintf(stderr, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, errLocation, errMsg); abort(); })</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">/* set the default handler */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;#<span class="keywordflow">if</span> defined(AARRAY_c)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;void (*aError)(<span class="keywordtype">char</span>[], <span class="keywordtype">char</span>[]) = &amp;AARRAY_aError;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#elif defined(AARRAY_h)</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">extern</span> void (*aError)(<span class="keywordtype">char</span>[], <span class="keywordtype">char</span>[]);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keyword">static</span> void (*aError)(<span class="keywordtype">char</span>[], <span class="keywordtype">char</span>[]) = &amp;AARRAY_aError;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">/* generate &quot;file.c:line_number&quot; for error messages */</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">#define AARRAY_STRINGIFY(x) #x</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#define AARRAY_TOSTRING(x) AARRAY_STRINGIFY(x)</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor">#define AARRAY_LINE (char*)__FILE__ &quot;:&quot; AARRAY_TOSTRING(__LINE__)</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/* generate error messages */</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#define AARRAY_aError_MsgLen 52 + 3*20 + 1 </span><span class="comment">/* 52 characters + 3*size_t + NULL */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#define AARRAY_aError_CALL(MSG) { aError(errLoc, MSG); abort(); }</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#define AARRAY_Error_OutOfMemory(SIZE) \</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen,  \</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">          &quot;out of memory (allocating=%zu)&quot;, \</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="preprocessor">          SIZE)) \</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;out of memory &quot; \</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">                      &quot;(can I interest you in a banana instead? 🍌)&quot;) \</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#define AARRAY_Error_OutOfBounds(LENGTH, POS) \</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen,  \</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">          &quot;out of bounds (length=%zu but pos=%zu)&quot;, \</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">          LENGTH, POS)) \</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;out of bounds (no info)&quot;) \</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#define AARRAY_Error_RemovalIsOutOfBounds(LENGTH, POS, RLEN) \</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen, \</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">          &quot;removal is out of bounds (length=%zu but pos=%zu removal=%zu)&quot;, \</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">          LENGTH, POS, RLEN)) \</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;removal is out of bounds (no info)&quot;) \</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor">#define AARRAY_Error_OutOfCapacity(CAPACITY, REQ) \</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen, \</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor">          &quot;out of capacity (size=%zu but require=%zu)&quot;, CAPACITY, REQ)) \</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;array is STATIC (no info)&quot;) \</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor">#define AARRAY_Error_ArrayIsNull(ARRAY_NO) \</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen,   \</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">          &quot;array is NULL (array no=%zu)&quot;, ARRAY_NO)) \</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;array is NULL (no info)&quot;) \</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor">#define AARRAY_Error_ArrayIsWide \</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="preprocessor">  (aError(AARRAY_LINE, (char*)&quot;array type too wide (max 8 bytes)&quot;), 0)</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#define AARRAY_Error_WrongArgCount(ARG_NUM, MULTIPLE, ADDITION) \</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">  { char AARRAY_aError_Msg[AARRAY_aError_MsgLen]; \</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">    if(0&gt;snprintf(AARRAY_aError_Msg, AARRAY_aError_MsgLen, \</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor">          &quot;wrong arg count (args=%zu but should be %i + multiple of %i)&quot;, \</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">          ARG_NUM, ADDITION, MULTIPLE)) \</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor">      AARRAY_aError_CALL((char*)&quot;wrong arg count (no info)&quot;) \</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">    else AARRAY_aError_CALL(AARRAY_aError_Msg) }</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#define AARRAY_Error_InfiniteLoop \</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="preprocessor">  AARRAY_aError_CALL((char*)&quot;infinite loop (jump=0)&quot;)</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#define AARRAY_Error_FormatStringArgs \</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">  AARRAY_aError_CALL((char*)&quot;format requires more arguments&quot;)</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#define AARRAY_Error_FormatStringMalformed \</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">  AARRAY_aError_CALL((char*)&quot;format is malformed&quot;)</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#define AARRAY_Error_NullParameter \</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">  AARRAY_aError_CALL((char*)&quot;parameter is NULL&quot;)</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/* foundations for array allocation */</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_upper_power_of_two(<span class="keywordtype">size_t</span> v), {</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">/* from: graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">   * very slightly faster than:  1&lt;&lt;(64-AARRAY_BUILTIN_LL(clz,v-1))</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  v--; v |= v &gt;&gt; 1; v |= v &gt;&gt; 2; v |= v &gt;&gt; 4; v |= v &gt;&gt; 8;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  v |= v &gt;&gt; 16; <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)==8) v |= v &gt;&gt; 32; v++; <span class="keywordflow">return</span> v; })</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">/* cross platform count-leading-zeros */</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;#<span class="keywordflow">if</span> defined(__GNUC__)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">#define AARRAY_builtin_ll(name,with) \</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">  (sizeof(with)&lt;=sizeof(int)?__builtin_##name(with) : \</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">   (sizeof(with)&lt;=sizeof(long)?__builtin_##name##l(with) : \</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor">    __builtin_##name##ll(with)))</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_clz(<span class="keywordtype">size_t</span> value), {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span>(!value) <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(value)*8;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">return</span> AARRAY_builtin_ll(clz,value); })</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;#elif defined(_MSC_VER)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#include &lt;intrin.h&gt;</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#if defined(_WIN64)</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#pragma intrinsic(_BitScanReverse,_BitScanReverse64)</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_clz(<span class="keywordtype">size_t</span> value), {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> result;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>) &lt;= 4?</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    (_BitScanReverse(&amp;result, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)value)? 31-result : 32) :</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    _BitScanReverse64(&amp;result, value)? 63-result : 64); })</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;#<span class="keywordflow">else</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;#pragma intrinsic(_BitScanReverse)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_clz(<span class="keywordtype">size_t</span> value), {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> result;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(_BitScanReverse(&amp;result, value)? 31-result : 32); })</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;#endif</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;#<span class="keywordflow">else</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/* from www.hackersdelight.org/hdcodetxt/nlz.c.txt */</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_clz(<span class="keywordtype">size_t</span> x), {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)==8 &amp;&amp;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;     x &lt;= 0x00000000FFFFFFFF) { n += 32; x &lt;&lt;= 32; }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span>(x &lt;= 0x0000FFFFFFFFFFFF) { n += 16; x &lt;&lt;= 16; }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordflow">if</span>(x &lt;= 0x00FFFFFFFFFFFFFF) { n +=  8; x &lt;&lt;=  8; }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span>(x &lt;= 0x0FFFFFFFFFFFFFFF) { n +=  4; x &lt;&lt;=  4; }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span>(x &lt;= 0x3FFFFFFFFFFFFFFF) { n +=  2; x &lt;&lt;=  2; }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">if</span>(x &lt;= 0x7FFFFFFFFFFFFFFF) { n +=  1; x &lt;&lt;=  1; }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">return</span> n; })</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;#endif</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">/* array allocators, for 3 types of array</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"> * fix pointers to realloced memory, to point back into memory</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;#define AARRAY_FIX_POINTERS(TYPE) \</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  if(!*vec) *length = 0; \</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  else <span class="keywordflow">if</span>(vecsIncr) { \</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">/* parameters can contain pointers \</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">       so update any that overlaped vec&#39;s old position */</span> \</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    size_t m = vecsIncr==5? 2: vecsIncr-1; \</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    while(m &lt; vecsCount) { \</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      if(vecs[m] &gt;= (uintptr_t)(*vec) &amp;&amp; \</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        vecs[m] &lt; (uintptr_t)(*vec)+(*length)*<span class="keyword">sizeof</span>(TYPE)) \</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        vecs[m] += \</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            (uintptr_t)length-(uintptr_t)(*(<span class="keywordtype">size_t</span>**)vec-1); \</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        m += vecsIncr; } }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">/* calculate capacity from length */</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#define AARRAY_ALLOC_NOCAPACITY(TYPE) \</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">  size_t curSize = (*length) * sizeof(TYPE) + sizeof(size_t); \</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">  size_t newSize = ((*length) + (ilen-rlen)) * sizeof(TYPE) + sizeof(size_t); \</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">  if((!*vec || AARRAY_clz(newSize-1) &lt; AARRAY_clz(curSize-1))) { \</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">    length = (size_t*)realloc(!*vec? NULL : length, \</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor">                              AARRAY_upper_power_of_two(newSize)); \</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">    AARRAY_safety(, if(!length) AARRAY_Error_OutOfMemory(newSize)); \</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">    AARRAY_FIX_POINTERS(TYPE) } \</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">  *vec = (TYPE*)(length+1);</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">/* error if allocation required */</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#define AARRAY_ALLOC_STATIC(TYPE) \</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">  (void)vecsIncr; (void)vecsCount; (void)vecs; \</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">  size_t curSize = *vec? *(*(size_t**)vec-2) : 0; \</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">  size_t newSize = ((*length) + (ilen-rlen)) * sizeof(TYPE) + sizeof(size_t) * 2; \</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">  if(!*vec) AARRAY_Error_OutOfCapacity((size_t)0, newSize); \</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">  AARRAY_safety((void)curSize;, \</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">    if(newSize&gt;curSize) \</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">      AARRAY_Error_OutOfCapacity(curSize, newSize))</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">/* store capacity</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * alternative growth strategies might be</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> * size += (size &gt;&gt; 3) + (size &lt; 9 ? 3 : 6);</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> * size += size &gt;&gt; 1; // *1.5</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"> * size = AARRAY_upper_power_of_two(size)</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#define AARRAY_ALLOC_STD(TYPE) \</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor">  size_t curSize = *vec? *(*(size_t**)vec-2) : 0; \</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">  size_t newSize = ((*length) + (ilen-rlen)) * sizeof(TYPE) + sizeof(size_t) * 2; \</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="preprocessor">  if((!*vec || newSize &gt; curSize)) { \</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="preprocessor">    newSize += newSize &gt;&gt; 1; \</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="preprocessor">    length = (size_t*)realloc(!*vec? NULL : length-1, newSize); \</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">    AARRAY_safety(, if(!length) AARRAY_Error_OutOfMemory(newSize)); \</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">    *length = newSize; \</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">    length += 1; \</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor">    AARRAY_FIX_POINTERS(TYPE) } \</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">  *vec = (TYPE*)(length+1);</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">/* handle array allocation */</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#define AARRAY_Expand(TYPE, GROWTH) \</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">  </span><span class="comment">/* use rlen (remove length) and ilen (insert length), \</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">     to setup vec ready for any new data to be inserted/appended \</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">     -- essentially a realloc + a memmove */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">  size_t lengthHolder = 0, *length = &amp;lengthHolder; \</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor">  if(*vec) length = *(size_t**)vec-1; \</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">  AARRAY_safety((void)errLoc;, \</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">  if(pos &gt; *length) AARRAY_Error_OutOfBounds(*length, pos) \</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor">  if(rlen &gt; (*length) - pos) \</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">    AARRAY_Error_RemovalIsOutOfBounds(*length, pos, rlen))  \</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">  if(rlen &gt; ilen &amp;&amp;   (*length)-(pos+rlen)) \</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">    </span><span class="comment">/* move when still have items (before realloc clips them) */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">    memmove(&amp;((*vec)[pos+ilen]), &amp;((*vec)[pos+rlen]), \</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">            sizeof(TYPE) * ((*length) - (pos+rlen))); \</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">  </span><span class="comment">/* calculate curSize and newSize */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">  AARRAY_ALLOC_##GROWTH(TYPE) \</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">  if(rlen &lt; ilen &amp;&amp;   (*length)-(pos+rlen)) { \</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">    </span><span class="comment">/* move when have space to put items (after realloc creates it) */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">    memmove(&amp;((*vec)[pos+ilen]), &amp;((*vec)[pos+rlen]), \</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">            sizeof(TYPE) * ((*length) - (pos+rlen))); }</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/* generate type specific and growth-strategy specific functions */</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;$define AARRAY_Replace(TYPE, GROWTH,)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;AARRAY_define(TYPE*AARRAY_Replace_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> pos, <span class="keywordtype">size_t</span> rlen, <span class="keywordtype">size_t</span> ilen, TYPE items[]), {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">/* replaces section of a array with N items */</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span>(vec) { AARRAY_prefetch((<span class="keywordtype">size_t</span>*)*vec-1, 1, 1); }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">/* vecs is {array1 ... arrayN}, but doesn&#39;t contain pointers;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">     so vsIncr skipped with setting it to 0 */</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordtype">size_t</span> vecsCount = 1; <span class="keywordtype">size_t</span> vecsIncr = 0;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  uintptr_t*vecs = (uintptr_t*)(<span class="keywordtype">void</span>*)items;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  TYPE*vecHolder = NULL; <span class="keywordflow">if</span>(!vec) vec = &amp;vecHolder;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  AARRAY_Expand(TYPE, GROWTH);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span>(*vec) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span>(ilen) memcpy(&amp;((*vec)[pos]), vecs, <span class="keyword">sizeof</span>(TYPE) * ilen);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    *((*(<span class="keywordtype">size_t</span>**)vec)-1) += ilen-rlen; }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">return</span> *vec; })</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/* GENERATE_GENERICS creates functions for each data type,</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * FTYPE also make it specific to a block|lambda|function-pointer</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> * These functions are then put into an array,</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> * letting us select the right one at compile time</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;$define GENERATE_GENERICS(GENERATOR, GROWTH, FTYPE)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;GENERATOR(uint8_t,  GROWTH, FTYPE)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;GENERATOR(uint16_t, GROWTH, FTYPE)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;GENERATOR(uint32_t, GROWTH, FTYPE)</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;GENERATOR(uint64_t, GROWTH, FTYPE)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keyword">static</span> void(*<span class="keyword">const</span> GENERATOR$##_$##GROWTH$##_FUNCTIONS[9])(void) = {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  NULL,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  (void(*)(void))&amp;GENERATOR$##_$##GROWTH$##_uint8_t,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  (void(*)(void))&amp;GENERATOR$##_$##GROWTH$##_uint16_t, 0,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  (void(*)(void))&amp;GENERATOR$##_$##GROWTH$##_uint32_t, 0, 0, 0,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  (void(*)(void))&amp;GENERATOR$##_$##GROWTH$##_uint64_t };</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;$define GENERATE_GENERICS_GROWTH(FNAME)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;GENERATE_GENERICS(AARRAY_$##FNAME,NOCAPACITY)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;GENERATE_GENERICS(AARRAY_$##FNAME,STATIC)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;GENERATE_GENERICS(AARRAY_$##FNAME,STD)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;GENERATE_GENERICS_GROWTH(Replace)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;$define AARRAY_Append(TYPE, GROWTH,)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;AARRAY_define(TYPE*AARRAY_Append_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> ilen, TYPE items[]), {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordtype">size_t</span> pos = vec &amp;&amp; *vec?</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                      <span class="comment">/* get array length */</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                      *(*(<span class="keywordtype">size_t</span>**)vec-1) : 0;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">return</span> AARRAY_Replace_$##GROWTH$##_$##TYPE(</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      errLoc, vec, pos, 0, ilen, items); })</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;GENERATE_GENERICS_GROWTH(Append)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;$define AARRAY_Concat(TYPE, GROWTH,)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;AARRAY_define(TYPE*AARRAY_Concat_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> vecsCount, TYPE*vecs_[]), {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">if</span>(vec) { AARRAY_prefetch((<span class="keywordtype">size_t</span>*)*vec-1, 1, 1); }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  uintptr_t*vecs = (uintptr_t*)vecs_;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordtype">size_t</span> rlen = 0; <span class="keywordtype">size_t</span> ilen = 0;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">while</span>(++n &lt; vecsCount) <span class="keywordflow">if</span>(vecs[n])</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      ilen += *((<span class="keywordtype">size_t</span>*)vecs[n]-1);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">/* vecs is {vec0, ... ,vecN}, so vsIncr is 1 */</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordtype">size_t</span> vecsIncr = 1;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  TYPE*vecHolder = NULL; <span class="keywordflow">if</span>(!vec) vec = &amp;vecHolder;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">size_t</span> pos = *vec? *(*(<span class="keywordtype">size_t</span>**)vec-1) : 0;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  AARRAY_Expand(TYPE, GROWTH);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span>(*vec) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">size_t</span> vLen = *(*(<span class="keywordtype">size_t</span>**)vec-1);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    n = (size_t)-1; <span class="keywordflow">while</span>(++n &lt; vecsCount) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordflow">if</span>(!vecs[n]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordtype">size_t</span> ns = (size_t)-1, vsnLen;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      vsnLen = *((<span class="keywordtype">size_t</span>*)vecs[n]-1);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">while</span>(++ns &lt; vsnLen) (*vec)[vLen+ns] = vecs_[n][ns];</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      vLen += vsnLen; }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    *(*(<span class="keywordtype">size_t</span>**)vec-1) += ilen; }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">return</span> *vec; })</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;GENERATE_GENERICS_GROWTH(Concat)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;$define AARRAY_GenericArray(TYPE, GROWTH,)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;AARRAY_define(TYPE*AARRAY_GenericArray_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> pos, <span class="keywordtype">size_t</span> rlen, <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">size_t</span> n = 0; <span class="keywordtype">size_t</span> alen, ilen = 0;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordtype">size_t</span> vecsIncr = 2;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">while</span>(n &lt; vecsCount) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    alen = vecs[n];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    AARRAY_safety(, <span class="keywordflow">if</span>(alen &amp;&amp; vecs[n+1]==(uintptr_t)NULL) </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        AARRAY_Error_ArrayIsNull((n+2)/2));</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span>(alen==SIZE_MAX) { <span class="keywordflow">while</span>(((TYPE*)vecs[n+1])[++alen]) { }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                         vecs[n] = alen; }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    ilen += alen; n+=vecsIncr; }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">/* vecs is {len0, array0, ... lenN, arrayN}, so vsIncr is 2 */</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  TYPE*vecHolder = NULL; <span class="keywordflow">if</span>(!vec) vec = &amp;vecHolder;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  AARRAY_Expand(TYPE, GROWTH);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span>(*vec) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    n = 0; <span class="keywordflow">while</span>(n &lt; vecsCount) {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      alen = vecs[n];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordflow">if</span>(alen) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        memcpy(&amp;((*vec)[pos]), (<span class="keywordtype">void</span>*)vecs[n+1], <span class="keyword">sizeof</span>(TYPE)*alen);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        pos += alen; } n+=vecsIncr; }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    *(*(<span class="keywordtype">size_t</span>**)vec-1) += ilen-rlen; }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">return</span> *vec; })</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;GENERATE_GENERICS_GROWTH(GenericArray)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;$define AARRAY_ReplaceArray(TYPE, GROWTH,)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;AARRAY_define(TYPE*AARRAY_ReplaceArray_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> pos, <span class="keywordtype">size_t</span> rlen, <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">if</span>(vec) { AARRAY_prefetch((<span class="keywordtype">size_t</span>*)*vec-1, 1, 1); }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>((vecsCount+3) % 2 != 1)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      AARRAY_Error_WrongArgCount(vecsCount+3, 2, 3));</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">return</span> AARRAY_GenericArray_$##GROWTH$##_$##TYPE(</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    errLoc, vec, pos, rlen, vecsCount, vecs); })</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;GENERATE_GENERICS_GROWTH(ReplaceArray)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;$define AARRAY_AppendArray(TYPE, GROWTH,)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;AARRAY_define(TYPE*AARRAY_AppendArray_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">if</span>(vec) { AARRAY_prefetch((<span class="keywordtype">size_t</span>*)*vec-1, 1, 1); }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>((vecsCount+1) % 2 != 1)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      AARRAY_Error_WrongArgCount(vecsCount+1, 2, 1));</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordtype">size_t</span> pos = vec &amp;&amp; *vec? *(*(<span class="keywordtype">size_t</span>**)vec-1) : 0;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">return</span> AARRAY_GenericArray_$##GROWTH$##_$##TYPE(</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    errLoc, vec, pos, 0, vecsCount, vecs); })</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;GENERATE_GENERICS_GROWTH(AppendArray)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;$define AARRAY_Multi(TYPE, GROWTH,)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;AARRAY_define(TYPE*AARRAY_Multi_$<span class="preprocessor">##GROWTH$##_$##TYPE(char errLoc[],</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  TYPE*vec[], <span class="keywordtype">size_t</span> pos, <span class="keywordtype">size_t</span> rlen, <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordflow">if</span>(vec) { AARRAY_prefetch((<span class="keywordtype">size_t</span>*)*vec-1, 1, 1); }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordtype">size_t</span> lengthHolder = 0, *length = &amp;lengthHolder;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">if</span>(vec &amp;&amp; *vec) length = *(<span class="keywordtype">size_t</span>**)vec-1;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">size_t</span> n = 0, alen, ilen = 0, atimes, newlen = *length, maxlen = newlen;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">size_t</span> saved_pos = pos, saved_rlen = rlen;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">size_t</span> vecsIncr = 5;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>((vecsCount+3) % 5 != 1)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      AARRAY_Error_WrongArgCount(vecsCount+3, 5, 1));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">while</span>(n &lt; vecsCount) {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    atimes = vecs[n]; alen = vecs[n+1];</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    AARRAY_safety(, <span class="keywordflow">if</span>(atimes &amp;&amp; alen  &amp;&amp; !vecs[n+2])</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        AARRAY_Error_ArrayIsNull(n/5+1));</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span>(alen==SIZE_MAX) { <span class="keywordflow">while</span>(((TYPE*)vecs[n+2])[++alen]) { }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                         vecs[n+1] = alen; }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">/* check input, and work out max length required for array */</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span>(n) { pos = vecs[n-2]; rlen = vecs[n-1]; }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">if</span>(pos &gt; newlen) AARRAY_Error_OutOfBounds(*length, pos)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span>(rlen &gt; newlen - pos) AARRAY_Error_RemovalIsOutOfBounds(newlen, pos, rlen)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    ilen = atimes? atimes * alen : alen;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    newlen += ilen - rlen;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span>(newlen &gt; maxlen) maxlen = newlen;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    n+=vecsIncr; }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  ilen = maxlen - *length; rlen = 0;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="comment">/* vecs is {times0, len0, array0, ... timesN, lenN, arrayN}, so vsIncr is 3 */</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  TYPE*vecHolder = NULL; <span class="keywordflow">if</span>(!vec) vec = &amp;vecHolder;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  AARRAY_ALLOC_$##GROWTH(TYPE)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">if</span>(*vec) {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    n = 0; pos = saved_pos; rlen = saved_rlen;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      atimes = vecs[n]; alen = vecs[n+1];</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">if</span>(n) { pos = vecs[n-2]; rlen = vecs[n-1]; }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      ilen = atimes? atimes * alen : alen;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span>(ilen-rlen) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        memmove(&amp;((*vec)[pos+ilen]), &amp;((*vec)[pos+rlen]),</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <span class="keyword">sizeof</span>(TYPE) * ((*length) - (pos+rlen)));</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        *length += ilen-rlen; }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">if</span>(!atimes) {}</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">while</span>(atimes--) {</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        memcpy(&amp;((*vec)[pos]), (<span class="keywordtype">void</span>*)vecs[n+2], <span class="keyword">sizeof</span>(TYPE) * alen);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        pos += alen; }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      n+=vecsIncr;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    } <span class="keywordflow">while</span>(n &lt; vecsCount); }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">return</span> *vec; })</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;GENERATE_GENERICS_GROWTH(Multi)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;$define AARRAY_Mem(TYPE, GROWTH,)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;AARRAY_define(TYPE*AARRAY_Mem_$<span class="preprocessor">##GROWTH$##_$##TYPE(</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordtype">char</span> errLoc[], <span class="keywordtype">size_t</span> vec[]), {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  (void)errLoc;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span>(!vec) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">if</span>($exec [ GROWTH = NOCAPACITY ] &amp;&amp; echo <span class="stringliteral">&#39;1) {&#39;</span> || echo <span class="stringliteral">&#39;0) {&#39;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">return</span> (TYPE*)(vec-1); }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">return</span> (TYPE*)(vec-2); })</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;GENERATE_GENERICS_GROWTH(Mem)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;$define AARRAY_Array(TYPE, GROWTH,)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;AARRAY_define(TYPE*AARRAY_Array_$<span class="preprocessor">##GROWTH$##_$##TYPE(</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">char</span> errLoc[], <span class="keywordtype">size_t</span> vec[], <span class="keywordtype">size_t</span> sizebytes, <span class="keywordtype">int</span> maximize), {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc;, <span class="keywordflow">if</span>(!vec) AARRAY_Error_ArrayIsNull((<span class="keywordtype">size_t</span>)0));</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">if</span>($exec [ GROWTH = NOCAPACITY ] &amp;&amp; echo <span class="stringliteral">&#39;1) {&#39;</span> || echo <span class="stringliteral">&#39;0) {&#39;</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    AARRAY_safety(,<span class="keywordflow">if</span>(sizebytes &lt; <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)  ) AARRAY_Error_OutOfCapacity(sizebytes, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)  ))</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">/* greatest len power-of-two that fits sizebytes */</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">size_t</span> len = ((<span class="keywordtype">size_t</span>)1)&lt;&lt;(63-AARRAY_clz((sizebytes-<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>))/<span class="keyword">sizeof</span>(TYPE)));</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span>(maximize || len &lt; *vec) *vec = len;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">return</span> (TYPE*)(vec+1); }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    AARRAY_safety(,<span class="keywordflow">if</span>(sizebytes &lt; <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2) AARRAY_Error_OutOfCapacity(sizebytes, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)*2))</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordtype">size_t</span> len = (sizebytes - <span class="keyword">sizeof</span>(size_t)*2) / <span class="keyword">sizeof</span>(TYPE);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span>(maximize || len &lt; *(vec+1)) *(vec+1) = len;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    *vec = sizebytes;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">return</span> (TYPE*)(vec+2); } })</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;GENERATE_GENERICS_GROWTH(Array)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160; </div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">/* get the number of var-arg arguments, and make them generic */</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;$define AARRAY_Args(sizeofType, ...) AARRAY_nowarn_internal_start \</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  (sizeofType==1? sizeof((uint8_t []){(uint8_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   sizeofType==2? <span class="keyword">sizeof</span>((uint16_t[]){(uint16_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   sizeofType&lt;=4? <span class="keyword">sizeof</span>((uint32_t[]){(uint32_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="keyword">sizeof</span>((uint64_t[]){(uint64_t)(uintptr_t)__VA_ARGS__})) / sizeofType, \</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  (sizeofType==1? (<span class="keywordtype">void</span>*)AARRAY_move((uint8_t []){(uint8_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   sizeofType==2? (<span class="keywordtype">void</span>*)AARRAY_move((uint16_t[]){(uint16_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   sizeofType&lt;=4? (<span class="keywordtype">void</span>*)AARRAY_move((uint32_t[]){(uint32_t)(uintptr_t)__VA_ARGS__}) : \</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   (<span class="keywordtype">void</span>*)AARRAY_move((uint64_t[]){(uint64_t)(uintptr_t)__VA_ARGS__})) \</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   AARRAY_nowarn_internal_end</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">/* as above, but for 64 bit only, such as aFmt */</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;$define AARRAY_64bitArgs(...) AARRAY_nowarn_internal_start \</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;sizeof((uint64_t[]){(uint64_t)__VA_ARGS__}) / <span class="keyword">sizeof</span>(uint64_t), \</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  (uint64_t*)AARRAY_move((uint64_t[]){(uint64_t)(uintptr_t)__VA_ARGS__}) \</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  AARRAY_nowarn_internal_end</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">/* make c++ happy */</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;$define AARRAY_PtrArgs_WARN(...) \</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  sizeof((<span class="keywordtype">void</span>*[]){(<span class="keywordtype">void</span>*)__VA_ARGS__}) / <span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*), \</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  (uintptr_t*)AARRAY_move((<span class="keywordtype">void</span>*[]){(<span class="keywordtype">void</span>*)__VA_ARGS__})</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">/* as above, but hide compiler warnings for mixed int/pointer arrays</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"> * uintptr_t conversion of first arg resolves gcc issue</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;$define AARRAY_PtrArgs(...) AARRAY_nowarn_internal_start \</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  sizeof((uintptr_t[]){(uintptr_t)__VA_ARGS__}) / <span class="keyword">sizeof</span>(uintptr_t), \</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  (uintptr_t*)AARRAY_move((uintptr_t[]){(uintptr_t)__VA_ARGS__}) \</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  AARRAY_nowarn_internal_end</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">/* get around requirement for __VA_ARGS__ to not be empty */</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;#define AARRAY_ArgsTail(A, ...) __VA_ARGS__</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">#if defined(AARRAY_NOTYPEOF) \</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor">    || (defined(_MSC_VER) &amp;&amp; !__has_feature(cxx_decltype))</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/* create api functions without type-casts */</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="preprocessor">#define AARRAY_typeof(TYPE, EXPR) EXPR</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="preprocessor">#elif __has_feature(cxx_decltype)</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">/* +0 resolves c++ compliance */</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="preprocessor">#define AARRAY_typeof(TYPE, EXPR) (__decltype(TYPE+0))(EXPR)</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="preprocessor">#define AARRAY_typeof(TYPE, EXPR) \</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="preprocessor">  AARRAY_nowarn_internal_start (__typeof(TYPE))(EXPR) AARRAY_nowarn_internal_end</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;$define TEST_width(type) <span class="keyword">sizeof</span>(type) &gt; 8 ? AARRAY_Error_ArrayIsWide : <span class="keyword">sizeof</span>(type)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">/* generate the main apis for c, c++, and compilers without __typeof support */</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;$define GENERATE_api(NAME, GROWTH)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="preprocessor">#define aAppend$##NAME(vec, ...) \</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)(char[], void**, size_t, void*)) \</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor">         AARRAY_Append_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, AARRAY_Args(sizeof(**vec), __VA_ARGS__)))</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="preprocessor">#define aReplace$##NAME(vec, pos, rlen, ...) \</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)( \</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="preprocessor">     char[], void**, size_t, size_t, size_t, void*)) \</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="preprocessor">         AARRAY_Replace_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, pos, rlen, \</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="preprocessor">                              AARRAY_Args(sizeof(**vec), __VA_ARGS__)))</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="preprocessor">#define aDelete$##NAME(vec, pos, rlen) \</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)( \</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="preprocessor">     char[], void**, size_t, size_t, size_t, void*)) \</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="preprocessor">         AARRAY_Replace_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, pos, rlen, 0, NULL))</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="preprocessor">#define aConcat$##NAME(vec, ...) \</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)(char[], void**, size_t, uintptr_t*)) \</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="preprocessor">         AARRAY_Concat_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, AARRAY_PtrArgs_WARN(__VA_ARGS__)))</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="preprocessor">#define aAppendArray$##NAME(vec, ...) \</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)(char[], void**, size_t, uintptr_t*)) \</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="preprocessor">         AARRAY_AppendArray_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, AARRAY_PtrArgs(__VA_ARGS__)))</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="preprocessor">#define aReplaceArray$##NAME(vec, pos, rlen, ...) \</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)( \</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="preprocessor">     char[], void**, size_t, size_t, size_t, uintptr_t*)) \</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="preprocessor">          AARRAY_ReplaceArray_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void**)vec, pos, rlen, AARRAY_PtrArgs(__VA_ARGS__)))</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="preprocessor">#define aMulti$##NAME(vec, pos, rlen, arrTimes, ...) \</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (void*(*)( \</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="preprocessor">     char[], void**, size_t, size_t, size_t, uintptr_t*)) \</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor">         AARRAY_Multi_$##GROWTH$##_FUNCTIONS[TEST_width(**vec)]) \</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="preprocessor">  (AARRAY_LINE, (void**)vec, pos, rlen, \</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="preprocessor">   AARRAY_PtrArgs(arrTimes, __VA_ARGS__)))</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="preprocessor">#define aMem$##NAME(vec) \</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (void*(*)(char[], void*)) \</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="preprocessor">         AARRAY_Mem_$##GROWTH$##_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="preprocessor">  (AARRAY_LINE, (void*)vec))</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor">#define aArray$##NAME(vec, size, maximize) \</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (void*(*)(char[], void*, size_t, int)) \</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor">         AARRAY_Array_$##GROWTH$##_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="preprocessor">  (AARRAY_LINE, (void*)vec, size, maximize))</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;GENERATE_api(_NOCAPACITY, NOCAPACITY)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;GENERATE_api(_STATIC,     STATIC)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;GENERATE_api(,            STD)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">/* make pointer casts safer: ensuring data can become (void$##stars)data */</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;$define safe_void(stars, data)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;0?(<span class="keywordtype">void</span>$##stars)(uintptr_t)<span class="keyword">sizeof</span>( \</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  stars$##data<span class="comment">/*  stars$##ptr check failed --- use (type**) --- */</span> \</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  ):(<span class="keywordtype">void</span>$##stars)data</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_Free(<span class="keywordtype">void</span>*vec[]), {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordflow">if</span>(*vec) { free((<span class="keywordtype">size_t</span>*)*vec-2); *vec = NULL; } })</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_Free_STATIC(<span class="keywordtype">void</span>*vec[]), {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   AARRAY_Free(vec); }) <span class="comment">/* to make stack traces clearer */</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_Free_NOCAPACITY(<span class="keywordtype">void</span>*vec[]), {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span>(*vec) { free((<span class="keywordtype">size_t</span>*)*vec-1); *vec = NULL; } })</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;#define aFree(vec) \</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  AARRAY_Free(safe_void(**,vec))</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="preprocessor">#define aFree_STATIC(vec) \</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor">  AARRAY_Free_STATIC(safe_void(**,vec))</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="preprocessor">#define aFree_NOCAPACITY(vec) \</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="preprocessor">  AARRAY_Free_NOCAPACITY(safe_void(**,vec))</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">/* supporting api */</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_aCapacity(<span class="keywordtype">void</span>*vec), {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">return</span> !vec? 0 : *((<span class="keywordtype">size_t</span>*)vec-2) - <span class="keyword">sizeof</span>(size_t)*2; })</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_aCapacity_STATIC(<span class="keywordtype">void</span>*vec), {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">return</span> AARRAY_aCapacity(vec); })</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_aCapacity_NOCAPACITY(<span class="keywordtype">void</span>*vec), {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="keywordflow">return</span> !vec? 0 : ((size_t)1) &lt;&lt; (64-AARRAY_clz((*((<span class="keywordtype">size_t</span>*)vec-1))-1)); })</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;#define aCapacity(vec)            (AARRAY_aCapacity(safe_void(*,vec))/<span class="keyword">sizeof</span>(*vec))</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;#define aCapacity_STATIC(vec)     (AARRAY_aCapacity_STATIC(safe_void(*,vec))/<span class="keyword">sizeof</span>(*vec))</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;#define aCapacity_NOCAPACITY(vec)  AARRAY_aCapacity_NOCAPACITY(safe_void(*,vec))</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_aLength(<span class="keywordtype">void</span>*vec), {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">return</span> !vec? 0 : *((<span class="keywordtype">size_t</span>*)vec-1); })</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;#define aLength(vec) AARRAY_aLength(safe_void(*,vec))</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;$define AARRAY_Length2(TYPE, ...)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;AARRAY_define(TYPE AARRAY_Length2__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordflow">if</span>(!vec) AARRAY_safety(<span class="keywordflow">return</span> 0; (void)errLoc;,</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    { <span class="keywordflow">if</span>(pos==0) <span class="keywordflow">return</span> 0; <span class="keywordflow">else</span> AARRAY_Error_OutOfBounds(aLength(vec), pos); })</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordtype">size_t</span>*length = (<span class="keywordtype">size_t</span>*)(<span class="keywordtype">void</span>*)vec-1;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>(pos &gt; *length)</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      AARRAY_Error_OutOfBounds(aLength(vec), pos));</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  *length = pos;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">/* if(pos==0) { pos-1 would index into *length (which is 0);</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">                  so vec[pos-1] is safe and returns 0 } */</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">if</span>(pos==0) <span class="keywordflow">return</span> 0; <span class="comment">/* but keep it sanitizer safe */</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">return</span> vec[pos-1]; })</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;GENERATE_GENERICS(AARRAY_Length2)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="preprocessor">#define aLength2(vec, len) \</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="preprocessor">  AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="preprocessor">            AARRAY_Length2__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, len)</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;$define AARRAY_ZLength2(TYPE, ...)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;AARRAY_define(TYPE AARRAY_ZLength2__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">return</span> AARRAY_Length2__$##TYPE(errLoc, vec, aLength(vec) - pos); })</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;GENERATE_GENERICS(AARRAY_ZLength2)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="preprocessor">#define aZLength2(vec, len) \</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor">            AARRAY_ZLength2__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, len))</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;$define AARRAY_AtPtr(TYPE, ...)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;AARRAY_define(TYPE*AARRAY_AtPtr__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc;,</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="keywordflow">if</span>(pos &gt;= aLength(vec)) AARRAY_Error_OutOfBounds(aLength(vec), pos));</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">return</span> &amp;(vec[pos]); })</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;GENERATE_GENERICS(AARRAY_AtPtr)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="preprocessor">#define aAtPtr(vec, pos) \</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="preprocessor">   AARRAY_AtPtr__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos))</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;$define AARRAY_ZAtPtr(TYPE, ...)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;AARRAY_define(TYPE*AARRAY_ZAtPtr__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordflow">return</span> AARRAY_AtPtr__$##TYPE(errLoc, vec, aLength(vec) - (pos+1)); })</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160; </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;GENERATE_GENERICS(AARRAY_ZAtPtr)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="preprocessor">#define aZAtPtr(vec, pos) \</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="preprocessor">   AARRAY_ZAtPtr__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos))</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;$define AARRAY_At(TYPE, ...)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;AARRAY_define(TYPE AARRAY_At__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc;,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">if</span>(pos &gt;= aLength(vec)) AARRAY_Error_OutOfBounds(aLength(vec), pos));</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">return</span> vec[pos]; })</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;GENERATE_GENERICS(AARRAY_At)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="preprocessor">#define aAt(vec, pos) \</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="preprocessor">   AARRAY_At__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos))</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160; </div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;$define AARRAY_ZAt(TYPE, ...)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;AARRAY_define(TYPE AARRAY_ZAt__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos), {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">return</span> AARRAY_At__$##TYPE(errLoc, vec, aLength(vec) - (pos+1)); })</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;GENERATE_GENERICS(AARRAY_ZAt)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="preprocessor">#define aZAt(vec, pos) \</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t)) \</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="preprocessor">   AARRAY_ZAt__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos))</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;$define AARRAY_At2(TYPE, ...)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;AARRAY_define(TYPE AARRAY_At2__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos, TYPE item), {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc;,</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span>(pos &gt;= aLength(vec)) AARRAY_Error_OutOfBounds(aLength(vec), pos));</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  vec[pos] = item;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">return</span> item; })</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;GENERATE_GENERICS(AARRAY_At2)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor">#define aAt2(vec, pos, item) \</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t, uint64_t)) \</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="preprocessor">   AARRAY_At2__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos, \</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">    AARRAY_nowarn_internal_start (uint64_t)item AARRAY_nowarn_internal_end))</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;$define AARRAY_ZAt2(TYPE, ...)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;AARRAY_define(TYPE AARRAY_ZAt2__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos, TYPE item), {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordflow">return</span> AARRAY_At2__$##TYPE(errLoc, vec, aLength(vec) - (pos+1), item); })</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;GENERATE_GENERICS(AARRAY_ZAt2)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="preprocessor">#define aZAt2(vec, pos, item) \</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">  (AARRAY_typeof(*vec, (uint64_t(*)(char[], void*, size_t, uint64_t)) \</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="preprocessor">   AARRAY_ZAt2__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="preprocessor">   (AARRAY_LINE, (void*)vec, pos, \</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="preprocessor">    AARRAY_nowarn_internal_start item AARRAY_nowarn_internal_end))</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;$define AARRAY_Cmp(TYPE, ...)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_Cmp__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    TYPE vec[], <span class="keywordtype">size_t</span> n, TYPE*vecs[]), {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">while</span>(n--) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">if</span>(vec == vecs[n]) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span>(aLength(vec) != aLength(vecs[n])) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span>(aLength(vec)==0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="comment">/* surely memcmp would work, but this upsets MSan</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">       memcmp(((size_t*)(uintptr_t)vec-1), ((size_t*)(uintptr_t)vecs[n]-1),</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">              aLength(vec)*sizeof(TYPE)+sizeof(size_t)); */</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordtype">size_t</span> m = SIZE_MAX; <span class="keywordflow">while</span>(++m &lt; aLength(vec)) <span class="keywordflow">if</span>(vec[m]!=vecs[n][m]) <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="keywordflow">return</span> 1; })</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;GENERATE_GENERICS(AARRAY_Cmp)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="preprocessor">#define aCmp(vec, ...) \</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">  (((int(*)(void*, size_t, void*)) \</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">   AARRAY_Cmp__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">   ((void*)vec, AARRAY_PtrArgs_WARN(__VA_ARGS__)))</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;$define AARRAY_IndexOf(TYPE, ...)</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_IndexOf__$<span class="preprocessor">##TYPE(TYPE vec[], TYPE item), {</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordtype">size_t</span> length = aLength(vec), i = (size_t)-1;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">while</span>(++i &lt; length) <span class="keywordflow">if</span>(vec[i]==item) <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">size_t</span>)-1; })</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;GENERATE_GENERICS(AARRAY_IndexOf,)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor">#define aIndexOf(vec, item) \</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="preprocessor">  ((size_t(*)(void*, uint64_t)) \</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="preprocessor">   AARRAY_IndexOf__FUNCTIONS[TEST_width(*vec)])(vec, \</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor">  AARRAY_nowarn_internal_start item AARRAY_nowarn_internal_end)</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;$define AARRAY_ZIndexOf(TYPE, ...)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_ZIndexOf__$<span class="preprocessor">##TYPE(TYPE vec[], TYPE item), {</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordtype">size_t</span> i = aLength(vec);</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">while</span>(i--) <span class="keywordflow">if</span>(vec[i]==item) <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">size_t</span>)-1; })</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;GENERATE_GENERICS(AARRAY_ZIndexOf,)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor">#define aZIndexOf(vec, item) \</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="preprocessor">  ((size_t(*)(void*, uint64_t)) \</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">   AARRAY_ZIndexOf__FUNCTIONS[TEST_width(*vec)])(vec, \</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor">  AARRAY_nowarn_internal_start item AARRAY_nowarn_internal_end)</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;$define AARRAY_Map(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_Map_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], FTYPE(TYPE)), {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc, <span class="keywordflow">if</span>(!f) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">/* only FUNC versions use extra data parameter */</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordflow">while</span>(++n &lt; aLength(vec)) f(&amp;(vec[n]) $exec <span class="keywordflow">case</span> <span class="stringliteral">&#39;FTYPE()&#39;</span> in *<span class="stringliteral">&#39;data&#39;</span>) echo <span class="stringliteral">&#39;, data&#39;</span>;; esac; echo <span class="stringliteral">&#39;); })&#39;</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160; </div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;$define AARRAY_Loop(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_Loop_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], <span class="keywordtype">size_t</span> pos, FTYPE), {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc, <span class="keywordflow">if</span>(!f) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordtype">int</span> offset = 0;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">while</span>(pos &lt; aLength(vec)) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">if</span>((offset &gt; 0 &amp;&amp; pos &lt; (<span class="keywordtype">size_t</span>)offset) ||</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;       (offset &lt; 0 &amp;&amp; pos &gt; (<span class="keywordtype">size_t</span>)offset)) <span class="keywordflow">return</span> offset;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    offset = f(pos $exec <span class="keywordflow">case</span> <span class="stringliteral">&#39;FTYPE&#39;</span> in *<span class="stringliteral">&#39;data&#39;</span>) echo <span class="stringliteral">&#39;, data&#39;</span>;; esac; echo <span class="stringliteral">&#39;);&#39;</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span>(!offset) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="comment">/* play safe with int promotion */</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span>(offset &gt; 0) pos += (size_t) offset;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">else</span>           pos -= (size_t)-offset; }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">return</span> offset; })</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;$define AARRAY_Filter(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;AARRAY_define(TYPE* AARRAY_Filter_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE vec[], FTYPE(TYPE)), {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc, <span class="keywordflow">if</span>(!f) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1, nn = (<span class="keywordtype">size_t</span>)-1;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">while</span>(++n &lt; aLength(vec)) {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span>(f(vec[n] $exec <span class="keywordflow">case</span> <span class="stringliteral">&#39;FTYPE()&#39;</span> in *<span class="stringliteral">&#39;data&#39;</span>) echo <span class="stringliteral">&#39;, data&#39;</span>;; esac; echo <span class="stringliteral">&#39;))&#39;</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      vec[++nn] = vec[n]; }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  (void)aLength2(vec, nn+1);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordflow">return</span> vec; })</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;$define FUNC_void_ptrT__D(TYPE)   void(*f)(TYPE*, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;$define FUNC_void_ptrT(TYPE)      void(*f)(TYPE*)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;GENERATE_GENERICS(AARRAY_Map, FUNC_3, FUNC_void_ptrT__D)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;GENERATE_GENERICS(AARRAY_Map, FUNC_2, FUNC_void_ptrT)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="preprocessor">#define AARRAY_aMap_FUNC_3(vec, f, data) \</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">  AARRAY_Map_FUNC_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, (void(*)(void))f, data)</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="preprocessor">#define AARRAY_aMap_FUNC_2(vec, f) \</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, void(*)(void))) \</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="preprocessor">  AARRAY_Map_FUNC_2_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, (void(*)(void))f)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;$define FUNC_int_size__D          int(*f)(size_t, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;GENERATE_GENERICS(AARRAY_Loop, FUNC_4, FUNC_int_size__D)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;GENERATE_GENERICS(AARRAY_Loop, FUNC_3, <span class="keywordtype">int</span>(*f)(<span class="keywordtype">size_t</span>))</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_FUNC_4(vec, pos, f, data) \</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, int(*)(size_t, void*), void*)) \</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="preprocessor">  AARRAY_Loop_FUNC_4_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f, data)</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_FUNC_3(vec, pos, f) \</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, int(*)(size_t))) \</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor">  AARRAY_Loop_FUNC_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f)</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;$define FUNC_int_T__D(TYPE)    int(*f)(TYPE, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;$define FUNC_int_T(TYPE)       int(*f)(TYPE)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;GENERATE_GENERICS(AARRAY_Filter, FUNC_3, FUNC_int_T__D)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;GENERATE_GENERICS(AARRAY_Filter, FUNC_2, FUNC_int_T)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_FUNC_3(vec, f, data) \</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="preprocessor">   AARRAY_Filter_FUNC_3_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec,(void(*)(void))f, data))</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_FUNC_2(vec, f) \</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, void(*)(void))) \</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">   AARRAY_Filter_FUNC_2_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec,(void(*)(void))f))</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;$define BLOCK_void_ptrT__D(TYPE)  void(^f)(TYPE*, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;$define BLOCK_void_ptrT(TYPE)     void(^f)(TYPE*)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;GENERATE_GENERICS(AARRAY_Map, BLOCK_3, BLOCK_void_ptrT__D)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;GENERATE_GENERICS(AARRAY_Map, BLOCK_2, BLOCK_void_ptrT)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#define AARRAY_aMap_BLOCK_3(vec, f, data) \</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, void(^)(void*, void*), void*)) \</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="preprocessor">   AARRAY_Map_BLOCK_3_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor">  (AARRAY_LINE, vec, (void(^)(void*, void*))f, data)</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="preprocessor">#define AARRAY_aMap_BLOCK_2(vec, f) \</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, void(^)(void*))) \</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="preprocessor">   AARRAY_Map_BLOCK_2_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="preprocessor">  (AARRAY_LINE, vec, (void(^)(void*))f)</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;$define BLOCK_int_size__D         int(^f)(size_t, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;GENERATE_GENERICS(AARRAY_Loop, BLOCK_4, BLOCK_int_size__D)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;GENERATE_GENERICS(AARRAY_Loop, BLOCK_3, <span class="keywordtype">int</span> (^f)(<span class="keywordtype">size_t</span>))</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_BLOCK_4(vec, pos, f, data) \</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, int(^)(size_t, void*), void*)) \</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="preprocessor">   AARRAY_Loop_BLOCK_4_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f, data)</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_BLOCK_3(vec, pos, f) \</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, int(^)(size_t))) \</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">   AARRAY_Loop_BLOCK_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f)</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;$define BLOCK_int_T__D(TYPE)   int(^f)(TYPE, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;$define BLOCK_int_T(TYPE)      int(^f)(TYPE)</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;GENERATE_GENERICS(AARRAY_Filter, BLOCK_3, BLOCK_int_T__D)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;GENERATE_GENERICS(AARRAY_Filter, BLOCK_2, BLOCK_int_T)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_BLOCK_3(vec, f, data) \</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, int(^)(uint64_t, void*), void*)) \</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="preprocessor">   AARRAY_Filter_BLOCK_3_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec,(int(^)(uint64_t, void*))f, data))</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_BLOCK_2(vec, f) \</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, int(^)(uint64_t))) \</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor">   AARRAY_Filter_BLOCK_2_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec,(int(^)(uint64_t))f))</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;$define LAMBDA_void_ptrT__D(TYPE) std::function&lt;void(TYPE*, <span class="keywordtype">void</span>*)&gt; f, <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;$define LAMBDA_void_ptrT(TYPE)    std::function&lt;void(TYPE*)&gt; f</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;GENERATE_GENERICS(AARRAY_Map, LAMBDA_3, LAMBDA_void_ptrT__D)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;GENERATE_GENERICS(AARRAY_Map, LAMBDA_2, LAMBDA_void_ptrT)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="preprocessor">#define AARRAY_aMap_LAMBDA_3(vec, f, data) \</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, std::function&lt;void(void*, void*)&gt;, void*)) \</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="preprocessor">   AARRAY_Map_LAMBDA_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, f, data)</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="preprocessor">#define AARRAY_aMap_LAMBDA_2(vec, f) \</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="preprocessor">  ((void(*)(char[], void*, std::function&lt;void(void*)&gt;)) \</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="preprocessor">   AARRAY_Map_LAMBDA_2_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, f)</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;$define LAMBDA_int_size__D        std::function&lt;int(<span class="keywordtype">size_t</span>, <span class="keywordtype">void</span>*)&gt; f, <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;GENERATE_GENERICS(AARRAY_Loop, LAMBDA_4, LAMBDA_int_size__D)</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;GENERATE_GENERICS(AARRAY_Loop, LAMBDA_3, std::function&lt;<span class="keywordtype">int</span>(<span class="keywordtype">size_t</span>)&gt; f)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_LAMBDA_4(vec, pos, f, data) \</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, std::function&lt;int(size_t, void*)&gt;, void*)) \</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="preprocessor">   AARRAY_Loop_LAMBDA_4_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f, data)</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="preprocessor">#define AARRAY_aLoop_LAMBDA_3(vec, pos, f) \</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="preprocessor">  ((int(*)(char[], void*, size_t, std::function&lt;int(size_t)&gt;)) \</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="preprocessor">   AARRAY_Loop_LAMBDA_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, pos, f)</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;$define LAMBDA_int_T__D(TYPE)  std::function&lt;int(TYPE, <span class="keywordtype">void</span>*)&gt; f, <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;$define LAMBDA_int_T(TYPE)     std::function&lt;int(TYPE)&gt; f</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;GENERATE_GENERICS(AARRAY_Filter, LAMBDA_3, LAMBDA_int_T__D)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;GENERATE_GENERICS(AARRAY_Filter, LAMBDA_2, LAMBDA_int_T)</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_LAMBDA_3(vec, f, data) \</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, std::function&lt;int(uint64_t, void*)&gt;, void*))\</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="preprocessor">   AARRAY_Filter_LAMBDA_3_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, f, data))</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="preprocessor">#define AARRAY_aFilter_LAMBDA_2(vec, f) \</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(char[], void*, std::function&lt;int(uint64_t)&gt;))\</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="preprocessor">   AARRAY_Filter_LAMBDA_2_FUNCTIONS[TEST_width(*vec)])(AARRAY_LINE, vec, f))</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">/* aFold is generic over array_type, function_type, AND base_type</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"> * Rather than make previous cppp macros more generic, we treat aFold as unique</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> * Though it&#39;s possible to create macros that genericize any c function</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> * Which would be useful...</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;$define AARRAY_Fold(TYPEB, TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;AARRAY_define(TYPEB AARRAY_Fold_$##FNAME$##_$##TYPEB$##_$##TYPE(</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordtype">char</span> errLoc[], TYPE*vec, TYPEB base,</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    FTYPE(TYPEB,TYPE)), {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc, <span class="keywordflow">if</span>(!f) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keywordflow">while</span>(++n &lt; aLength(vec)) base = f(base,vec[n] $exec <span class="keywordflow">case</span> <span class="stringliteral">&#39;FTYPE(,)&#39;</span> in *<span class="stringliteral">&#39;data&#39;</span>) echo <span class="stringliteral">&#39;, data&#39;</span>;; esac; echo <span class="stringliteral">&#39;);&#39;</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="keywordflow">return</span> base; })</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;$define AARRAY_Fold_TYPEB(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;AARRAY_Fold(uint8_t,  TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;AARRAY_Fold(uint16_t, TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;AARRAY_Fold(uint32_t, TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;AARRAY_Fold(uint64_t, TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;$define AARRAY_Fold_FNAME(FNAME, FTYPE)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;AARRAY_Fold_TYPEB(uint8_t,  FNAME, FTYPE)</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;AARRAY_Fold_TYPEB(uint16_t, FNAME, FTYPE)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;AARRAY_Fold_TYPEB(uint32_t, FNAME, FTYPE)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;AARRAY_Fold_TYPEB(uint64_t, FNAME, FTYPE)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="keyword">static</span> void(*<span class="keyword">const</span> AARRAY_Fold_$##FNAME$##_FUNCTIONS[9][9])(void) = { {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  NULL }, {</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  NULL,</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint8_t_uint8_t,</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint8_t_uint16_t, 0,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint8_t_uint32_t, 0, 0, 0,</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint8_t_uint64_t }, {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  NULL,</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint16_t_uint8_t,</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint16_t_uint16_t, 0,</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint16_t_uint32_t, 0, 0, 0,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint16_t_uint64_t }, {0}, {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  NULL,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint32_t_uint8_t,</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint32_t_uint16_t, 0,</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint32_t_uint32_t, 0, 0, 0,</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint32_t_uint64_t }, {0}, {0}, {0}, {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  NULL,</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint64_t_uint8_t,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint64_t_uint16_t, 0,</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint64_t_uint32_t, 0, 0, 0,</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  (void(*)(void))&amp;AARRAY_Fold_$##FNAME$##_uint64_t_uint64_t } };</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;$define AARRAY_FUNCTION_TB_TB_T__D(TYPEB, TYPE) TYPEB(*f)(TYPEB,TYPE, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;$define AARRAY_FUNCTION_TB_TB_T(TYPEB, TYPE) TYPEB(*f)(TYPEB,TYPE)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;AARRAY_Fold_FNAME(FUNC_4, AARRAY_FUNCTION_TB_TB_T__D)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;AARRAY_Fold_FNAME(FUNC_3, AARRAY_FUNCTION_TB_TB_T)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="preprocessor">#define AARRAY_aFold_FUNC_4(vec, base, f, data) \</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="preprocessor">   AARRAY_Fold_FUNC_4_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, (void(*)(void))f, data))</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="preprocessor">#define AARRAY_aFold_FUNC_3(vec, base, f) \</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, void(*)(void))) \</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="preprocessor">   AARRAY_Fold_FUNC_3_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, (void(*)(void))f))</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;$define AARRAY_BLOCK_TB_TB_T__D(TYPEB, TYPE) TYPEB(^f)(TYPEB,TYPE, <span class="keywordtype">void</span>*), <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;$define AARRAY_BLOCK_TB_TB_T(TYPEB, TYPE) TYPEB(^f)(TYPEB,TYPE)</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;AARRAY_Fold_FNAME(BLOCK_4, AARRAY_BLOCK_TB_TB_T__D)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;AARRAY_Fold_FNAME(BLOCK_3, AARRAY_BLOCK_TB_TB_T)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="preprocessor">#define AARRAY_aFold_BLOCK_4(vec, base, f, data) \</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, \</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="preprocessor">                        uint64_t(^)(uint64_t,uint64_t,void*), void*)) \</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor">   AARRAY_Fold_BLOCK_4_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, (uint64_t(^)(uint64_t,uint64_t,void*))f, data))</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="preprocessor">#define AARRAY_aFold_BLOCK_3(vec, base, f) \</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, \</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="preprocessor">                        uint64_t(^)(uint64_t,uint64_t))) \</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="preprocessor">   AARRAY_Fold_BLOCK_3_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, (uint64_t(^)(uint64_t,uint64_t))f))</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;$define AARRAY_LAMBDA_TB_TB_T__D(TYPEB, TYPE) std::function&lt;TYPEB(TYPEB,TYPE, <span class="keywordtype">void</span>*)&gt;f, <span class="keywordtype">void</span>*data</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;$define AARRAY_LAMBDA_TB_TB_T(TYPEB, TYPE) std::function&lt;TYPEB(TYPEB,TYPE)&gt;f</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;AARRAY_Fold_FNAME(LAMBDA_4, AARRAY_LAMBDA_TB_TB_T__D)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;AARRAY_Fold_FNAME(LAMBDA_3, AARRAY_LAMBDA_TB_TB_T)</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="preprocessor">#define AARRAY_aFold_LAMBDA_4(vec, base, f, data) \</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, \</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="preprocessor">                        std::function&lt;uint64_t(uint64_t,uint64_t,void*)&gt;, void*)) \</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="preprocessor">   AARRAY_Fold_LAMBDA_4_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, f, data))</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="preprocessor">#define AARRAY_aFold_LAMBDA_3(vec, base, f) \</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="preprocessor">  (AARRAY_typeof(base, (uint64_t(*)(char[], void*, uint64_t, \</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">                        std::function&lt;uint64_t(uint64_t,uint64_t)&gt;)) \</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="preprocessor">   AARRAY_Fold_LAMBDA_3_FUNCTIONS[TEST_width(base)][TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="preprocessor">   (AARRAY_LINE, vec, (uint64_t)base, f))</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">/* make void*data parameter optional  */</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="preprocessor">#define AARRAY_ARGS_(_10, _9, _8, _7, _6, _5, _4, _3, _2, _1, N, ...) N </span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="preprocessor">#define AARRAY_ARGS(...) AARRAY_ARGS_(__VA_ARGS__, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0)</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="preprocessor">#define AARRAY_CONCAT(a, b)        a##b</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="preprocessor">#define AARRAY_CONCAT_EXPAND(a, b) AARRAY_CONCAT(a, b)</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="preprocessor">#define aMap_FUNC(...)      AARRAY_CONCAT_EXPAND(AARRAY_aMap_FUNC_,      AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="preprocessor">#define aMap_BLOCK(...)     AARRAY_CONCAT_EXPAND(AARRAY_aMap_BLOCK_,     AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="preprocessor">#define aMap_LAMBDA(...)    AARRAY_CONCAT_EXPAND(AARRAY_aMap_LAMBDA_,    AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="preprocessor">#define aLoop_FUNC(...)     AARRAY_CONCAT_EXPAND(AARRAY_aLoop_FUNC_,     AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="preprocessor">#define aLoop_BLOCK(...)    AARRAY_CONCAT_EXPAND(AARRAY_aLoop_BLOCK_,    AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="preprocessor">#define aLoop_LAMBDA(...)   AARRAY_CONCAT_EXPAND(AARRAY_aLoop_LAMBDA_,   AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="preprocessor">#define aFilter_FUNC(...)   AARRAY_CONCAT_EXPAND(AARRAY_aFilter_FUNC_,   AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="preprocessor">#define aFilter_BLOCK(...)  AARRAY_CONCAT_EXPAND(AARRAY_aFilter_BLOCK_,  AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="preprocessor">#define aFilter_LAMBDA(...) AARRAY_CONCAT_EXPAND(AARRAY_aFilter_LAMBDA_, AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="preprocessor">#define aFold_FUNC(...)     AARRAY_CONCAT_EXPAND(AARRAY_aFold_FUNC_,     AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="preprocessor">#define aFold_BLOCK(...)    AARRAY_CONCAT_EXPAND(AARRAY_aFold_BLOCK_,    AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="preprocessor">#define aFold_LAMBDA(...)   AARRAY_CONCAT_EXPAND(AARRAY_aFold_LAMBDA_,   AARRAY_ARGS(__VA_ARGS__))(__VA_ARGS__)</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">/* search and sort</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"> * aSort needs a whole bunch of helper macros and functions</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"> * thanks goes to: https://github.com/BonzaiThePenguin/WikiSort</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;$define AARRAY_swap(TYPE, a, b) { TYPE temp = a;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                                  a = b;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                                  b = temp; }</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160; </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;$define AARRAY_SWAP(TYPE, x, y) \</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  if(f(array[sRange+y], array[sRange+x]) ||</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;     (order[x] &gt; order[y] &amp;&amp; !f(array[sRange+x], array[sRange+y]))) {</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    AARRAY_swap(TYPE, array[sRange+x], array[sRange+y]);</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    AARRAY_swap(uint8_t, order[x], order[y]); }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;$define AARRAY_blockSwap(TYPE, array, start1, start2, block_size)</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n = 0; n &lt; block_size; n++)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    AARRAY_swap(TYPE, array[start1+n], array[start2+n])</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;$define AARRAY_PULL(_to) \</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  pull[pull_index].sRange = sA; \</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  pull[pull_index].eRange = eB; \</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  pull[pull_index].count = count; \</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  pull[pull_index].from = index; \</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  pull[pull_index].to = _to;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;$define AARRAY_sortFindFirstForward(FNAME, value, start, end, unique)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">if</span>(end-start == 0) index = start;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordtype">int</span> indexSet = 0;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">size_t</span> skip = (end-start)/(unique);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">if</span>(!skip) skip = 1;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">for</span>(index = start+skip; f(array[index-1], value); index += skip)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">if</span>(index &gt;= end-skip) {</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        index = AARRAY_aSortBinaryFirst_$##FNAME(array, value, index, end, f);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        indexSet = 1; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span>(!indexSet) index =</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      AARRAY_aSortBinaryFirst_$##FNAME(array, value, index-skip, index, f); }</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;$define AARRAY_sortFindLastForward(FNAME, value, start, end, unique)</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordflow">if</span>(end-start == 0) index = start;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordtype">int</span> indexSet = 0;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordtype">size_t</span> skip = (end-start)/(unique);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span>(!skip) skip = 1;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">for</span>(index = start+skip; !f(value, array[index-1]); index += skip)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">if</span>(index &gt;= end-skip) {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        index = AARRAY_aSortBinaryLast_$##FNAME(array, value, index, end, f);</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        indexSet = 1; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span>(!indexSet) index =</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    AARRAY_aSortBinaryLast_$##FNAME(array, value, index-skip, index, f); }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;$define AARRAY_sortFindFirstBackward(FNAME, value, start, end, unique)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">if</span>(end-start == 0) index = start;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordtype">int</span> indexSet = 0;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordtype">size_t</span> skip = (end-start)/(unique);</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span>(!skip) skip = 1;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">for</span>(index = end-skip; index &gt; start</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        &amp;&amp; !f(array[index-1], value); index -= skip)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keywordflow">if</span>(index &lt; start+skip) {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      index = AARRAY_aSortBinaryFirst_$##FNAME(array, value, start, index, f);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      indexSet = 1; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordflow">if</span>(!indexSet) index =</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    AARRAY_aSortBinaryFirst_$##FNAME(array, value, index, index+skip, f); }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;$define AARRAY_sortFindLastBackward(FNAME, value, start, end, unique)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keywordflow">if</span>(end-start == 0) index = start;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordtype">int</span> indexSet = 0;</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="keywordtype">size_t</span> skip = (end-start)/(unique);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">if</span>(!skip) skip = 1;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">for</span>(index = end-skip; index &gt; start</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        &amp;&amp; f(value, array[index-1]); index -= skip)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">if</span>(index &lt; start+skip) {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        index = AARRAY_aSortBinaryLast_$##FNAME(array, value, start, index, f);</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        indexSet = 1; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">if</span>(!indexSet) index =</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    AARRAY_aSortBinaryLast_$##FNAME(array, value, index, index+skip, f); }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;$define AARRAY_sortReverse(TYPE, ...)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortReverse__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    TYPE vec[], <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end), {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n = (end-start)/2; n &gt; 0; n--) {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    TYPE temp = vec[start+n-1];</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    vec[start+n-1] = vec[end-n];</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    vec[end-n] = temp; } })</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;$define AARRAY_sortBinaryFirst(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_sortBinaryFirst_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keyword">const</span> TYPE array[], <span class="keyword">const</span> TYPE value,</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, FTYPE(TYPE)), {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordtype">size_t</span> rend = end;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  end -= 1;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  <span class="keywordflow">if</span>(start &gt;= rend) <span class="keywordflow">return</span> start;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="keywordflow">while</span>(start &lt; end) {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordtype">size_t</span> mid = start+(end-start)/2;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">if</span>(f(array[mid], value))  start = mid+1;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">else</span>                            end = mid; }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">if</span>(start == rend-1 &amp;&amp; f(array[start], value)) start++;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">return</span> start; })</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160; </div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;$define AARRAY_sortBinaryLast(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;AARRAY_define(<span class="keywordtype">size_t</span> AARRAY_sortBinaryLast_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keyword">const</span> TYPE array[], <span class="keyword">const</span> TYPE value,</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end, FTYPE(TYPE)), {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordtype">size_t</span> rend = end;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  end -= 1;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keywordflow">if</span>(start &gt;= rend) <span class="keywordflow">return</span> end;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keywordflow">while</span>(start &lt; end) {</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordtype">size_t</span> mid = start+(end-start)/2;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">if</span>(!f(value, array[mid])) start = mid+1;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">else</span>                            end = mid; }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="keywordflow">if</span>(start == rend-1 &amp;&amp; !f(value, array[start])) start++;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordflow">return</span> start; })</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span> {</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordtype">size_t</span> size, power_of_two;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="keywordtype">size_t</span> numerator, decimal;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordtype">size_t</span> denominator, decimal_step, numerator_step; } AARRAY_sortIt;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;$define AARRAY_sortNextRange(TYPE, ...)</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortNextRange__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    AARRAY_sortIt*it, <span class="keywordtype">size_t</span>*start, <span class="keywordtype">size_t</span>*end), {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  *start = it-&gt;decimal;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  it-&gt;decimal += it-&gt;decimal_step;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  it-&gt;numerator += it-&gt;numerator_step;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  <span class="keywordflow">if</span>(it-&gt;numerator &gt;= it-&gt;denominator) {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    it-&gt;numerator -= it-&gt;denominator;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    it-&gt;decimal++; }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  *end = it-&gt;decimal; })</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;$define AARRAY_sortNextLevel(TYPE, ...)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_sortNextLevel__$<span class="preprocessor">##TYPE(AARRAY_sortIt*it), {</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  it-&gt;decimal_step += it-&gt;decimal_step;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  it-&gt;numerator_step += it-&gt;numerator_step;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span>(it-&gt;numerator_step &gt;= it-&gt;denominator) {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    it-&gt;numerator_step -= it-&gt;denominator;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    it-&gt;decimal_step++; }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="keywordflow">return</span> it-&gt;decimal_step &lt; it-&gt;size; })</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;GENERATE_GENERICS(AARRAY_sortReverse)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="preprocessor">#define AARRAY_aSortReverse(vec, start, end) \</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="preprocessor">  (((int(*)(void*, size_t, size_t)) \</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="preprocessor">    AARRAY_sortReverse__FUNCTIONS[TEST_width(*vec)])((void*)vec, start, end))</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;$define AARRAY_sortRotate(TYPE, ...)</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortRotate__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    TYPE array[], <span class="keyword">const</span> <span class="keywordtype">size_t</span> amount, <span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end,</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    TYPE cache[], <span class="keyword">const</span> <span class="keywordtype">size_t</span> cacheSize), {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordflow">if</span>(end-start == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="keywordtype">size_t</span> sA = start, eA = start+amount, sB = start+amount, eB = end;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordflow">if</span>(eA-sA &lt;= eB-sB) {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="keywordflow">if</span>(eA-sA &lt;= cacheSize) {</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      memcpy(&amp;cache[0], &amp;array[sA], (eA-sA)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      memmove(&amp;array[sA], &amp;array[sB], (eB-sB)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      memcpy(&amp;array[sA+(eB-sB)], &amp;cache[0], (eA-sA)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="keywordflow">return</span>; } }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordflow">if</span>(eB-sB &lt;= cacheSize) {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      memcpy(&amp;cache[0], &amp;array[sB], (eB-sB)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      memmove(&amp;array[eB-(eA-sA)], &amp;array[sA], (eA-sA)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      memcpy(&amp;array[sA], &amp;cache[0], (eB-sB)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordflow">return</span>; } }</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  AARRAY_aSortReverse(array, sA, eA);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  AARRAY_aSortReverse(array, sB, eB);</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  AARRAY_aSortReverse(array, start, end); })</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;$define AARRAY_sortMergeInto(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortMergeInto_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    TYPE from[], <span class="keywordtype">size_t</span> sA, <span class="keywordtype">size_t</span> eA, <span class="keywordtype">size_t</span> sB, <span class="keywordtype">size_t</span> eB,</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    FTYPE(TYPE), TYPE into[]), {</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  TYPE*A_index = &amp;from[sA], *B_index = &amp;from[sB];</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  TYPE*A_last = &amp;from[eA], *B_last = &amp;from[eB];</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  TYPE*insert_index = &amp;into[0];</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordflow">if</span>(!f(*B_index, *A_index)) {</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      *insert_index = *A_index;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      A_index++;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      insert_index++;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="keywordflow">if</span>(A_index == A_last) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        memcpy(insert_index, B_index, (<span class="keywordtype">size_t</span>)(B_last-B_index)*<span class="keyword">sizeof</span>(from[0]));</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">break</span>; } }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      *insert_index = *B_index;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      B_index++;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      insert_index++;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">if</span>(B_index == B_last) {</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        memcpy(insert_index, A_index, (<span class="keywordtype">size_t</span>)(A_last-A_index)*<span class="keyword">sizeof</span>(from[0]));</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">break</span>; } } } })</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160; </div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;$define AARRAY_sortMergeExternal(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortMergeExternal_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    TYPE array[], <span class="keywordtype">size_t</span> sA, <span class="keywordtype">size_t</span> eA, <span class="keywordtype">size_t</span> sB, <span class="keywordtype">size_t</span> eB,</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    FTYPE(TYPE), TYPE cache[]), {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  TYPE*A_index = &amp;cache[0];</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  TYPE*B_index = &amp;array[sB];</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  TYPE*insert_index = &amp;array[sA];</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  TYPE*A_last = &amp;cache[eA-sA];</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  TYPE*B_last = &amp;array[eB];</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="keywordflow">if</span>(eB-sB &gt; 0 &amp;&amp; eA-sA &gt; 0) {</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="keywordflow">if</span>(!f(*B_index, *A_index)) {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        *insert_index = *A_index;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        A_index++;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        insert_index++;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="keywordflow">if</span>(A_index == A_last) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        *insert_index = *B_index;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        B_index++;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        insert_index++;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">if</span>(B_index == B_last) <span class="keywordflow">break</span>; } } }</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  memcpy(insert_index, A_index, (<span class="keywordtype">size_t</span>)(A_last-A_index)*<span class="keyword">sizeof</span>(array[0])); })</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;$define AARRAY_sortMergeInternal(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortMergeInternal_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    TYPE array[], <span class="keywordtype">size_t</span> sA, <span class="keywordtype">size_t</span> eA, <span class="keywordtype">size_t</span> sB, <span class="keywordtype">size_t</span> eB,</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    FTYPE(TYPE), <span class="keywordtype">size_t</span> sBuff), {</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="keywordtype">size_t</span> A_count = 0, B_count = 0, insert = 0;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  <span class="keywordflow">if</span>(eB-sB &gt; 0 &amp;&amp; eA-sA &gt; 0) {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">if</span>(!f(array[sB+B_count], array[sBuff+A_count])) {</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        AARRAY_swap(TYPE, array[sA+insert], array[sBuff+A_count]);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        A_count++;</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        insert++;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordflow">if</span>(A_count &gt;= eA-sA) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        AARRAY_swap(TYPE, array[sA+insert], array[sB+B_count]);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        B_count++;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        insert++;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keywordflow">if</span>(B_count &gt;= eB-sB) <span class="keywordflow">break</span>; } } }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  AARRAY_blockSwap(TYPE, array, sBuff+A_count, sA+insert, (eA-sA)-A_count); })</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;$define FUNC_int_TT(TYPE)   int(*f)(TYPE,TYPE)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;$define BLOCK_int_TT(TYPE)  int(^f)(TYPE,TYPE)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;$define LAMBDA_int_TT(TYPE) std::function&lt;int(TYPE, TYPE)&gt;f</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;GENERATE_GENERICS(AARRAY_sortRotate)</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="preprocessor">#define AARRAY_aSortRotate(vec, value, start, end, vecb, cacheSize) \</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, void*, size_t)) \</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="preprocessor">    AARRAY_sortRotate__FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, vecb, cacheSize))</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryFirst, FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryLast, FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryFirst_FUNC(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, void(*)(void))) \</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryFirst_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (void(*)(void))f))</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryLast_FUNC(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, void(*)(void))) \</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryLast_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (void(*)(void))f))</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  </div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryFirst, BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryLast, BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryFirst_BLOCK(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, void*)) \</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryFirst_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (void*)f))</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryLast_BLOCK(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, void*)) \</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryLast_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (void*)f))</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryFirst, LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;GENERATE_GENERICS(AARRAY_sortBinaryLast, LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryFirst_LAMBDA(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, std::function&lt;int(int,int)&gt;)) \</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryFirst_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (std::function&lt;int(int,int)&gt;)f))</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="preprocessor">#define AARRAY_aSortBinaryLast_LAMBDA(vec, value, start, end, f) \</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="preprocessor">  (((size_t(*)(void*, uint64_t, size_t, size_t, std::function&lt;int(int,int)&gt;)) \</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="preprocessor">    AARRAY_sortBinaryLast_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="preprocessor">   ((void*)vec, value, start, end, (std::function&lt;int(int,int)&gt;)f))</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;$define AARRAY_sortMergeInPlace(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_sortMergeInPlace_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    TYPE array[], <span class="keywordtype">size_t</span> sA, <span class="keywordtype">size_t</span> eA, <span class="keywordtype">size_t</span> sB, <span class="keywordtype">size_t</span> eB,</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    FTYPE(TYPE), TYPE cache[]), {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keywordflow">if</span>(eA-sA == 0 || eB-sB == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="keywordtype">size_t</span> mid = AARRAY_aSortBinaryFirst_$##FNAME(array, array[sA], sB, eB, f);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="keywordtype">size_t</span> amount = mid-eA;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    AARRAY_aSortRotate(array, eA-sA, sA, mid, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">if</span>(eB == mid) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    sB = mid;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    sA = sA+amount; eA = sB;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    sA = AARRAY_aSortBinaryLast_$##FNAME(array, array[sA], sA, eA, f);</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span>(eA-sA == 0) <span class="keywordflow">break</span>; } })</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;GENERATE_GENERICS(AARRAY_sortNextRange)</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;GENERATE_GENERICS(AARRAY_sortNextLevel)</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="preprocessor">#define AARRAY_aSortNextRange(vec, iter, start, end) \</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="preprocessor">  (((void(*)(AARRAY_sortIt*, size_t*, size_t*)) \</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="preprocessor">    AARRAY_sortNextRange__FUNCTIONS[TEST_width(*vec)])(iter, start, end))</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="preprocessor">#define AARRAY_aSortNextLevel(vec, iter) \</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="preprocessor">  (((int (*)(AARRAY_sortIt*)) \</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="preprocessor">    AARRAY_sortNextLevel__FUNCTIONS[TEST_width(*vec)])(iter))</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInto,     FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeExternal, FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInternal, FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInPlace,  FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInto_FUNC(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInto_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void(*)(void))f, vecb))</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeExternal_FUNC(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="preprocessor">    AARRAY_sortMergeExternal_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void(*)(void))f, vecb))</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInternal_FUNC(vec, s1, s2, s3, s4, f, s5) \</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void(*)(void), size_t)) \</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInternal_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void(*)(void))f, s5))</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInPlace_FUNC(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void(*)(void), void*)) \</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInPlace_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void(*)(void))f, vecb))</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInto,     BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeExternal, BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInternal, BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInPlace,  BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInto_BLOCK(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void*, void*)) \</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInto_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void*)f, vecb))</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeExternal_BLOCK(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void*, void*)) \</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="preprocessor">    AARRAY_sortMergeExternal_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void*)f, vecb))</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInternal_BLOCK(vec, s1, s2, s3, s4, f, s5) \</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void*, size_t)) \</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInternal_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void*)f, s5))</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInPlace_BLOCK(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, void*, void*)) \</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInPlace_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (void*)f, vecb))</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInto,     LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeExternal, LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInternal, LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;GENERATE_GENERICS(AARRAY_sortMergeInPlace,  LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInto_LAMBDA(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, \</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="preprocessor">             std::function&lt;int(int,int)&gt;, void*)) \</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInto_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (std::function&lt;int(int,int)&gt;)f, vecb))</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeExternal_LAMBDA(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, \</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="preprocessor">             std::function&lt;int(int,int)&gt;, void*)) \</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="preprocessor">    AARRAY_sortMergeExternal_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (std::function&lt;int(int,int)&gt;)f, vecb))</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInternal_LAMBDA(vec, s1, s2, s3, s4, f, s5) \</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, \</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="preprocessor">             std::function&lt;int(int,int)&gt;, size_t)) \</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInternal_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (std::function&lt;int(int,int)&gt;)f, s5))</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="preprocessor">#define AARRAY_aSortMergeInPlace_LAMBDA(vec, s1, s2, s3, s4, f, vecb) \</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="preprocessor">  (((void(*)(void*, size_t, size_t, size_t, size_t, \</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="preprocessor">             std::function&lt;int(int,int)&gt;, void*)) \</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="preprocessor">    AARRAY_sortMergeInPlace_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="preprocessor">   ((void*)vec, s1, s2, s3, s4, (std::function&lt;int(int,int)&gt;)f, vecb))</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">/* from www.hackersdelight.org/hdcodetxt/martin/src/sqrt/sqrt.c */</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;AARRAY_define(int64_t AARRAY_sqrt(int64_t x), {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">/* Logically, these are unsigned. We need the sign bit to test</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">     whether (op - res - one) underflowed */</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  int64_t op = x, res, one;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  res = 0;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="comment">/* &quot;one&quot; starts at the highest power of four &lt;= than the argument */</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  one = ((uint64_t)1) &lt;&lt; 62; <span class="comment">/* second-to-top bit set */</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordflow">while</span> (one &gt; op) one &gt;&gt;= 2;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="keywordflow">while</span> (one != 0) {</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">if</span> (op &gt;= res + one) {</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      op = op - (res + one);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      res = res +  2 * one; }</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    res /= 2;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    one /= 4; }</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <span class="keywordflow">return</span>(res); })</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">/* alternative slow sqrt */</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">/* AARRAY_define(uint64_t AARRAY_double_to_uint(double val), {</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">  if(val &gt; (double)INT64_MAX) return (uint64_t)INT64_MAX;</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">  if(val &lt; (double)INT64_MIN) return (uint64_t)INT64_MIN;</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">  return (uint64_t)(int64_t)val; })</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">AARRAY_define(uint64_t AARRAY_sqrt(uint64_t val), {</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">  */</span><span class="comment">/* bounded newton-raphson */</span><span class="comment">/*</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">  if(val&lt;=1) return val;</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">  uint64_t min = 1, max = val;</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">  uint64_t a = min+1, b = (max&gt;&gt;4)+2, c;</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">  int64_t fa = (int64_t)(val-a*a), fb = (int64_t)(val-b*b);</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">  while(min &lt; max) {</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">    */</span><span class="comment">/* divide by non-zero? interpolate : bisect */</span><span class="comment">/*</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">    c = (uint64_t)fb-(uint64_t)fa?</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">      b - AARRAY_double_to_uint((double)fb * (double)(b-a) /</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">                                (double)((uint64_t)fb-(uint64_t)fa)) :</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">      max-((max-min)&gt;&gt;1);</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">    */</span><span class="comment">/* keep the pingpong ball on the table */</span><span class="comment">/*</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">    a = b; b = c &lt; min ? min : c &gt;= max ? max-1 : c;</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">    fa = fb; fb = (int64_t)(val-b*b);</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">    if(fb == 0) return b;</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">    if(fb &gt;  0) min = b+1; else max = b; }</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment">  return min-1; }) */</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160; </div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">/* all that work, just to support this beast</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">   I&#39;m glad I didn&#39;t write it myself */</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;$define AARRAY_sort(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;AARRAY_define(TYPE*AARRAY_sort_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    TYPE array[], FTYPE(TYPE)), {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  <span class="keywordtype">size_t</span> size = aLength(array);</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  TYPE cache[AARRAY_sortCache];</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  AARRAY_sortIt it;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">if</span>(size &lt; 4) {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span>(size == 3) {</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">if</span>(f(array[1], array[0])) AARRAY_swap(TYPE, array[0], array[1]);</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <span class="keywordflow">if</span>(f(array[2], array[1])) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        AARRAY_swap(TYPE, array[1], array[2]);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="keywordflow">if</span>(f(array[1], array[0])) AARRAY_swap(TYPE, array[0], array[1]); } }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(size == 2) {</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="keywordflow">if</span>(f(array[1], array[0])) AARRAY_swap(TYPE, array[0], array[1]); }</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">return</span> array; }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <span class="comment">/* new it */</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  it.size = size;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">/* floor_power_of_2(size) */</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordtype">size_t</span> s = size;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  s = s | (s &gt;&gt; 1); s = s | (s &gt;&gt; 2); s = s | (s &gt;&gt; 4);</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  s = s | (s &gt;&gt; 8); s = s | (s &gt;&gt; 16);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)==8) s = s | (s &gt;&gt; 32);</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  s = s-(s &gt;&gt; 1);</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  it.power_of_two = s;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  it.denominator = it.power_of_two/4;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  it.numerator_step = it.size % it.denominator;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  it.decimal_step = it.size/it.denominator;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  it.numerator = it.decimal = 0;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordflow">while</span>(!(it.decimal &gt;= it.size)) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    uint8_t order[] = { 0, 1, 2, 3, 4, 5, 6, 7 };</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordtype">size_t</span> sRange, eRange;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    AARRAY_aSortNextRange(array, &amp;it, &amp;sRange, &amp;eRange);</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span>(eRange-sRange==8) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      AARRAY_SWAP(TYPE, 0, 1); AARRAY_SWAP(TYPE, 2, 3); AARRAY_SWAP(TYPE, 4, 5);</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      AARRAY_SWAP(TYPE, 6, 7); AARRAY_SWAP(TYPE, 0, 2); AARRAY_SWAP(TYPE, 1, 3);</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      AARRAY_SWAP(TYPE, 4, 6); AARRAY_SWAP(TYPE, 5, 7); AARRAY_SWAP(TYPE, 1, 2);</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      AARRAY_SWAP(TYPE, 5, 6); AARRAY_SWAP(TYPE, 0, 4); AARRAY_SWAP(TYPE, 3, 7);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      AARRAY_SWAP(TYPE, 1, 5); AARRAY_SWAP(TYPE, 2, 6); AARRAY_SWAP(TYPE, 1, 4);</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      AARRAY_SWAP(TYPE, 3, 6); AARRAY_SWAP(TYPE, 2, 4); AARRAY_SWAP(TYPE, 3, 5);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      AARRAY_SWAP(TYPE, 3, 4); }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eRange-sRange==7) {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      AARRAY_SWAP(TYPE, 1, 2); AARRAY_SWAP(TYPE, 3, 4); AARRAY_SWAP(TYPE, 5, 6);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      AARRAY_SWAP(TYPE, 0, 2); AARRAY_SWAP(TYPE, 3, 5); AARRAY_SWAP(TYPE, 4, 6);</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      AARRAY_SWAP(TYPE, 0, 1); AARRAY_SWAP(TYPE, 4, 5); AARRAY_SWAP(TYPE, 2, 6);</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      AARRAY_SWAP(TYPE, 0, 4); AARRAY_SWAP(TYPE, 1, 5); AARRAY_SWAP(TYPE, 0, 3);</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      AARRAY_SWAP(TYPE, 2, 5); AARRAY_SWAP(TYPE, 1, 3); AARRAY_SWAP(TYPE, 2, 4);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      AARRAY_SWAP(TYPE, 2, 3); }</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eRange-sRange==6) {</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      AARRAY_SWAP(TYPE, 1, 2); AARRAY_SWAP(TYPE, 4, 5); AARRAY_SWAP(TYPE, 0, 2);</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      AARRAY_SWAP(TYPE, 3, 5); AARRAY_SWAP(TYPE, 0, 1); AARRAY_SWAP(TYPE, 3, 4);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      AARRAY_SWAP(TYPE, 2, 5); AARRAY_SWAP(TYPE, 0, 3); AARRAY_SWAP(TYPE, 1, 4);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      AARRAY_SWAP(TYPE, 2, 4); AARRAY_SWAP(TYPE, 1, 3); AARRAY_SWAP(TYPE, 2, 3); }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eRange-sRange==5) {</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      AARRAY_SWAP(TYPE, 0, 1); AARRAY_SWAP(TYPE, 3, 4); AARRAY_SWAP(TYPE, 2, 4);</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      AARRAY_SWAP(TYPE, 2, 3); AARRAY_SWAP(TYPE, 1, 4); AARRAY_SWAP(TYPE, 0, 3);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      AARRAY_SWAP(TYPE, 0, 2); AARRAY_SWAP(TYPE, 1, 3); AARRAY_SWAP(TYPE, 1, 2); }</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eRange-sRange==4) {</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      AARRAY_SWAP(TYPE, 0, 1); AARRAY_SWAP(TYPE, 2, 3); AARRAY_SWAP(TYPE, 0, 2);</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      AARRAY_SWAP(TYPE, 1, 3); AARRAY_SWAP(TYPE, 1, 2); } }</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">if</span>(size &lt; 8) <span class="keywordflow">return</span> array;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">if</span>(it.decimal_step &lt; AARRAY_sortCache) {</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">if</span>((it.decimal_step+1)*4 &lt;= AARRAY_sortCache</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;         &amp;&amp; it.decimal_step*4 &lt;= size) {</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        it.numerator = it.decimal = 0;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <span class="keywordflow">while</span>(!(it.decimal &gt;= it.size)) {</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          <span class="keywordtype">size_t</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;            sA1, sB1, sA2, sB2, sA3, sB3,</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            eA1, eB1, eA2, eB2, eA3, eB3;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sA1, &amp;eA1);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sB1, &amp;eB1);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sA2, &amp;eA2);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sB2, &amp;eB2);</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;          <span class="keywordflow">if</span>(f(array[eB1-1], array[sA1])) {</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            memcpy(&amp;cache[eB1-sB1], &amp;array[sA1], (eA1-sA1)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            memcpy(&amp;cache[0], &amp;array[sB1], (eB1-sB1)*<span class="keyword">sizeof</span>(array[0])); }</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f(array[sB1], array[eA1-1])) {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            AARRAY_aSortMergeInto_$##FNAME(</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;              array, sA1, eA1, sB1, eB1, f, &amp;cache[0]); }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <span class="keywordflow">if</span>(!f(array[sB2], array[eA2-1])</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;               &amp;&amp; !f(array[sA2], array[eB1-1])) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            memcpy(&amp;cache[0], &amp;array[sA1], (eA1-sA1)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            memcpy(&amp;cache[(eA1-sA1)], &amp;array[sB1],</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                   (eB1-sB1)*<span class="keyword">sizeof</span>(array[0])); }</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;          eA1 = eB1;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;          <span class="keywordflow">if</span>(f(array[eB2-1], array[sA2])) {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            memcpy(&amp;cache[(eA1-sA1)+(eB2-sB2)], &amp;array[sA2],</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                   (eA2-sA2)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            memcpy(&amp;cache[eA1-sA1], &amp;array[sB2], (eB2-sB2)*<span class="keyword">sizeof</span>(array[0])); }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f(array[sB2], array[eA2-1])) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            AARRAY_aSortMergeInto_$##FNAME(</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;              array, sA2, eA2, sB2, eB2, f, &amp;cache[eA1-sA1]); }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            memcpy(&amp;cache[eA1-sA1], &amp;array[sA2], (eA2-sA2)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            memcpy(&amp;cache[(eA1-sA1)+(eA2-sA2)], &amp;array[sB2],</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                   (eB2-sB2)*<span class="keyword">sizeof</span>(array[0])); }</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;          eA2 = eB2;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;          sA3 = 0; eA3 = eA1-sA1;</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;          sB3 = eA1-sA1; eB3 = (eA1-sA1)+(eA2-sA2);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;          <span class="keywordflow">if</span>(f(cache[eB3-1], cache[sA3])) {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;            memcpy(&amp;array[sA1+(eA2-sA2)], &amp;cache[sA3],</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                   (eA3-sA3)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            memcpy(&amp;array[sA1], &amp;cache[sB3], (eB3-sB3)*<span class="keyword">sizeof</span>(array[0])); }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f(cache[sB3], cache[eA3-1])) {</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            AARRAY_aSortMergeInto_$##FNAME(</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;              cache, sA3, eA3, sB3, eB3, f, &amp;array[sA1]); }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            memcpy(&amp;array[sA1], &amp;cache[sA3], (eA3-sA3)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            memcpy(&amp;array[sA1+(eA1-sA1)], &amp;cache[sB3],</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                   (eB3-sB3)*<span class="keyword">sizeof</span>(array[0])); } }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        AARRAY_aSortNextLevel(array, &amp;it); }</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        it.numerator = it.decimal = 0;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="keywordflow">while</span>(!(it.decimal &gt;= it.size)) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;          <span class="keywordtype">size_t</span> sA, eA, sB, eB;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sA, &amp;eA);</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;          AARRAY_aSortNextRange(array, &amp;it, &amp;sB, &amp;eB);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;          <span class="keywordflow">if</span>(f(array[eB-1], array[sA]))</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            AARRAY_aSortRotate(array, eA-sA, sA, eB, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f(array[sB], array[eA-1])) {</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;            memcpy(&amp;cache[0], &amp;array[sA], (eA-sA)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            AARRAY_aSortMergeExternal_$##FNAME(</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;              array, sA, eA, sB, eB, f, cache); } } } }</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordtype">size_t</span> block_size = (size_t)AARRAY_sqrt((int64_t)it.decimal_step);</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordtype">size_t</span> buffer_size = it.decimal_step/block_size+1;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordtype">int</span> find_separately;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="keywordtype">size_t</span> sBuff1, eBuff1, sBuff2, eBuff2, sA, eA, sB, eB;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordtype">size_t</span> index, last, count, find, start, pull_index = 0;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="keyword">struct </span>{ <span class="keywordtype">size_t</span> from, to, count, sRange, eRange; } pull[2];</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      pull[0].from = pull[0].to = pull[0].count = 0;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      pull[1].from = pull[1].to = pull[1].count = 0;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      pull[0].sRange = pull[0].eRange = 0;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      pull[1].sRange = pull[1].eRange = 0;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      sBuff1 = 0; eBuff1 = 0;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      sBuff2 = 0; eBuff2 = 0;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      find_separately = 0;</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      find = buffer_size+buffer_size;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <span class="keywordflow">if</span>(block_size &lt;= AARRAY_sortCache)</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        find = buffer_size;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(find &gt; it.decimal_step) {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        find = buffer_size;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        find_separately = 1; }</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      it.numerator = it.decimal = 0;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">while</span>(!(it.decimal &gt;= it.size)) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        AARRAY_aSortNextRange(array, &amp;it, &amp;sA, &amp;eA);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        AARRAY_aSortNextRange(array, &amp;it, &amp;sB, &amp;eB);</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;          <span class="keywordflow">for</span>(last = sA, count = 1; count &lt; find; last = index, count++) {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;          AARRAY_sortFindLastForward(</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            FNAME, array[last], (last+1), eA, find-count);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;          <span class="keywordflow">if</span>(index == eA) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        index = last;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span>(count &gt;= buffer_size) {</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;          AARRAY_PULL(sA);</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;          pull_index = 1;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;          <span class="keywordflow">if</span>(count == buffer_size+buffer_size) {</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            sBuff1 = sA; eBuff1 = sA+buffer_size;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            sBuff2 = sA+buffer_size; eBuff2 = sA+count;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(find == buffer_size+buffer_size) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            sBuff1 = sA; eBuff1 = sA+count;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            find = buffer_size; }</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(block_size &lt;= AARRAY_sortCache) {</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            sBuff1 = sA; eBuff1 = sA+count;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(find_separately) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            sBuff1 = sA; eBuff1 = sA+count;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;            find_separately = 0; }</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            sBuff2 = sA; eBuff2 = sA+count;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;            <span class="keywordflow">break</span>; } }</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull_index == 0 &amp;&amp; count &gt; eBuff1-sBuff1) {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;          sBuff1 = sA; eBuff1 = sA+count;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;          AARRAY_PULL(sA); }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <span class="keywordflow">for</span>(last = eB-1, count = 1; count &lt; find; last = index-1, count++) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;          AARRAY_sortFindFirstBackward(</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            FNAME, array[last], sB, last, find-count);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;          <span class="keywordflow">if</span>(index == sB) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        index = last;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="keywordflow">if</span>(count &gt;= buffer_size) {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;          AARRAY_PULL(eB);</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;          pull_index = 1;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;          <span class="keywordflow">if</span>(count == buffer_size+buffer_size) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            sBuff1 = eB-count; eBuff1 = eB-buffer_size;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            sBuff2 = eB-buffer_size; eBuff2 = eB;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(find == buffer_size+buffer_size) {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            sBuff1 = eB-count; eBuff1 = eB;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            find = buffer_size; }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(block_size &lt;= AARRAY_sortCache) {</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            sBuff1 = eB-count; eBuff1 = eB;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(find_separately) {</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            sBuff1 = eB-count; eBuff1 = eB;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            find_separately = 0; }</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;          <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            <span class="keywordflow">if</span>(pull[0].sRange == sA) pull[0].eRange -= pull[1].count;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            sBuff2 = eB-count; eBuff2 = eB;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            <span class="keywordflow">break</span>; } }</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull_index == 0 &amp;&amp; count &gt; (eBuff1-sBuff1)) {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          sBuff1 = eB-count; eBuff1 = eB;</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;          AARRAY_PULL(eB); } }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">for</span>(pull_index = 0; pull_index &lt; 2; pull_index++) {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="keywordtype">size_t</span> sRange, eRange;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        <span class="keywordtype">size_t</span> length = pull[pull_index].count;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <span class="keywordflow">if</span>(pull[pull_index].to &lt; pull[pull_index].from) {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;          index = pull[pull_index].from;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;          <span class="keywordflow">for</span>(count = 1; count &lt; length; count++) {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            <span class="keywordtype">size_t</span> index_ = index;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            AARRAY_sortFindFirstBackward(</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;              FNAME, array[index_-1], pull[pull_index].to,</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;              (pull[pull_index].from-(count-1)), length-count);</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;            sRange = index+1; eRange = pull[pull_index].from+1;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            AARRAY_aSortRotate(array, (eRange-sRange)-count, sRange, eRange,</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                          cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            pull[pull_index].from = index+count; } }</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull[pull_index].to &gt; pull[pull_index].from) {</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;          index = pull[pull_index].from+1;</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;          <span class="keywordflow">for</span>(count = 1; count &lt; length; count++) {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            AARRAY_sortFindLastForward(</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;              FNAME, array[index], index, pull[pull_index].to, length-count);</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            sRange = pull[pull_index].from; eRange = index-1;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            AARRAY_aSortRotate(</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;              array, count, sRange, eRange, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;            pull[pull_index].from = index-1-count; } } }</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      buffer_size = eBuff1-sBuff1;</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      block_size  = it.decimal_step/buffer_size+1;</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      it.numerator = it.decimal = 0;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordflow">while</span>(!(it.decimal &gt;= it.size)) {</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        AARRAY_aSortNextRange(array, &amp;it, &amp;sA, &amp;eA);</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        AARRAY_aSortNextRange(array, &amp;it, &amp;sB, &amp;eB);</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        start = sA;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordflow">if</span>(start == pull[0].sRange) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;          <span class="keywordflow">if</span>(pull[0].from &gt; pull[0].to) {</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            sA += pull[0].count;</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <span class="keywordflow">if</span>(eA-sA == 0) <span class="keywordflow">continue</span>; }</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull[0].from &lt; pull[0].to) {</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            eB -= pull[0].count;</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            <span class="keywordflow">if</span>(eB-sB == 0) <span class="keywordflow">continue</span>; } }</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordflow">if</span>(start == pull[1].sRange) {</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;          <span class="keywordflow">if</span>(pull[1].from &gt; pull[1].to) {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            sA += pull[1].count;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            <span class="keywordflow">if</span>(eA-sA == 0) <span class="keywordflow">continue</span>; }</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull[1].from &lt; pull[1].to) {</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            eB -= pull[1].count;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            <span class="keywordflow">if</span>(eB-sB == 0) <span class="keywordflow">continue</span>; ;  } }</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="keywordflow">if</span>(f(array[eB-1], array[sA]))</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          AARRAY_aSortRotate(array, eA-sA, sA, eB, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f(array[eA], array[eA-1])) {</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;          <span class="keywordtype">size_t</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            sBlockA, eBlockA, sFirstA, eFirstA, sLastA,</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            eLastA, sLastB, eLastB, sBlockB, eBlockB;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;          <span class="keywordtype">size_t</span> indexA, findA;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;          sBlockA = sA; eBlockA = eA;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;          sFirstA = sA; eFirstA = sA+(eBlockA-sBlockA) % block_size;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;          <span class="keywordflow">for</span>(indexA = sBuff1, index = eFirstA; index &lt; eBlockA;</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;              indexA++, index += block_size) </div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            AARRAY_swap(TYPE, array[indexA], array[index]);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;          sLastA = sFirstA;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;          eLastA = eFirstA;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;          sLastB = 0; eLastB = 0;</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;          sBlockB = sB; eBlockB = sB+(block_size &lt; eB-sB? block_size : eB-sB);</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;          sBlockA += eFirstA-sFirstA;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;          indexA = sBuff1;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;          <span class="keywordflow">if</span>(eLastA-sLastA &lt;= AARRAY_sortCache)</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            memcpy(&amp;cache[0], &amp;array[sLastA], (eLastA-sLastA)*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eBuff2-sBuff2 &gt; 0)</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            AARRAY_blockSwap(TYPE, array, sLastA, sBuff2, eLastA-sLastA);</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;          <span class="keywordflow">if</span>(eBlockA-sBlockA &gt; 0) {</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;              <span class="keywordflow">if</span>((eLastB-sLastB &gt; 0 &amp;&amp; !f(array[eLastB-1], array[indexA]))</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                 || eBlockB-sBlockB == 0) {</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                <span class="keywordtype">size_t</span> B_split = AARRAY_aSortBinaryFirst_$##FNAME(</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                    array, array[indexA], sLastB, eLastB, f);</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                <span class="keywordtype">size_t</span> B_remaining = eLastB-B_split;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                <span class="keywordtype">size_t</span> minA = sBlockA;</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                <span class="keywordflow">for</span>(findA = minA+block_size; findA &lt; eBlockA;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                    findA += block_size)</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                  <span class="keywordflow">if</span>(f(array[findA], array[minA])) minA = findA;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                AARRAY_blockSwap(TYPE, array, sBlockA, minA, block_size);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                AARRAY_swap(TYPE, array[sBlockA], array[indexA]);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                indexA++;</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                <span class="keywordflow">if</span>(eLastA-sLastA &lt;= AARRAY_sortCache)</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                  AARRAY_aSortMergeExternal_$##FNAME(</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                      array, sLastA, eLastA, eLastA, B_split, f, cache);</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eBuff2-sBuff2 &gt; 0)</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                  AARRAY_aSortMergeInternal_$##FNAME(</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                      array, sLastA, eLastA, eLastA, B_split, f, sBuff2);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                  AARRAY_aSortMergeInPlace_$##FNAME(</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                      array, sLastA, eLastA, eLastA, B_split, f, cache);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                <span class="keywordflow">if</span>(eBuff2-sBuff2 &gt; 0 || block_size &lt;= AARRAY_sortCache) {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                  <span class="keywordflow">if</span>(block_size &lt;= AARRAY_sortCache)</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                    memcpy(&amp;cache[0], &amp;array[sBlockA],</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                           block_size*<span class="keyword">sizeof</span>(array[0]));</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                  <span class="keywordflow">else</span> AARRAY_blockSwap(TYPE, array, sBlockA, sBuff2,</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                                        block_size);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                  AARRAY_blockSwap(TYPE, array, B_split,</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                                   sBlockA+block_size-B_remaining,</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                                   B_remaining); }</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                  AARRAY_aSortRotate(array, sBlockA-B_split, B_split,</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                    sBlockA+block_size, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                sLastA = sBlockA-B_remaining; eLastA =</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                  sBlockA-B_remaining+block_size;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                sLastB = eLastA; eLastB = eLastA+B_remaining;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                sBlockA += block_size;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                <span class="keywordflow">if</span>(eBlockA-sBlockA == 0) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eBlockB-sBlockB &lt; block_size) {</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                AARRAY_aSortRotate(</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                  array, sBlockB-sBlockA, sBlockA, eBlockB, cache, 0);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                sLastB = sBlockA; eLastB = sBlockA+(eBlockB-sBlockB);</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                sBlockA += eBlockB-sBlockB;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                eBlockA += eBlockB-sBlockB;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                eBlockB = sBlockB; }</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;              <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                AARRAY_blockSwap(TYPE, array, sBlockA, sBlockB, block_size);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                sLastB = sBlockA; eLastB = sBlockA+block_size;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                sBlockA += block_size;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                eBlockA += block_size;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                sBlockB += block_size;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                <span class="keywordflow">if</span>(eBlockB &gt; eB-block_size) eBlockB = eB;</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                <span class="keywordflow">else</span> eBlockB += block_size; } } }</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;          <span class="keywordflow">if</span>(eLastA-sLastA &lt;= AARRAY_sortCache)</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            AARRAY_aSortMergeExternal_$##FNAME(</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;              array, sLastA, eLastA, eLastA, eB, f, cache);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(eBuff2-sBuff2 &gt; 0)</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            AARRAY_aSortMergeInternal_$##FNAME(</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;              array, sLastA, eLastA, eLastA, eB, f, sBuff2);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            AARRAY_aSortMergeInPlace_$##FNAME(</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;              array, sLastA, eLastA, eLastA, eB, f, cache); } }</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="comment">/* insertion sort */</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordtype">size_t</span> i, j;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keywordflow">for</span>(i = sBuff2+1; i &lt; eBuff2; i++) {</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keyword">const</span> TYPE temp = array[i];</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">for</span>(j = i; j &gt; sBuff2 &amp;&amp; f(temp, array[j-1]); j--)</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          array[j] = array[j-1];</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        array[j] = temp; }</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordflow">for</span>(pull_index = 0; pull_index &lt; 2; pull_index++) {</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="keywordtype">size_t</span> amount, unique = pull[pull_index].count*2;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="keywordflow">if</span>(pull[pull_index].from &gt; pull[pull_index].to) {</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;          <span class="keywordtype">size_t</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            sBuff = pull[pull_index].sRange,</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            eBuff = pull[pull_index].sRange+pull[pull_index].count;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;          <span class="keywordflow">while</span>(eBuff-sBuff &gt; 0) {</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            AARRAY_sortFindFirstForward(FNAME, array[sBuff], eBuff,</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                                        pull[pull_index].eRange, unique);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            amount = index-eBuff;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            AARRAY_aSortRotate(array, eBuff-sBuff, sBuff, index,</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                               cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            sBuff += (amount+1);</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            eBuff += amount;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            unique -= 2; } }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pull[pull_index].from &lt; pull[pull_index].to) {</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;          <span class="keywordtype">size_t</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            sBuff = pull[pull_index].eRange-pull[pull_index].count,</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            eBuff = pull[pull_index].eRange;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;          <span class="keywordflow">while</span>(eBuff-sBuff &gt; 0) {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            AARRAY_sortFindLastBackward(FNAME, array[eBuff-1],</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                                        pull[pull_index].sRange,</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                                        sBuff, unique);</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;            amount = sBuff-index;</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            AARRAY_aSortRotate(</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;              array, amount, index, eBuff, cache, AARRAY_sortCache);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            sBuff -= amount;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;            eBuff -= (amount+1);</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;            unique -= 2; } } } }</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">if</span>(!AARRAY_aSortNextLevel(array, &amp;it)) <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <span class="keywordflow">return</span> array; })</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160; </div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;$define AARRAY_sortCompare(TYPE,,)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_sortCompare__$<span class="preprocessor">##TYPE(TYPE a, TYPE b), {</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="keywordflow">return</span> a&lt;b; })</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;GENERATE_GENERICS(AARRAY_sortCompare,,)</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;GENERATE_GENERICS(AARRAY_sort, FUNC, FUNC_int_TT)</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="preprocessor">#define aSort(vec) \</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(void*,void(*)(void))) \</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="preprocessor">    AARRAY_sort_FUNC_FUNCTIONS[TEST_width(*vec)])((void*)vec, (void(*)(void)) \</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="preprocessor">    AARRAY_sortCompare__FUNCTIONS[TEST_width(*vec)]))</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="preprocessor">#define aSortF_FUNC(vec, f) \</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(void*,void(*)(void))) \</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="preprocessor">    AARRAY_sort_FUNC_FUNCTIONS[TEST_width(*vec)])((void*)vec, (void(*)(void))f))</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;GENERATE_GENERICS(AARRAY_sort, BLOCK, BLOCK_int_TT)</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="preprocessor">#define aSortF_BLOCK(vec, f) \</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(void*, void*)) \</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="preprocessor">    AARRAY_sort_BLOCK_FUNCTIONS[TEST_width(*vec)])((void*)vec, (void*)f))</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;GENERATE_GENERICS(AARRAY_sort, LAMBDA, LAMBDA_int_TT)</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="preprocessor">#define aSortF_LAMBDA(vec, f) \</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="preprocessor">  (AARRAY_typeof(vec, (uint64_t*(*)(void*, \</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="preprocessor">                                    std::function&lt;int(uint64_t,uint64_t)&gt;)) \</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="preprocessor">    AARRAY_sort_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="preprocessor">   ((void*)vec, (std::function&lt;int(uint64_t,uint64_t)&gt;)f))</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160; </div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160; </div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160; </div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">/* (a^b) to avoid overflow into the sign bit */</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;$define AARRAY_searchCompare(TYPE,,)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;AARRAY_define(int64_t AARRAY_searchCompare__$<span class="preprocessor">##TYPE(TYPE a, TYPE b), {</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  $exec [ TYPE = int64_t ] &amp;&amp; echo <span class="stringliteral">&#39;if((a^b)&gt;(UINT64_MAX&gt;&gt;1)) return a&lt;b? INT64_MIN : INT64_MAX;&#39;</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">return</span> (int64_t)((uint64_t)a-(uint64_t)b); })</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160; </div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160; </div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;$define AARRAY_binary(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_binary_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  TYPE*vec, <span class="keywordtype">size_t</span>*index, TYPE key, FTYPE(TYPE)), {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="keywordtype">size_t</span> min = 0, mid = 0, max = aLength(vec);</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="keywordflow">if</span>(!max) { *index = 0; <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="keywordflow">while</span>(min &lt; max) {</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    mid = (min + max) &gt;&gt; 1;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    int64_t cmp = f(key, vec[mid]);</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">if</span>(cmp == 0) { *index = mid; <span class="keywordflow">return</span> 1; } </div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keywordflow">if</span>(cmp &lt; 0) max = mid;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keywordflow">else</span> min = ++mid; }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  *index = mid; <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160; </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">/* an alternative, probably slower, but fully tested */</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">/* AARRAY_define(int AARRAY_binary_$##FNAME$##_$##TYPE(</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">    TYPE*vec, size_t*index, TYPE key, FTYPE(TYPE)), {</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">    size_t min = 0, width = aLength(vec);</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">    size_t base = 0;</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment">    while(width) {</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">      min = base + (width&gt;&gt;1);</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">      int64_t cmp = f(key, vec[min]);</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment">      if(cmp==0) { *index = min; return 1; }</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">      if(cmp&gt;0)  { base = min+1; width--;  }</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">      width &gt;&gt;= 1; }</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment">    *index = min; return 0; }) */</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160; </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">/* our own shmancy algorithm, to make your life more enjoyable */</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;$define AARRAY_pingpong(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_pingpong_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  TYPE*vec, <span class="keywordtype">size_t</span>*index, TYPE key, FTYPE(TYPE)), {</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  <span class="keywordtype">size_t</span> min = 0, max = aLength(vec);</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keywordflow">if</span>(!max) { *index = 0; <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="comment">/* start secant 1/8th of the way into the array, because why not */</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="keywordtype">size_t</span> a = min+(max&gt;&gt;3), b = max-1-(max&gt;&gt;3), c;</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  int64_t fa = f(key, vec[a]), fb = f(key, vec[b]);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="keywordflow">while</span>(min &lt; max) {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="comment">/* divide by non-zero? interpolate : bisect */</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    c = fb-fa? b - (size_t)((<span class="keywordtype">double</span>)fb * (double)(b-a) / (double)(fb-fa)) : max-((max-min)&gt;&gt;1);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="comment">/* keep the pingpong ball on the table */</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    a = b; b = c &lt; min ? min : c &gt;= max ? max-1 : c;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    fa = fb; fb = f(key, vec[b]);</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordflow">if</span>(fb == 0) { *index = b; <span class="keywordflow">return</span> 1; }</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">if</span>(fb &gt;  0) min = b+1; <span class="keywordflow">else</span> max = b; }</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  *index = max; <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">/* same again but with stride -- for arrays of structs */</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;$define AARRAY_pingpongS(TYPE, FNAME, FTYPE)</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_pingpongS_$##FNAME$##_$##TYPE(</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  TYPE*vec, <span class="keywordtype">size_t</span>*index, TYPE*key, FTYPE(TYPE*), <span class="keywordtype">size_t</span> stride), {</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <span class="keywordtype">size_t</span> min = 0, max = aLength(vec)/stride;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordflow">if</span>(!max) { *index = 0; <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="comment">/* start secant 1/8th of the way into the array, because why not */</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordtype">size_t</span> a = min+(max&gt;&gt;3), b = max-1-(max&gt;&gt;3), c;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  int64_t fa = f(key, vec+a*stride),</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    fb = f(key, vec+b*stride);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">while</span>(min &lt; max) {</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="comment">/* divide by non-zero? interpolate : bisect */</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    c = fb-fa? b - (size_t)((<span class="keywordtype">double</span>)fb * (double)(b-a) / (double)(fb-fa)) : max-((max-min)&gt;&gt;1);</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <span class="comment">/* keep the pingpong ball on the table */</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    a = b; b = c &lt; min ? min : c &gt;= max ? max-1 : c;</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    fa = fb; fb = f(key, vec+b*stride);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordflow">if</span>(fb == 0) { *index = b; <span class="keywordflow">return</span> 1; }</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="keywordflow">if</span>(fb &gt;  0) min = b+1; <span class="keywordflow">else</span> max = b; }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  *index = max; <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160; </div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;$define FUNC_T_TT(TYPE)   int64_t(*f)(TYPE,TYPE)</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160; </div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;$define BLOCK_T_TT(TYPE)  int64_t(^f)(TYPE,TYPE)</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160; </div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;$define LAMBDA_T_TT(TYPE) std::function&lt;int64_t(TYPE,TYPE)&gt;f</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160; </div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;GENERATE_GENERICS(AARRAY_searchCompare,,)</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;GENERATE_GENERICS(AARRAY_binary,  FUNC, FUNC_T_TT)</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;GENERATE_GENERICS(AARRAY_pingpong,  FUNC, FUNC_T_TT)</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;GENERATE_GENERICS(AARRAY_pingpongS, FUNC, FUNC_T_TT)</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="preprocessor">#define aSearch(vec, index, key) \</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void(*)(void))) \</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="preprocessor">   AARRAY_binary_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, \</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="preprocessor">    (void(*)(void))AARRAY_searchCompare__FUNCTIONS[TEST_width(*vec)])</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="preprocessor">#define aSearchF_FUNC(vec, index, key, f) \</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void(*)(void))) \</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="preprocessor">   AARRAY_binary_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void(*)(void))f)</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="preprocessor">#define aSearchP(vec, index, key) \</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void(*)(void))) \</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="preprocessor">   AARRAY_pingpong_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, \</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="preprocessor">    (void(*)(void))AARRAY_searchCompare__FUNCTIONS[TEST_width(*vec)])</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="preprocessor">#define aSearchPF_FUNC(vec, index, key, f) \</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void(*)(void))) \</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="preprocessor">   AARRAY_pingpong_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void(*)(void))f)</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="preprocessor">#define aSearchPS_FUNC(vec, index, key, f, stride) \</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void(*)(void), size_t)) \</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="preprocessor">   AARRAY_pingpongS_FUNC_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void(*)(void))f, stride)</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;GENERATE_GENERICS(AARRAY_binary, BLOCK, BLOCK_T_TT)</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;GENERATE_GENERICS(AARRAY_pingpong, BLOCK, BLOCK_T_TT)</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;GENERATE_GENERICS(AARRAY_pingpongS, BLOCK, BLOCK_T_TT)</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="preprocessor">#define aSearchF_BLOCK(vec, index, key, f) \</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void*)) \</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="preprocessor">   AARRAY_binary_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void*)f)</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="preprocessor">#define aSearchPF_BLOCK(vec, index, key, f) \</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void*)) \</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="preprocessor">   AARRAY_pingpong_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void*)f)</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="preprocessor">#define aSearchPS_BLOCK(vec, index, key, f, stride) \</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, void*, size_t)) \</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="preprocessor">   AARRAY_pingpongS_BLOCK_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, (void*)f, stride)</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;GENERATE_GENERICS(AARRAY_binary, LAMBDA, LAMBDA_T_TT)</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;GENERATE_GENERICS(AARRAY_pingpong, LAMBDA, LAMBDA_T_TT)</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;GENERATE_GENERICS(AARRAY_pingpongS, LAMBDA, LAMBDA_T_TT)</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="preprocessor">#define aSearchF_LAMBDA(vec, index, key, f) \</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, \</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="preprocessor">           std::function&lt;int64_t(uint64_t,uint64_t)&gt;)) \</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="preprocessor">   AARRAY_binary_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, \</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="preprocessor">           (std::function&lt;int64_t(uint64_t,uint64_t)&gt;)f)</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="preprocessor">#define aSearchPF_LAMBDA(vec, index, key, f) \</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, \</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="preprocessor">           std::function&lt;int64_t(uint64_t,uint64_t)&gt;)) \</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="preprocessor">   AARRAY_pingpong_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, \</span></div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="preprocessor">           (std::function&lt;int64_t(uint64_t,uint64_t)&gt;)f)</span></div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="preprocessor">#define aSearchPS_LAMBDA(vec, index, key, f, stride) \</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="preprocessor">  ((int(*)(void*, size_t*, uint64_t, \</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="preprocessor">           std::function&lt;int64_t(uint64_t*,uint64_t*)&gt;, size_t)) \</span></div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="preprocessor">   AARRAY_pingpongS_LAMBDA_FUNCTIONS[TEST_width(*vec)]) \</span></div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="preprocessor">   (vec, index, (uint64_t)key, \</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="preprocessor">           (std::function&lt;int64_t(uint64_t*,uint64_t*)&gt;)f, stride)</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160; </div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160; </div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160; </div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160; </div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="preprocessor">#if !defined(AARRAY_NOCONVENIENCE)</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="preprocessor">#if __has_extension(blocks)</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="preprocessor">  #define aMap     aMap_BLOCK</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;<span class="preprocessor">  #define aFilter  aFilter_BLOCK</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="preprocessor">  #define aFold    aFold_BLOCK</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="preprocessor">  #define aLoop    aLoop_BLOCK</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="preprocessor">  #define aSortF   aSortF_BLOCK</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="preprocessor">  #define aSearchF aSearchF_BLOCK</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="preprocessor">  #define aSearchPS aSearchPS_BLOCK</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="preprocessor">  #define aSearchPF aSearchPF_BLOCK</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="preprocessor">#elif defined(__cplusplus)</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="preprocessor">  #define aMap     aMap_LAMBDA</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="preprocessor">  #define aFilter  aFilter_LAMBDA</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="preprocessor">  #define aFold    aFold_LAMBDA</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="preprocessor">  #define aLoop    aLoop_LAMBDA</span></div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="preprocessor">  #define aSortF   aSortF_LAMBDA</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="preprocessor">  #define aSearchF aSearchF_LAMBDA</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="preprocessor">  #define aSearchPS aSearchPS_LAMBDA</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="preprocessor">  #define aSearchPF aSearchPF_LAMBDA</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="preprocessor">  #define aMap     aMap_FUNC</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="preprocessor">  #define aFilter  aFilter_FUNC</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="preprocessor">  #define aFold    aFold_FUNC</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="preprocessor">  #define aLoop    aLoop_FUNC</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="preprocessor">  #define aSortF   aSortF_FUNC</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="preprocessor">  #define aSearchF aSearchF_FUNC</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="preprocessor">  #define aSearchPS aSearchPS_FUNC</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="preprocessor">  #define aSearchPF aSearchPF_FUNC</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160; </div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160; </div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160; </div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">/* api to quickly print arrays without &#39;\0&#39; endings */</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;$define AARRAY_Write(TYPE, ...)</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_Write__$<span class="preprocessor">##TYPE(</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <span class="keywordtype">char</span> errLoc[], FILE*file, <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  AARRAY_safety((<span class="keywordtype">void</span>)errLoc, <span class="keywordflow">if</span>(!file) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1; <span class="keywordflow">while</span>(++n &lt; vecsCount)</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordflow">if</span>(vecs[n] &amp;&amp;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;       *((<span class="keywordtype">size_t</span>*)vecs[n]-1) &gt;</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;       fwrite((<span class="keywordtype">void</span>*)vecs[n], <span class="keyword">sizeof</span>(TYPE), *((<span class="keywordtype">size_t</span>*)vecs[n]-1), file))</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160; </div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;$define AARRAY_WriteE(TYPE, ...)</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_WriteE__$##TYPE(</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="keywordtype">size_t</span> vecsCount, uintptr_t vecs[]), {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  fflush(stdout);</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  <span class="keywordtype">size_t</span> n = (size_t)-1; <span class="keywordflow">while</span>(++n &lt; vecsCount)</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keywordflow">if</span>(vecs[n] &amp;&amp;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;       *((<span class="keywordtype">size_t</span>*)vecs[n]-1) &gt;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;       fwrite((<span class="keywordtype">void</span>*)vecs[n], <span class="keyword">sizeof</span>(TYPE), *((<span class="keywordtype">size_t</span>*)vecs[n]-1), stderr))</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  fflush(stderr);</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;GENERATE_GENERICS(AARRAY_Write,)</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;GENERATE_GENERICS(AARRAY_WriteE,)</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="preprocessor">#define AARRAY_ArgsHead(A, ...) A</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160; </div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;<span class="preprocessor">#define aWriteF(file, ...) \</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;<span class="preprocessor">  ((int(*)(char[], FILE*, size_t, uintptr_t[])) \</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="preprocessor">   AARRAY_Write__FUNCTIONS[TEST_width(*AARRAY_ArgsHead(__VA_ARGS__, NULL))]) \</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="preprocessor">  (AARRAY_LINE, file, </span><span class="comment">/* for c++ */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="preprocessor">   AARRAY_nowarn_internal_start AARRAY_PtrArgs(__VA_ARGS__) \</span></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="preprocessor">   AARRAY_nowarn_internal_end)</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="preprocessor">#define aWrite(...)  aWriteF(stdout, __VA_ARGS__)</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="preprocessor">#define aWriteE(...) \</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="preprocessor">  ((int(*)(size_t, uintptr_t[])) \</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="preprocessor">   AARRAY_WriteE__FUNCTIONS[TEST_width(*AARRAY_ArgsHead(__VA_ARGS__, NULL))]) \</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="preprocessor">  (</span><span class="comment">/* for c++ */</span><span class="preprocessor"> \</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="preprocessor">   AARRAY_nowarn_internal_start AARRAY_PtrArgs(__VA_ARGS__) \</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="preprocessor">   AARRAY_nowarn_internal_end)</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160; </div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160; </div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160; </div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="comment">/* api to emulate printf for arrays</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment"> * cppcheck-suppress ctuuninitvar</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="comment"> * cppcheck-suppress uninitvar</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_percent_parse(</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordtype">char</span> errLoc[], <span class="keyword">const</span> <span class="keywordtype">char</span> fmt[], <span class="keywordtype">size_t</span>*pptr,</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    <span class="keywordtype">char</span>*pspecifier, <span class="keywordtype">int</span>*pnum1, <span class="keywordtype">int</span>*pnum2,</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="keywordtype">size_t</span>*pstart, <span class="keywordtype">size_t</span>*pend, <span class="keywordtype">size_t</span>*doublePercent), {</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <span class="comment">/* get parser values */</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="keywordtype">char</span> specifier = *pspecifier; <span class="keywordtype">int</span> num1 = *pnum1, num2 = *pnum2;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordtype">size_t</span> start = *pstart; <span class="keywordtype">size_t</span> end = *pend; <span class="keywordtype">size_t</span> ptr = *pptr;</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">if</span>(fmt[ptr] == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      specifier = <span class="charliteral">&#39;e&#39;</span>; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;%v&quot;</span>, 2)) {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      ptr = start = ptr+2;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      specifier = <span class="charliteral">&#39;v&#39;</span>; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;%s&quot;</span>, 2)) {</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      ptr = start = ptr+2;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      specifier = <span class="charliteral">&#39;s&#39;</span>; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;%c&quot;</span>, 2)) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      ptr = start = ptr+2;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      specifier = <span class="charliteral">&#39;c&#39;</span>; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;%%&quot;</span>, 2)) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      ptr = start = ptr+2;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      *doublePercent = ptr;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;      specifier = <span class="charliteral">&#39;%&#39;</span>; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fmt[ptr] == <span class="charliteral">&#39;%&#39;</span>) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      end = ptr;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="comment">/* parse %u %i arguments == %base u|i bitwidth</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment">         base == 2-64    bitwidth == c s i l ll 8 16 32 64 z m p */</span> </div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      ptr++; <span class="keywordtype">size_t</span> ptr_start = ptr;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      AARRAY_safety((<span class="keywordtype">void</span>)errLoc;,</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                    <span class="keywordflow">if</span>(fmt[ptr]==<span class="charliteral">&#39;\0&#39;</span>) AARRAY_Error_FormatStringMalformed);</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      num1 = 0; num2 = 0;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="comment">/* get base to print number in */</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="keywordtype">char</span> num_str[] = <span class="stringliteral">&quot;10&quot;</span>;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <span class="keywordflow">while</span>(fmt[ptr] &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; fmt[ptr] &lt;= <span class="charliteral">&#39;9&#39;</span>) ptr++;</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      AARRAY_safety(, <span class="keywordflow">if</span>(ptr-ptr_start &gt; 2) AARRAY_Error_FormatStringMalformed</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="keywordflow">else</span>) <span class="keywordflow">if</span>(ptr != ptr_start) {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        num_str[0] = fmt[ptr_start];</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        num_str[1] = (ptr != ptr_start+1 ? fmt[ptr_start+1] : <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        num1 = (int)strtoul(num_str, NULL, 10); }</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="keywordflow">else</span> num1 = 10;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="comment">/* get number&#39;s type */</span></div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      specifier = fmt[ptr++];</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      AARRAY_safety(, <span class="keywordflow">if</span>((specifier != <span class="charliteral">&#39;i&#39;</span> &amp;&amp; specifier != <span class="charliteral">&#39;u&#39;</span> &amp;&amp;</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;         specifier != <span class="charliteral">&#39;f&#39;</span> &amp;&amp; specifier != <span class="charliteral">&#39;d&#39;</span>) || </div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;         (num1 &lt; 2 || num1 &gt; 64))</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        AARRAY_Error_FormatStringMalformed);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      <span class="comment">/* get number&#39;s bit width */</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="keywordflow">if</span>(specifier == <span class="charliteral">&#39;i&#39;</span> || specifier == <span class="charliteral">&#39;u&#39;</span>) {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;ll&quot;</span>, 2)) {</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;          num2 = <span class="keyword">sizeof</span>(<span class="keywordtype">long</span> long)*8; ptr+=2; }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;16&quot;</span>, 2)) { num2 = 16; ptr+=2; }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;32&quot;</span>, 2)) { num2 = 32; ptr+=2; }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(0==strncmp(fmt+ptr, <span class="stringliteral">&quot;64&quot;</span>, 2)) { num2 = 64; ptr+=2; }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">switch</span>(fmt[ptr]) {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>: num2 = <span class="keyword">sizeof</span>(char)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: num2 = <span class="keyword">sizeof</span>(short)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>: num2 = <span class="keyword">sizeof</span>(int)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: num2 = <span class="keyword">sizeof</span>(long)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>: num2 = <span class="keyword">sizeof</span>(size_t)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: num2 = <span class="keyword">sizeof</span>(intmax_t)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: num2 = <span class="keyword">sizeof</span>(intptr_t)*8; ptr++; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;          <span class="keywordflow">default</span>:  num2 = <span class="keyword">sizeof</span>(int)*8; } }</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(specifier == <span class="charliteral">&#39;f&#39;</span>){ num2 = <span class="keyword">sizeof</span>(float)*8; }</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(specifier == <span class="charliteral">&#39;d&#39;</span>){ num2 = <span class="keyword">sizeof</span>(double)*8; }</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <span class="keywordflow">else</span> { AARRAY_safety(, AARRAY_Error_FormatStringMalformed); }</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      AARRAY_safety(,<span class="keywordflow">if</span>(!num2) AARRAY_Error_FormatStringMalformed);</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      start = ptr;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    ptr++; }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="comment">/* return parser values */</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  *pspecifier = specifier; *pnum1 = num1; *pnum2 = num2;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  *pend = end; *pstart = start; *pptr = ptr; })</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160; </div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> AARRAY_baseChars[] =</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="stringliteral">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ._&quot;</span>;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_u_to_str(</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    uint64_t value,</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;    <span class="comment">/* can contain INTMAX_MAX in binary */</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;    <span class="keywordtype">char</span> str[(8 * <span class="keyword">sizeof</span>(int64_t))+1], <span class="keywordtype">int</span> base), {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordtype">char</span>*walkstr=str;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <span class="comment">/* validate base */</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="keywordflow">if</span>(base&lt;2 || base&gt;64) base = 10;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <span class="comment">/* reverse number */</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">do</span> *walkstr++ = AARRAY_baseChars[value%(<span class="keywordtype">unsigned</span> int)base]; <span class="keywordflow">while</span>(value/=(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)base);</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  *walkstr=<span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="keywordtype">char</span> aux; <span class="keywordflow">while</span>(--walkstr&gt;str) aux=*walkstr, *walkstr=*str, *str++=aux; })</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;AARRAY_define(<span class="keywordtype">void</span> AARRAY_i_to_str(</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    int64_t value,</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="keywordtype">char</span> str[(8 * <span class="keyword">sizeof</span>(int64_t))+1], <span class="keywordtype">int</span> base), {</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  <span class="keywordtype">char</span>*walkstr=str;</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <span class="comment">/* validate base */</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;  <span class="keywordflow">if</span>(base&lt;2 || base&gt;64) base = 10;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;  uint8_t sign = value &lt; 0;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;  <span class="keywordflow">if</span>(sign) value = -value;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  <span class="comment">/* reverse number */</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="keywordflow">do</span> *walkstr++ = AARRAY_baseChars[(uint64_t)value%(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)base];</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordflow">while</span>((value=(int64_t)((uint64_t)value/(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)base)));</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="keywordflow">if</span>(sign) *walkstr++ = <span class="charliteral">&#39;-&#39;</span>;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;  <span class="keywordflow">else</span> *walkstr++ = <span class="charliteral">&#39;+&#39;</span>;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;  *walkstr=<span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;  <span class="keywordtype">char</span> aux; <span class="keywordflow">while</span>(--walkstr&gt;str) aux=*walkstr, *walkstr=*str, *str++=aux; })</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160; </div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment">/* cppp let Fmt be defined once, but output to both streams and arrays */</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;$define OUTPUT_A(A,B) A</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160; </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;$define OUTPUT_B(A,B) B</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;$define FMT_PRINT(isCHAR, isCHARptr, isINT8, isINT16, isINT32,</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                  isINT64, isFLOAT, isDOUBLE, OUTPUT_AB)</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>: {</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fputc(<span class="charliteral">&#39;%&#39;</span>, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;           (<span class="keywordtype">void</span>)aAppend(fmtOut, <span class="charliteral">&#39;%&#39;</span>));</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>: {</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(!vec[vc]) AARRAY_Error_NullParameter)</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fputs(isCHARptr, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;           (<span class="keywordtype">void</span>)aAppendArray(fmtOut, SIZE_MAX,</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                              (uintptr_t)AARRAY_move(isCHARptr)));</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fputc(isCHAR, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;           (<span class="keywordtype">void</span>)aAppend(fmtOut, (uint8_t)isCHAR));</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>: {</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160; AARRAY_u_to_str((num2==8? isINT8 :</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                  (num2==16? isINT16 : (num2==32? isINT32 :isINT64))),</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                  buffer, num1);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fputs(buffer, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;           (<span class="keywordtype">void</span>)aAppendArray(fmtOut, SIZE_MAX,</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                              (uintptr_t)AARRAY_move(buffer)));</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>: {</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160; AARRAY_i_to_str((num2==8? (int8_t)isINT8 :</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                  (num2==16? (int16_t)isINT16 :</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                   (num2==32? (int32_t)isINT32 : (int64_t)isINT64))),</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                  buffer, num1);</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fputs(buffer, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;           (<span class="keywordtype">void</span>)aAppendArray(fmtOut, SIZE_MAX,</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                              (uintptr_t)AARRAY_move(buffer)));</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160; <span class="keywordflow">break</span>; } </div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160; <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>: {</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160; AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160; OUTPUT_AB(<span class="keywordflow">if</span>(EOF==fprintf(fmtOut, <span class="stringliteral">&quot;%g&quot;</span>,</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                           specifier==<span class="charliteral">&#39;f&#39;</span>?(<span class="keywordtype">double</span>)isFLOAT:isDOUBLE)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;           <span class="keywordtype">int</span> len = snprintf(*fmtOut, 0, <span class="stringliteral">&quot;%g&quot;</span>,</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                           specifier==<span class="charliteral">&#39;f&#39;</span>?(<span class="keywordtype">double</span>)isFLOAT:isDOUBLE);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;           <span class="comment">/* safe to assume no errors from snprintf */</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;           <span class="keywordtype">size_t</span> oldlen = aLength(*fmtOut);</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;           (void)aMulti(fmtOut, oldlen, 0, 0, (uintptr_t)len+1, 0);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;           snprintf(&amp;(*fmtOut)[oldlen], (<span class="keywordtype">size_t</span>)len+1, <span class="stringliteral">&quot;%g&quot;</span>,</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                           specifier==<span class="charliteral">&#39;f&#39;</span>?(<span class="keywordtype">double</span>)isFLOAT:isDOUBLE);</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;           (void)aZLength2(*fmtOut, 1));</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160; <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; </div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;$define GENERATE_Fmt(NAME, OUTPUT_AB)</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_Fmt_$##NAME(<span class="keywordtype">char</span> errLoc[],</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                                     OUTPUT_AB(FILE*, <span class="keywordtype">char</span>**) fmtOut,</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                                     <span class="keywordtype">size_t</span> vecCount, uint64_t vec[]), {</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>(!fmtOut) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="keywordtype">size_t</span> ptr= 0, prevStart = 0, start = 0, end = 0, vc = 0;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordtype">char</span> specifier = 0; <span class="keywordtype">size_t</span> doublePercent;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="comment">/* defined to avoid static-analysis false positive */</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="keywordtype">int</span> num1 = 0, num2 = 0;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keywordflow">if</span>(!vecCount) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordtype">char</span>*fmt = (<span class="keywordtype">char</span>*)vec[vc++];</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  AARRAY_safety(, <span class="keywordflow">if</span>(!fmt) AARRAY_Error_NullParameter);</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="comment">/* big enough for binary INTMAX_MAX */</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordtype">char</span> buffer[(8 * <span class="keyword">sizeof</span>(intmax_t))+1];</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="keywordflow">while</span>(1) {</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    prevStart = start;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    AARRAY_percent_parse(errLoc, fmt, &amp;ptr,</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                         &amp;specifier, &amp;num1, &amp;num2, &amp;start, &amp;end,</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                         &amp;doublePercent);</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    OUTPUT_AB(<span class="keywordflow">if</span>(end-prevStart &lt; fwrite(fmt+prevStart, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                                        end-prevStart, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;              (<span class="keywordtype">void</span>)aAppendArray(fmtOut, end-prevStart,</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                                 (uintptr_t)AARRAY_move(&amp;fmt[prevStart])));</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordflow">switch</span>(specifier) {</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: </div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      AARRAY_safety(, OUTPUT_AB(, (<span class="keywordtype">void</span>)aAppend(fmtOut, <span class="charliteral">&#39;X&#39;</span>); (void)aZLength2(*fmtOut, 1)));</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    FMT_PRINT((<span class="keywordtype">char</span>)vec[vc], (<span class="keywordtype">char</span>*)vec[vc], (uint8_t)vec[vc],</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;              (uint16_t)vec[vc], (uint32_t)vec[vc], (uint64_t)vec[vc],</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;              *(<span class="keywordtype">float</span>*)&amp;vec[vc], *(<span class="keywordtype">double</span>*)&amp;vec[vc], OUTPUT_AB)</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      AARRAY_safety(, <span class="keywordflow">if</span>(vc&gt;=vecCount) AARRAY_Error_FormatStringArgs);</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      prevStart = end+2;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      doublePercent = 0;</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        AARRAY_percent_parse(errLoc, fmt, &amp;ptr,</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                             &amp;specifier, &amp;num1, &amp;num2, &amp;start, &amp;end,</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                             &amp;doublePercent); }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      <span class="keywordflow">while</span>(specifier == <span class="charliteral">&#39;%&#39;</span>);</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      AARRAY_safety(, <span class="keywordflow">if</span>(specifier==<span class="charliteral">&#39;e&#39;</span> || specifier==<span class="charliteral">&#39;v&#39;</span>)</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;          AARRAY_Error_FormatStringMalformed);</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordtype">size_t</span> nn = (size_t)-1; <span class="keywordflow">while</span>(++nn &lt; aLength((uintptr_t*)(vec[vc]))) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordflow">if</span>(nn) {</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;          <span class="comment">/* resolving %% to % is a pain, since we now have to */</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;          <span class="comment">/* loop through %v&#39;s separator again, doing the conversion */</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;          <span class="keywordflow">if</span>(doublePercent) {</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;            <span class="keywordtype">size_t</span> ptr2 = prevStart; <span class="keywordflow">while</span>(ptr2 &lt; doublePercent)</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;              <span class="keywordflow">switch</span>(fmt[ptr2]) {</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;              <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>: ptr2+=2; OUTPUT_AB(fputc(<span class="charliteral">&#39;%&#39;</span>, fmtOut),</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                                           (<span class="keywordtype">void</span>)aAppend(fmtOut, <span class="charliteral">&#39;%&#39;</span>)); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;              <span class="keywordflow">default</span>: OUTPUT_AB(fputc(fmt[ptr2++], fmtOut),</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                                 (<span class="keywordtype">void</span>)aAppend(fmtOut, (uint8_t)fmt[ptr2++])); }</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            prevStart = doublePercent; }</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;          OUTPUT_AB(<span class="keywordflow">if</span>(end-prevStart &lt;fwrite(fmt+prevStart, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                                             end-prevStart, fmtOut)) <span class="keywordflow">return</span> -1,</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                    (<span class="keywordtype">void</span>)aAppendArray(fmtOut, end-prevStart,</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                                 (uintptr_t)AARRAY_move(&amp;fmt[prevStart]))); }</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <span class="keywordflow">switch</span>(specifier) {</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        FMT_PRINT(((<span class="keywordtype">char</span>*)vec[vc])[nn], ((<span class="keywordtype">char</span>**)vec[vc])[nn],</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                  ((uint8_t*)vec[vc])[nn], ((uint16_t*)vec[vc])[nn],</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                  ((uint32_t*)vec[vc])[nn], ((uint64_t*)vec[vc])[nn],</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                  ((<span class="keywordtype">float</span>*)vec[vc])[nn], ((<span class="keywordtype">double</span>*)vec[vc])[nn], OUTPUT_AB); } }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <span class="keywordflow">break</span>; }</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    vc++;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    specifier = 0; }</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="keywordflow">return</span> 0; })</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160; </div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;GENERATE_Fmt(File, OUTPUT_A)</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;GENERATE_Fmt(Array, OUTPUT_B)</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160; </div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;AARRAY_define(<span class="keywordtype">int</span> AARRAY_Fmt_Error(</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    <span class="keywordtype">char</span> errLoc[], <span class="keywordtype">size_t</span> vecCount, uint64_t vec[]), {</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  fflush(stdout);</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keywordtype">int</span> returnValue = AARRAY_Fmt_File(errLoc, stderr, vecCount, vec);</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  fflush(stderr);</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;  <span class="keywordflow">return</span> returnValue; })</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160; </div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;#define aFmt(...)         AARRAY_Fmt_File (AARRAY_LINE, stdout, \</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                                           AARRAY_64bitArgs(__VA_ARGS__))</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;<span class="preprocessor">#define aFmtE(...)        AARRAY_Fmt_Error(AARRAY_LINE, \</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;<span class="preprocessor">                                           AARRAY_64bitArgs(__VA_ARGS__))</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="preprocessor">#define aFmtF(file, ...)  AARRAY_Fmt_File (AARRAY_LINE, file, \</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="preprocessor">                                           AARRAY_64bitArgs(__VA_ARGS__))</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;<span class="preprocessor">#define aFmtA(array, ...) AARRAY_Fmt_Array(AARRAY_LINE, array, \</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;<span class="preprocessor">                                           AARRAY_64bitArgs(__VA_ARGS__))</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160; </div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160; </div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160; </div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160; </div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="preprocessor">#if !defined(AARRAY_NOCONVENIENCE)</span></div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="preprocessor">  #define aA   aAppend</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;<span class="preprocessor">  #define aR   aReplace</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;<span class="preprocessor">  #define aAA  aAppendArray</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="preprocessor">  #define aRA  aReplaceArray</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;<span class="preprocessor">  #define aD   aDelete</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="preprocessor">  #define aC   aConcat</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160; </div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="preprocessor">  #define aL   aLength</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="preprocessor">  #define aL2  aLength2</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="preprocessor">  #define aZL2 aZLength2</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160; </div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;<span class="preprocessor">  #define aF   aFmt</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="preprocessor">  #define aFE  aFmtE</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;<span class="preprocessor">  #define aFF  aFmtF</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="preprocessor">  #define aFA  aFmtA</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="preprocessor">  #define aW   aWrite</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;<span class="preprocessor">  #define aWE  aWriteE</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="preprocessor">  #define aWF  aWriteF</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160; </div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="preprocessor">  #define aStr(string) aAppendArray((char**)NULL, SIZE_MAX, (uintptr_t)string)</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160; </div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="preprocessor">#if defined(__cplusplus)</span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  AARRAY_nowarn_pedantic_cpp_end</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160; </div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="preprocessor">#endif</span></div>
</div></div></div></div></center><script>tabsInit(document.getElementById("tabLinks2"), document.getElementById("tabs2"));</script></body></html>